(window["webpackJsonpreact-app"]=window["webpackJsonpreact-app"]||[]).push([[0],{172:function(e,t,n){"use strict";var r=n(19),a=n(56),i=n(55),s=n(62),o=n(58),u=n(63),c=n(439),l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=h(n(213)),p=1e4,m=function(e){function t(e){var n,r=e.name,a=e.code,u=e.message,c=e.error;return i(this,t),(n=s(this,o(t).call(this,u))).name=r,n.code=a,n.error=c,n}return u(t,e),t}(c(Error));t.JSONRPCException=m;var f=function(e){function t(){return i(this,t),s(this,o(t).apply(this,arguments))}return u(t,e),t}(c(Error));t.classJSONRPCServerException=f;var v=function(){function e(t){var n=t.url,r=t.token,a=t.module,s=t.timeout;i(this,e),this.url=n,this.token=r||null,this.module=a,this.timeout=s||p}return a(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"callFunc",value:function(e,t){return l(this,void 0,void 0,r.mark(function n(){var a,i,s;return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a={"Content-Type":"application/json",Accept:"application/json"},this.token&&(a.Authorization=this.token),i=this.makePayload(e,t),n.next=5,d.default.post(this.url,i,{headers:a,timeout:this.timeout});case 5:return s=n.sent,n.abrupt("return",s.data.result);case 7:case"end":return n.stop()}},n,this)}))}}]),e}();t.GenericClient=v;var b=function(e){function t(e){var n;if(i(this,t),n=s(this,o(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return n.token=e.token,n}return u(t,v),a(t,[{key:"callFunc",value:function(e,t){return l(this,void 0,void 0,r.mark(function n(){var a,i,s;return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=this.makePayload(e,t),i={"Content-Type":"application/json",Accept:"application/json",Authorization:this.token},n.next=4,d.default.post(this.url,a,{headers:i,timeout:this.timeout});case 4:return s=n.sent,n.abrupt("return",s.data.result);case 6:case"end":return n.stop()}},n,this)}))}}]),t}();t.AuthorizedGenericClient=b},288:function(e,t,n){"use strict";var r=n(62),a=n(58),i=n(63),s=n(55),o=n(56),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=u(n(213)),l=function(){function e(t){var n=t.url,r=t.token,a=t.timeout;s(this,e),this.url=n,this.token=r||null,this.timeout=a}return o(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();t.ServiceClient=l;var h=function(e){function t(e){var n;if(s(this,t),n=r(this,a(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return n.token=e.token,n}return i(t,l),o(t,[{key:"callFunc",value:function(e,t){var n=this;return new Promise(function(r,a){c.default.post(n.url,n.makePayload(e,t),{headers:{Authorization:n.token,"Content-Type":"application/json",Accept:"application/json"},timeout:n.timeout}).then(function(e){r(e.data)}).catch(function(e){a(e)})})}}]),t}();t.AuthorizedServiceClient=h},289:function(e,t,n){"use strict";var r=n(19),a=n(55),i=n(56),s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=o(n(213)),c="",l="api/V2/token",h="api/V2/me",d=function(){function e(t){var n=t.url;a(this,e),this.url=n}return i(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return s(this,void 0,void 0,r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.get(this.makePath([c]),{headers:{Accept:"application/json"}});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getTokenInfo",value:function(e){return s(this,void 0,void 0,r.mark(function t(){var n,a;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.default.get(this.makePath([l]),{headers:{Accept:"application/json",Authorization:e}});case 2:return n=t.sent,a=n.data,t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}))}},{key:"getMe",value:function(e){return s(this,void 0,void 0,r.mark(function t(){var n,a;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.default.get(this.makePath([h]),{headers:{Accept:"application/json",Authorization:e}});case 2:return n=t.sent,a=n.data,t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}))}}]),e}();t.default=d},412:function(e,t,n){e.exports=n(844)},417:function(e,t,n){},432:function(e,t,n){"use strict";var r=n(113),a=n(56),i=n(62),s=n(58),o=n(63),u=n(55),c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=c(n(436)),h=function e(t){var n=t.name,r=t.onSuccess,a=t.onError;u(this,e),this.name=n,this.onSuccess=r,this.onError=a},d=function(e){function t(e){var n;return u(this,t),(n=i(this,s(t).call(this,e))).started=new Date,n.timeout=e.timeout||5e3,n}return o(t,h),t}(),p=function(){function e(t){var n=t.from,r=t.to;u(this,e),this.from=n,this.to=r,this.id=l.default.v4(),this.created=new Date}return a(e,[{key:"toJSON",value:function(){return{from:this.from,to:this.to,id:this.id,created:this.created}}}]),e}(),m=function(){function e(t){var n=t.name,r=t.payload,a=t.from,i=t.to;u(this,e),this.name=n,this.payload=r,this.id=l.default.v4(),this.created=new Date,this.envelope=new p({from:a,to:i})}return a(e,[{key:"toJSON",value:function(){return{envelope:this.envelope.toJSON(),name:this.name,payload:this.payload}}}]),e}(),f=function(){function e(t){if(u(this,e),this.window=t.window||window,this.debug=t.debug||!1,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.id||l.default.v4(),this.debugLog("Setting partner id to "+t.to),this.partnerId=t.to||null,this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!1,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return a(e,[{key:"debugLog",value:function(e){this.debug&&console.log("[windowChannel]["+this.id+"] "+e)}},{key:"setTo",value:function(e){this.partnerId=e}},{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("TS No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(this.debug&&console.debug("[windowChannel][debug]",this.id,t.envelope.to,this.partnerId,t.envelope.from,t),t.envelope.to!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id","message",t,"channel id",this.id,"partner id",this.partnerId));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var n=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),n&&n.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var r=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),r.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){e.onError?e.onError(a):console.error("Error handling listener for message",t,a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){e.onError?e.onError(a):console.error("Error handling listener for message",t,a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,n){this.listen(new h({name:e,onSuccess:t,onError:n}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.toJSON(),this.host)}},{key:"send",value:function(e,t){if(this.debugLog(" sending message: "+e+", with payload: "+JSON.stringify(t)),null===this.partnerId)throw new Error("Channel partner id not set, cannot send message");var n=new m({name:e,payload:t,from:this.id,to:this.partnerId});this.sendMessage(n)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var n=this;return new Promise(function(r,a){try{if(null===n.partnerId)throw new Error("Channel partner id not set, cannot issue request");n.sendRequest(new m({name:e,payload:t,from:n.id,to:n.partnerId}),function(e){r(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){for(var t=(new Date).getTime(),n=function(){var n=i[a],o=(s=r(n,2))[0];0===s[1].filter(function(e){if(e instanceof d){var n=t-e.started.getTime();if(n>e.timeout){try{e.onError&&e.onError(new Error("timout after "+n))}catch(r){console.error("Error calling error handler",o,r)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(o)},a=0,i=Array.from(e.waitingListeners.entries());a<i.length;a++){var s;n()}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,n){this.listenOnce(new d({name:e,onSuccess:t,onError:n}))}},{key:"when",value:function(e,t){var n=this;return new Promise(function(r,a){return n.listenOnce(new d({name:e,timeout:t,onSuccess:function(e){r(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"setPartner",value:function(e){this.partnerId=e}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.debug&&console.log("[windowChannel]["+this.id+"] starting"),this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}();t.Channel=f},458:function(e,t,n){"use strict";var r=n(19),a=n(55),i=n(56),s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var o=n(459),u=n(172),c=function(){function e(t){var n=t.itemLifetime,r=t.monitoringFrequency,i=t.waiterTimeout,s=t.waiterFrequency;a(this,e),this.cache=new Map,this.cacheLifetime=n||18e5,this.monitoringFrequency=r||6e4,this.waiterTimeout=i||3e4,this.waiterFrequency=s||100,this.isMonitoring=!1}return i(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,setTimeout(function(){var t=new Map,n=!1;Object.keys(e.cache).forEach(function(r){var a=e.cache.get(r);e.isExpired(a)||(t.set(r,a),n=!0)}),e.cache=t,e.isMonitoring=!1,n&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e,t){var n=this;return new Promise(function(r,a){var i=(new Date).getTime();!function s(){setTimeout(function(){var o=n.cache.get(e);if(o){if(o.reserved){var u=(new Date).getTime()-i;return u<n.waiterTimeout?void s():void a(new Error("Timed-out waiting for cache item to become available; timeout "+n.waiterTimeout+", waited "+u))}r(o)}else n.reserveAndFetch(e,t).then(function(){r(n.cache.get(e))}).catch(function(e){a(e)})},n.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e,t){var n=this;return this.reserveItem(e,t),t().then(function(r){return n.setItem(e,r,t),r}).finally(function(){})}},{key:"getItemWithWait",value:function(e){var t=e.id,n=e.fetcher,r=this.cache.get(t);if(r){if(!this.isExpired(r))return r.reserved?this.reserveWaiter(t,n).then(function(e){return e.value}):Promise.resolve(r.value);this.cache.delete(t)}return this.reserveAndFetch(t,n)}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,n){if(this.cache.has(e)){var r=this.cache.get(e);r&&r.reserved?(r.reserved=!1,r.value=t,r.fetcher=n):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:n,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:n,reserved:!1,value:t});this.runMonitor()}}]),e}();t.Cache=c;var l=new c({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),h=1e4,d=function(){function e(t){var n=t.token,r=t.url,i=t.version,s=t.timeout,o=t.rpcContext;if(a(this,e),this.token=n,this.timeout=s||h,this.rpcContext=o||null,!r)throw new Error("The service discovery url was not provided");this.url=r,this.version=i||null,"auto"===i&&(this.version=null)}return i(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return l.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){return s(this,void 0,void 0,r.mark(function e(){var t=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getCached(function(){var e=new o.ServiceWizardClient({url:t.url,token:t.token,timeout:t.timeout});return Promise.resolve(e.getServiceStatus({module_name:t.getModule(),version:t.version}))}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"callFunc",value:function(e,t){return s(this,void 0,void 0,r.mark(function n(){var a,i;return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.lookupModule();case 2:return a=n.sent,i=new u.AuthorizedGenericClient({module:a.module_name,url:a.url,token:this.token}),n.next=6,i.callFunc(e,t);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n,this)}))}}]),e}();t.DynamicServiceClient=d},459:function(e,t,n){"use strict";var r=n(19),a=n(55),i=n(56),s=n(62),o=n(58),u=n(63),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})};function l(e,t){return!("object"!==typeof e||!Reflect.has(e,t)||"string"!==typeof Reflect.get(e,t))}function h(e){return!!(l(e,"module_name")&&l(e,"version")&&l(e,"git_commit_hash")&&function(e,t,n){if("object"===typeof e&&Reflect.has(e,t)){var r=Reflect.get(e,t);if("object"===typeof r&&r instanceof Array)return 0===r.length||r.every(function(e){return"string"===typeof e})}return!1}(e,"release_tags")&&l(e,"url")&&function(e,t){return!("object"!==typeof e||!Reflect.has(e,t)||"number"!==typeof Reflect.get(e,t))}(e,"up")&&l(e,"status")&&l(e,"health"))}Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){return a(this,t),s(this,o(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getServiceStatus",value:function(e){return c(this,void 0,void 0,r.mark(function t(){var n,a;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("get_service_status",e);case 2:if(!((n=t.sent).result&&n.result.length>0)){t.next=14;break}if(a=n.result[0]){t.next=7;break}throw new Error("Crazy as it seems, result is falsy");case 7:if(!h(a)){t.next=11;break}return t.abrupt("return",a);case 11:throw new Error('Sorry, result does not conform to "GetServiceStatusResult"');case 12:t.next=15;break;case 14:throw new Error("Crazy as it seems, no result");case 15:case"end":return t.stop()}},t,this)}))}}]),t}(n(288).AuthorizedServiceClient);t.ServiceWizardClient=d,d.module="ServiceWizard"},460:function(e,t,n){"use strict";var r=n(19),a=n(55),i=n(56),s=n(62),o=n(58),u=n(63),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return a(this,t),s(this,o(t).apply(this,arguments))}return u(t,e),i(t,[{key:"cancelJob",value:function(e){return c(this,void 0,void 0,r.mark(function t(){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("cancel_job",[e]);case 2:case"end":return t.stop()}},t,this)}))}},{key:"getJobLogs",value:function(e){return c(this,void 0,void 0,r.mark(function t(){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("get_job_logs",[e]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"checkJob",value:function(e){return c(this,void 0,void 0,r.mark(function t(){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("check_job",[e]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(n(172).GenericClient);t.default=l,l.module="NarrativeJobService"},461:function(e,t,n){"use strict";var r=n(19),a=n(113),i=n(55),s=n(56),o=n(62),u=n(58),c=n(63),l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return i(this,t),o(this,u(t).apply(this,arguments))}return c(t,e),s(t,[{key:"isAdmin",value:function(){return l(this,void 0,void 0,r.mark(function e(){var t,n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.callFunc("is_admin",[null]);case 3:return t=e.sent,n=a(t,1),i=n[0],e.abrupt("return",i);case 9:throw e.prev=9,e.t0=e.catch(0),console.error("ERROR",e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[0,9]])}))}},{key:"getExecAggrTable",value:function(e){return l(this,void 0,void 0,r.mark(function t(){var n,i,s;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("get_exec_aggr_table",[e]);case 2:return n=t.sent,i=a(n,1),s=i[0],t.abrupt("return",s);case 6:case"end":return t.stop()}},t,this)}))}},{key:"getExecAggrStats",value:function(e){return l(this,void 0,void 0,r.mark(function t(){var n,i,s;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.callFunc("get_exec_aggr_stats",[e]);case 2:return n=t.sent,i=a(n,1),s=i[0],t.abrupt("return",s);case 6:case"end":return t.stop()}},t,this)}))}}]),t}(n(172).GenericClient);t.default=h,h.module="Catalog"},462:function(e,t,n){"use strict";var r,a=n(113);Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MILLISECOND=0]="MILLISECOND",e[e.SECOND=1]="SECOND",e[e.MINUTE=2]="MINUTE",e[e.HOUR=3]="HOUR",e[e.DAY=4]="DAY"}(r=t.TimeUnit||(t.TimeUnit={}));var i=[{unit:r.MILLISECOND,long:"millisecond",short:"ms",single:"m",size:1e3},{unit:r.SECOND,long:"second",short:"sec",single:"s",size:60},{unit:r.MINUTE,long:"minute",short:"min",single:"m",size:60},{unit:r.HOUR,long:"hour",short:"hr",single:"h",size:24},{unit:r.DAY,long:"day",short:"day",single:"d",size:30}];function s(e,t,n){switch(t){case"full":var r=" "+e.long;return 1!==n?r+"s":r;case"short":return" "+e.short;case"compact":return e.single}}t.niceRelativeTime=function(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=o.now||new Date,c=Math.round((u.getTime()-e.getTime())/1e3),l=Math.abs(c),h=o.format||"compact";if(l<86400*(o.absoluteAfter||90)){if(0===l)return"now";l<60?(t=c,n=l,r=s(i[1],h,n)):l<3600?(t=Math.round(c/60),n=Math.round(l/60),r=s(i[2],h,n)):l<86400?(t=Math.round(c/3600),n=Math.round(l/3600),r=s(i[3],h,n)):(t=Math.round(c/86400),n=Math.round(l/86400),r=s(i[4],h,n));var d=a(t<0?["in",null]:[null,"ago"],2),p=d[0],m=d[1];return(p?p+" ":"")+n+r+(m?" "+m:"")}return"compact"===o.format&&u.getFullYear()===e.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)},t.niceDuration=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=t.format||"compact",a=Math.abs(e),o=i.map(function(e){var t=a%e.size;return a=(a-t)/e.size,{label:s(e,r,t),value:t}}).reverse();o.pop();for(var u=!1,c=0;c<o.length;c+=1){if(!u){if(!(o[c].value>0))continue;u=!0}if(t.precision&&t.precision===n.length)break;n.push(o[c])}return 0===n.length?"<"+("compact"!==r?" ":"")+"1"+s(i[1],r,1):n.map(function(e){return String(e.value)+e.label}).join(" ")},t.niceElapsed=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=t.format||"compact",a=Math.abs(e),o=i.map(function(e){var t=a%e.size;return a=(a-t)/e.size,{label:s(e,r,t),value:t}}).reverse();o.pop();for(var u=!1,c=0;c<o.length;c+=1){if(!u){if(!(o[c].value>0))continue;u=!0}if(t.precision&&t.precision===n.length)break;n.push(o[c])}return 0===n.length?["<"+("compact"!==r?" ":"")+"1"+s(i[1],r,1),n]:[n.map(function(e){return String(e.value)+e.label}).join(" "),n]}},463:function(e,t,n){"use strict";var r=n(19),a=n(113),i=n(55),s=n(56),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l,h=u(n(464)),d=c(n(289));!function(e){e[e.NONE=0]="NONE",e[e.AUTHENTICATED=1]="AUTHENTICATED",e[e.UNAUTHENTICATED=2]="UNAUTHENTICATED",e[e.ERROR=3]="ERROR"}(l=t.AuthState||(t.AuthState={}));var p=function(){function e(t){i(this,e),this.url=t}return s(e,[{key:"checkAuth",value:function(){return o(this,void 0,void 0,r.mark(function e(){var t,n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.get("kbase_session")){e.next=3;break}return e.abrupt("return",Promise.resolve({status:l.UNAUTHENTICATED,userAuthorization:null}));case 3:return n=new d.default({url:this.url}),e.abrupt("return",Promise.all([n.getTokenInfo(t),n.getMe(t)]).then(function(e){var n=a(e,2),r=(n[0],n[1]),i=r.roles.map(function(e){var t=e.id;e.desc;return t});return{status:l.AUTHENTICATED,userAuthorization:{token:t,username:r.user,realname:r.display,roles:i}}}).catch(function(e){return{status:l.UNAUTHENTICATED,userAuthorization:null}}));case 5:case"end":return e.stop()}},e,this)}))}}]),e}();t.default=p},50:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(432);t.Channel=r.Channel;var a=n(172);t.GenericClient=a.GenericClient,t.AuthorizedGenericClient=a.AuthorizedGenericClient;var i=n(288);t.ServiceClient=i.ServiceClient,t.AuthorizedServiceClient=i.AuthorizedServiceClient;var s=n(458);t.DynamicServiceClient=s.DynamicServiceClient;var o=n(460);t.NarrativeJobServiceClient=o.default;var u=n(461);t.CatalogClient=u.default;var c=n(289);t.AuthClient=c.default;var l=n(462);t.niceDuration=l.niceDuration,t.niceElapsed=l.niceElapsed,t.niceRelativeTime=l.niceRelativeTime;var h=n(463);t.Auth=h.default,t.AuthState=h.AuthState},801:function(e,t,n){},820:function(e,t,n){},823:function(e,t,n){},837:function(e,t,n){},838:function(e,t,n){},842:function(e,t,n){},843:function(e,t,n){},844:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),s=n(10),o=n.n(s),u=(n(417),n(23)),c=n(24),l=n(31),h=n(30),d=n(32),p=n(77),m=n(28);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}!function(e){e.MAIN_LOAD="main load",e.MAIN_LOAD_START="main load start",e.MAIN_LOAD_SUCCESS="main load success",e.MAIN_LOAD_ERROR="main load error",e.MAIN_UNLOAD="main/unload",e.MY_JOBS_SEARCH="my jobs search",e.MY_JOBS_SEARCH_START="my jobs search start",e.MY_JOBS_SEARCH_SUCCESS="my jobs search success",e.MY_JOBS_SEARCH_ERROR="my jobs search error",e.My_JOBS_REFRESH_SEARCH="my jobs refresh search",e.MY_JOBS_CANCEL="my jobs cancel",e.MY_JOBS_CANCEL_START="my jobs cancel start",e.MY_JOBS_CANCEL_SUCCESS="my jobs cancel success",e.MY_JOBS_CANCEL_ERROR="my jobs cancel error",e.USER_JOBS_SEARCH="user jobs search",e.USER_JOBS_SEARCH_START="user jobs search start",e.USER_JOBS_SEARCH_SUCCESS="user jobs search success",e.USER_JOBS_SEARCH_ERROR="user jobs search error",e.USER_JOBS_CANCEL="user jobs cancel",e.USER_JOBS_CANCEL_START="user jobs cancel start",e.USER_JOBS_CANCEL_SUCCESS="user jobs cancel success",e.USER_JOBS_CANCEL_ERROR="user jobs cancel error",e.PUBLIC_APP_STATS_SEARCH="publicAppStats/Search",e.PUBLIC_APP_STATS_SEARCH_START="publicAppStats/Search/Start",e.PUBLIC_APP_STATS_SEARCH_ERROR="publicAppStats/Search/Error",e.PUBLIC_APP_STATS_SEARCH_SUCCESS="publicAppStats/Search/Success",e.USER_RUN_SUMMARY_SEARCH="userRunSummary/Search",e.USER_RUN_SUMMARY_SEARCH_START="userRunSummary/Search/Start",e.USER_RUN_SUMMARY_SEARCH_ERROR="userRunSummary/Search/Error",e.USER_RUN_SUMMARY_SEARCH_SUCCESS="userRunSummary/Search/Success"}(r||(r={}));var b=function(e,t){if(!e)return e;switch(t.type){case r.MY_JOBS_SEARCH_SUCCESS:return function(e,t){return v({},e,{views:v({},e.views,{myJobsView:v({},e.views.myJobsView,{searchState:A.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case r.MY_JOBS_SEARCH_START:return function(e,t){return v({},e,{views:v({},e.views,{myJobsView:v({},e.views.myJobsView,{searchState:A.SEARCHING})})})}(e);case r.MY_JOBS_CANCEL_SUCCESS:return function(e,t){return v({},e,{views:v({},e.views,{myJobsView:v({},e.views.myJobsView)})})}(e)}};function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e,t){if(!e)return e;switch(t.type){case r.USER_JOBS_SEARCH_START:return function(e,t){return g({},e,{views:g({},e.views,{userJobsView:g({},e.views.userJobsView,{searchState:A.SEARCHING})})})}(e);case r.USER_JOBS_SEARCH_SUCCESS:return function(e,t){return g({},e,{views:g({},e.views,{userJobsView:g({},e.views.userJobsView,{searchState:A.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case r.USER_JOBS_CANCEL_START:case r.USER_JOBS_CANCEL_SUCCESS:return function(e,t){return g({},e,{views:g({},e.views,{userJobsView:g({},e.views.userJobsView)})})}(e)}};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var k=function(e,t){if(!e)return e;switch(t.type){case r.MAIN_LOAD_SUCCESS:return function(e,t){return S({},e,{views:S({},e.views,{mainView:S({},e.views.mainView,{loadingState:I.SUCCESS,isAdmin:t.isAdmin})})})}(e,t);case r.MAIN_UNLOAD:return function(e,t){return S({},e,{views:S({},e.views,{mainView:{loadingState:I.NONE,isAdmin:!1,error:null}})})}(e)}};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=function(e,t){if(!e)return e;switch(t.type){case r.PUBLIC_APP_STATS_SEARCH_START:return function(e,t){return R({},e,{views:R({},e.views,{publicAppStatsView:R({},e.views.publicAppStatsView,{searchState:A.SEARCHING})})})}(e);case r.PUBLIC_APP_STATS_SEARCH_SUCCESS:return function(e,t){return R({},e,{views:R({},e.views,{publicAppStatsView:R({},e.views.publicAppStatsView,{searchState:A.SEARCHED,appStats:t.appStats})})})}(e,t)}};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var N,A,I,j=function(e,t){if(!e)return e;switch(t.type){case r.USER_RUN_SUMMARY_SEARCH_START:return function(e,t){return T({},e,{views:T({},e.views,{userRunSummaryView:T({},e.views.userRunSummaryView,{searchState:A.SEARCHING})})})}(e);case r.USER_RUN_SUMMARY_SEARCH_SUCCESS:return function(e,t){return T({},e,{views:T({},e.views,{userRunSummaryView:T({},e.views.userRunSummaryView,{searchState:A.SEARCHED,userRunSummary:t.userRunSummary})})})}(e,t)}},D=function(e,t){var n=Object(m.baseReducer)(e,t);return n||(k(e,t)||b(e,t)||y(e,t)||O(e,t)||j(e,t)||e)},x=n(150),U=n(407);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L(){var e=[];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Object(m.makeBaseStoreState)(),{views:{mainView:{loadingState:I.NONE,error:null,isAdmin:!1},myJobsView:{searchState:A.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},userJobsView:{searchState:A.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},publicAppStatsView:{searchState:A.NONE,rawAppStats:[],appStats:[],query:{query:""}},userRunSummaryView:{searchState:A.NONE,userRunSummary:[],query:{query:""}}}})}!function(e){e.QUEUED="QUEUED",e.RUNNING="RUNNING",e.FINISHED="FINISHED",e.ERRORED="ERRORED",e.CANCELED="CANCELED"}(N||(N={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SEARCHED=2]="SEARCHED",e[e.ERROR=3]="ERROR"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(I||(I={}));var J=n(51),F=(n(264),n(96)),M=(n(136),n(53)),H=(n(798),n(85)),z=(n(370),n(8)),G=(n(801),n(166),n(21)),Q=(n(120),n(29)),q=(n(372),n(140)),B=(n(266),n(65)),W=(n(268),n(107)),V=(n(267),n(41)),Y=(n(164),n(64)),K=(n(191),n(40)),$=(n(381),n(109)),X=(n(382),n(138)),Z=(n(82),n(20)),ee=n(17),te=n.n(ee),ne=(n(373),n(141));function re(e){switch(e){case N.QUEUED:return"orange";case N.RUNNING:return"blue";case N.CANCELED:return"gray";case N.FINISHED:return"green";case N.ERRORED:return"red";default:throw new Error("Invalid job status")}}var ae,ie=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=function(e){switch(e){case N.QUEUED:return i.a.createElement("span",null,i.a.createElement(z.a,{type:"loading",spin:!0})," Queued");case N.RUNNING:return i.a.createElement("span",null,i.a.createElement(z.a,{type:"loading-3-quarters",spin:!0})," Running");case N.CANCELED:return"Canceled";case N.FINISHED:return"Success";case N.ERRORED:return"Errored";default:throw new Error("Invalid job status")}}(this.props.jobStatus),t=re(this.props.jobStatus);return i.a.createElement(ne.a,{color:t},e)}}]),t}(i.a.Component),se=n(78),oe=n(19),ue=n.n(oe),ce=n(46),le=(n(820),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={selectedTabIndex:0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"selectTab",value:function(e){this.setState({selectedTabIndex:e})}},{key:"renderTabs",value:function(){var e=this;return this.props.tabs.map(function(t,n){var r=["FlexTabs-tab"];return n===e.state.selectedTabIndex&&r.push("FlexTabs-tab-active"),i.a.createElement("span",{key:String(n),className:r.join(" ")},i.a.createElement(Z.a,{type:"link",onClick:function(){e.selectTab(n)}},t.title))})}},{key:"renderTabBody",value:function(){return this.props.tabs[this.state.selectedTabIndex].component}},{key:"render",value:function(){return i.a.createElement("div",{className:"FlexTabs"},i.a.createElement("div",{className:"FlexTabs-header"},this.renderTabs()),i.a.createElement("div",{className:"FlexTabs-body"},this.renderTabBody()))}}]),t}(i.a.Component)),he=(n(371),n(108)),de=(n(821),n(74)),pe=(n(265),n(92)),me=(n(823),n(277)),fe=n.n(me),ve=n(408),be=n.n(ve);!function(e){e[e.NONE=0]="NONE",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.DISABLED=3]="DISABLED"}(ae||(ae={}));var Ee=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).playLogTimer=void 0,n.bodyRef=void 0,n.currentJobStatus=void 0,n.playLogTimer=0,n.bodyRef=i.a.createRef(),n.currentJobStatus=null,n.state={playState:ae.NONE,isPaused:!1},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.currentJobStatus=this.props.job.status,null!==this.bodyRef.current&&(this.state.isPaused||this.isActive()&&(this.bodyRef.current.scrollTop=this.bodyRef.current.clientHeight))}},{key:"componentDidUpdate",value:function(){var e=this.currentJobStatus;this.currentJobStatus=this.props.job.status,null!==this.bodyRef.current&&(this.state.isPaused||(this.isActive()||e!==N.RUNNING||this.props.job.status!==N.RUNNING)&&(this.bodyRef.current.scrollTop=this.bodyRef.current.clientHeight))}},{key:"isActive",value:function(){return this.props.job.status===N.QUEUED||this.props.job.status===N.RUNNING}},{key:"renderLastLine",value:function(){var e;return e=this.isActive()?i.a.createElement(M.a,{size:"small"}):i.a.createElement("div",{style:{textAlign:"center",fontStyle:"italic"}},"Log complete"),i.a.createElement("div",{className:"FlexTable-row",key:"END",style:{backgroundColor:"rgba(200, 200, 200, 0.5)"},"data-end":"end"},i.a.createElement("div",{className:"FlexTable-col"}),i.a.createElement("div",{className:"FlexTable-col"},e))}},{key:"renderJobLog",value:function(){var e=this.props.log;if(0===e.length)return i.a.createElement(pe.a,null);var t=e.map(function(e){var t={};return e.isError&&(t.color="red"),i.a.createElement("div",{className:"FlexTable-row",style:t,key:e.lineNumber},i.a.createElement("div",{className:"FlexTable-col"},e.lineNumber),i.a.createElement("div",{className:"FlexTable-col"},e.line))});return t.push(this.renderLastLine()),i.a.createElement("div",{className:"FlexTable",key:"log"},i.a.createElement("div",{className:"FlexTable-header"},i.a.createElement("div",{className:"FlexTable-row"},i.a.createElement("div",{className:"FlexTable-col"},"Line #"),i.a.createElement("div",{className:"FlexTable-col"},"Log line"))),i.a.createElement("div",{className:"FlexTable-body",ref:this.bodyRef},t))}},{key:"renderJobLogRow",value:function(){}},{key:"renderJobLogLines",value:function(){return i.a.createElement(G.a,{dataSource:this.props.log,size:"small",rowKey:function(e){return String(e.lineNumber)},pagination:!1,scroll:{y:"100%"},rowClassName:function(e){return e.isError?"JobLog-errorRow":"JobLog-normalRow"}},i.a.createElement(G.a.Column,{title:"Row",dataIndex:"lineNumber",key:"lineNumber",width:"8%",render:function(e,t){var n=new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e);return t.isError?i.a.createElement("span",{className:"JobLog-errorText"},n):n},sorter:function(e,t){return e.lineNumber-t.lineNumber}}),i.a.createElement(G.a.Column,{title:"Log line",dataIndex:"line",key:"line",width:"92%",render:function(e,t){var n;return n=t.isError?i.a.createElement("span",{className:"JobLog-errorText"},e):i.a.createElement("span",null,e),i.a.createElement(Q.a,{title:e},n)}}))}},{key:"downloadLog",value:function(e,t){var n,r;switch(e){case"tsv":n="application/octet-stream",r=function(e){return fe.a.unparse(e,{delimiter:"\t"})}(t);break;case"json":n="application/octet-stream",r=function(e){return JSON.stringify(e)}(t);break;default:case"csv":n="application/octet-stream",r=function(e){return fe.a.unparse(e)}(t)}!function(e,t,n){var r=document.createElement("a"),a=new Blob([n]);r.href=URL.createObjectURL(a),r.download=e,r.style.visibility="none",r.type=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}("job-log."+e,n,r)}},{key:"onMenuClick",value:function(e){e&&this.downloadLog(e.key,this.props.log)}},{key:"onPlayLog",value:function(){this.setState({playState:ae.PLAYING,isPaused:!1})}},{key:"onPauseLog",value:function(){this.setState({playState:ae.PAUSED,isPaused:!0})}},{key:"renderPlayPause",value:function(){var e,t;switch(this.props.job.status){case N.QUEUED:e=!0;break;case N.RUNNING:e=!1;break;case N.FINISHED:case N.ERRORED:case N.CANCELED:default:e=!0}return t=!(this.state.isPaused||this.props.job.status!==N.QUEUED&&this.props.job.status!==N.RUNNING),i.a.createElement(be.a,null,i.a.createElement(Z.a,{icon:"caret-right",disabled:e||!this.state.isPaused,onClick:this.onPlayLog.bind(this)}),i.a.createElement(Z.a,{icon:"pause",disabled:e||this.state.isPaused,onClick:this.onPauseLog.bind(this)})," ",i.a.createElement(M.a,{spinning:t}))}},{key:"renderToolbar",value:function(){var e=0===this.props.log.length,t=i.a.createElement(de.a,{onClick:this.onMenuClick.bind(this)},i.a.createElement(de.a.Item,{key:"csv",disabled:e},"CSV"),i.a.createElement(de.a.Item,{key:"tsv",disabled:e},"TSV"),i.a.createElement(de.a.Item,{key:"json",disabled:e},"JSON"));return i.a.createElement("div",{key:"toolbar"},i.a.createElement(he.a,{overlay:t},i.a.createElement(Z.a,{icon:"download"}))," ",this.renderPlayPause())}},{key:"render",value:function(){return i.a.createElement("div",{className:"JobLog"},this.renderToolbar(),this.renderJobLog())}}]),t}(i.a.Component),ge=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderSubmitted",value:function(){var e=this.props.job.queuedAt;return e?i.a.createElement(m.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")}},{key:"renderQueuedFor",value:function(){var e=this.props.job;switch(e.status){case N.QUEUED:return i.a.createElement(m.NiceElapsedTime,{from:e.queuedAt,precision:2,useClock:!0});case N.RUNNING:case N.FINISHED:case N.CANCELED:case N.ERRORED:return i.a.createElement(m.NiceElapsedTime,{from:e.queuedAt,to:e.runAt,precision:2})}}},{key:"renderRunFor",value:function(){var e=this.props.job;switch(e.status){case N.QUEUED:return i.a.createElement("span",null,"-");case N.RUNNING:return i.a.createElement(m.NiceElapsedTime,{from:e.runAt,precision:2,useClock:!0});case N.FINISHED:case N.CANCELED:case N.ERRORED:return i.a.createElement(m.NiceElapsedTime,{from:e.runAt,to:e.finishAt,precision:2})}}},{key:"renderStateSpinner",value:function(e){if(this.props.job.status===e)return i.a.createElement("span",null," ",i.a.createElement(M.a,{size:"small",style:{color:re(e)}}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"JobInfo InfoTable"},i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Job ID"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.props.job.id)),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Status"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement(ie,{jobStatus:this.props.job.status}))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Narrative"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement("a",{href:"/narrative/".concat(this.props.job.narrativeID),target:"_blank",rel:"noopener noreferrer"},this.props.job.narrativeTitle))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"App"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement("a",{href:"/#catalog/apps/".concat(this.props.job.appID)},this.props.job.appTitle))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Submitted"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderSubmitted())),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Queued For"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderQueuedFor(),this.renderStateSpinner(N.QUEUED))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Run For"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderRunFor(),this.renderStateSpinner(N.RUNNING))))}}]),t}(i.a.Component),ye=(n(837),function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return i.a.createElement("div",{className:"FullyCenteredBox"},i.a.createElement("span",null,"Loading ... ",i.a.createElement(M.a,null)))}},{key:"renderQueued",value:function(){return i.a.createElement("div",{className:"FullyCenteredBox"},i.a.createElement("span",null,"The job is ",i.a.createElement("i",null,"queued"),". The log will be displayed when the job starts running ... ",i.a.createElement(M.a,null)))}},{key:"renderError",value:function(e){return i.a.createElement(F.a,{type:"error",message:e.error})}},{key:"renderJobLog",value:function(){switch(this.props.view.status){case Oe.NONE:case Oe.JOB_QUEUED:return this.renderQueued();case Oe.INITIAL_LOADING:return this.renderLoading();case Oe.ERROR:return this.renderError(this.props.view);case Oe.ACTIVE_LOADED:case Oe.ACTIVE_LOADING:case Oe.FINISHED_LOADED:return i.a.createElement(Ee,{job:this.props.view.job,log:this.props.view.log})}}},{key:"renderJobInfo",value:function(){switch(this.props.view.status){case Oe.NONE:return this.renderLoading();case Oe.JOB_QUEUED:return i.a.createElement(ge,{job:this.props.view.job});case Oe.INITIAL_LOADING:return this.renderLoading();case Oe.ERROR:return this.renderError(this.props.view);case Oe.ACTIVE_LOADED:case Oe.ACTIVE_LOADING:case Oe.FINISHED_LOADED:return i.a.createElement(ge,{job:this.props.view.job})}}},{key:"renderTest",value:function(){var e=Array.from(Array(100).keys()).map(function(e){return i.a.createElement("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"row",borderBottom:"1px silver solid"},key:String(e)},i.a.createElement("div",{style:{flex:"0 0 auto",padding:"4px",overflowWrap:"break-word",wordWrap:"break-word"}},e))});return i.a.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column",minHeight:0}},i.a.createElement("div",null,"Header Here"),i.a.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column",minHeight:0,overflowY:"auto"}},e))}},{key:"renderTest2",value:function(){var e=Array.from(Array(100).keys()).map(function(e){return i.a.createElement("div",{className:"FlexTable-row",key:String(e)},i.a.createElement("div",{className:"FlexTable-col"},e),i.a.createElement("div",{className:"FlexTable-col"},"This is row ",e))});return i.a.createElement("div",{className:"FlexTable"},i.a.createElement("div",{className:"FlexTable-header"},i.a.createElement("div",{className:"FlexTable-row"},i.a.createElement("div",{className:"FlexTable-col"},"#"),i.a.createElement("div",{className:"FlexTable-col"},"Data"))),i.a.createElement("div",{className:"FlexTable-body"},e))}},{key:"render",value:function(){var e=[{tab:"log",title:"Log",component:this.renderJobLog()},{tab:"detail",title:"Detail",component:this.renderJobInfo()}];return i.a.createElement(le,{tabs:e})}}]),t}(i.a.Component)),we=n(50),Se=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getJobs",value:function(){var e=Object(ce.a)(ue.a.mark(function e(t){var n,r,a;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.epoch_range,r=t.user_ids,e.next=3,this.callFunc("get_jobs",[{epoch_range:n,user_ids:r}]);case 3:return a=e.sent,e.abrupt("return",a[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getJob",value:function(){var e=Object(ce.a)(ue.a.mark(function e(t){var n,r;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.job_id,e.next=3,this.callFunc("get_job",[{job_id:n}]);case 3:return r=e.sent,e.abrupt("return",r[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAppMetrics",value:function(){var e=Object(ce.a)(ue.a.mark(function e(t){var n,r,a;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.epoch_range,r=t.user_ids,e.next=3,this.callFunc("get_job",[{epoch_range:n,user_ids:r}]);case 3:return a=e.sent,e.abrupt("return",a[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(we.DynamicServiceClient);function ke(e,t){switch(function(e){switch(e.state){case"QUEUED":return N.QUEUED;case"RUNNING":return N.RUNNING;case"FINISHED":return N.FINISHED;case"CANCELED":return N.CANCELED;case"ERRORED":return N.ERRORED;case"QUEUE_ERRORED":return console.warn("QUEUE_ERRORED",e),N.ERRORED;default:throw new Error("Unknown job state: "+e.state)}}(e)){case N.QUEUED:return function(e,t){var n;return n=e.wsid?parseInt(e.wsid,10):null,{key:e.job_id,id:e.job_id,status:N.QUEUED,appID:e.app_id,appTitle:e.app_id,narrativeID:n,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case N.RUNNING:return function(e,t){var n;if(n=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Running job without exec_start_time!");return{key:e.job_id,id:e.job_id,status:N.RUNNING,appID:e.app_id,appTitle:e.app_id,narrativeID:n,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:Date.now()-e.exec_start_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case N.FINISHED:return function(e,t){var n;if(n=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Running job without exec_start_time!");if(!e.finish_time)throw new Error("Running job without finish_time!");return{key:e.job_id,id:e.job_id,status:N.FINISHED,appID:e.app_id,appTitle:e.app_id,narrativeID:n,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case N.ERRORED:return function(e,t){var n;if(n=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Errored job without exec_start_time!");if(!e.finish_time)throw new Error("Errored job without finish_time!");return{key:e.job_id,id:e.job_id,status:N.ERRORED,appID:e.app_id,appTitle:e.app_id,narrativeID:n,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,message:e.status,username:e.user||t}}(e,t);case N.CANCELED:return function(e,t){var n;if(n=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Canceled job without exec_start_time!");if(!e.finish_time)throw new Error("Canceled job without finish_time!");return{key:e.job_id,id:e.job_id,status:N.CANCELED,appID:e.app_id,appTitle:e.app_id,narrativeID:n,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);default:throw new Error("Invalid job status: "+e.status)}}function Ce(e,t){return!t||t.some(function(t){return e.status===t})}function Re(e){switch(e.kind){case"preset":return function(e){var t=(new Date).getTime();switch(e){case"lastHour":return[t-36e5,t];case"last48Hours":return[t-1728e5,t];case"lastWeek":return[t-6048e5,t];case"lastMonth":return[t-2592e6,t]}}(e.preset);case"literal":return[e.start,e.end];default:throw new Error("Invalid time range kind value (should be impossible")}}Se.module="kb_Metrics";var Oe;!function(e){e[e.NONE=0]="NONE",e[e.JOB_QUEUED=1]="JOB_QUEUED",e[e.INITIAL_LOADING=2]="INITIAL_LOADING",e[e.ACTIVE_LOADED=3]="ACTIVE_LOADED",e[e.ACTIVE_LOADING=4]="ACTIVE_LOADING",e[e.FINISHED_LOADED=5]="FINISHED_LOADED",e[e.ERROR=6]="ERROR"}(Oe||(Oe={}));var _e=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={status:Oe.NONE},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getJob",value:function(){var e=Object(ce.a)(ue.a.mark(function e(){var t,n,r;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Se({token:this.props.token,url:this.props.serviceWizardURL}),n=this.props.jobID,e.next=4,t.getJob({job_id:n});case 4:return r=e.sent,e.abrupt("return",ke(r.job_state,"UNKNOWN"));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJobLog",value:function(){var e=Object(ce.a)(ue.a.mark(function e(t){var n,r,a,i;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new we.NarrativeJobServiceClient({token:this.props.token,url:this.props.njsURL,module:"NarrativeJobService"}),e.next=3,n.getJobLogs({job_id:this.props.jobID,skip_lines:t});case 3:return r=e.sent,a=Object(se.a)(r,1),i=a[0],e.abrupt("return",i.lines.map(function(e,n){return{lineNumber:t+n+1,line:e.line,isError:!!e.is_error}}));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"startPolling",value:function(){var e=this,t=function(){var t=Object(ce.a)(ue.a.mark(function t(){var r,a,i,s,o;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=e.state).status===Oe.ACTIVE_LOADED){t.next=4;break}return e.setState({status:Oe.ERROR,error:"Invalid state for polling: "+r.status}),t.abrupt("return");case 4:return a=r.log,e.setState({status:Oe.ACTIVE_LOADING,log:a}),t.next=8,e.getJob();case 8:return i=t.sent,s=a.length,t.next=12,e.getJobLog(s);case 12:o=t.sent,t.t0=i.status,t.next=t.t0===N.QUEUED?16:t.t0===N.RUNNING?18:t.t0===N.FINISHED?21:t.t0===N.ERRORED?23:t.t0===N.CANCELED?25:26;break;case 16:return e.startQueuedPolling(),t.abrupt("break",26);case 18:return e.setState({status:Oe.ACTIVE_LOADED,log:a.concat(o),job:i}),n(),t.abrupt("break",26);case 21:case 23:return e.setState({status:Oe.FINISHED_LOADED,log:a.concat(o),job:i}),t.abrupt("break",26);case 25:e.setState({status:Oe.FINISHED_LOADED,log:a.concat(o),job:i});case 26:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),n=function(){setTimeout(t,5e3)};n()}},{key:"startQueuedPolling",value:function(){var e=this,t=function(){var t=Object(ce.a)(ue.a.mark(function t(){var r,a;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getJob();case 2:r=t.sent,t.t0=r.status,t.next=t.t0===N.QUEUED?6:8;break;case 6:return n(),t.abrupt("return");case 8:return t.next=10,e.getJobLog(0);case 10:a=t.sent,t.t1=r.status,t.next=t.t1===N.RUNNING?14:t.t1===N.FINISHED?17:t.t1===N.ERRORED?19:t.t1===N.CANCELED?21:23;break;case 14:return e.setState({status:Oe.ACTIVE_LOADED,log:a,job:r}),n(),t.abrupt("break",23);case 17:case 19:case 21:return e.setState({status:Oe.FINISHED_LOADED,log:a,job:r}),t.abrupt("break",23);case 23:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),n=function(){setTimeout(t,5e3)};n()}},{key:"getInitialJobLog",value:function(){var e=Object(ce.a)(ue.a.mark(function e(){var t,n;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:Oe.INITIAL_LOADING}),e.next=3,this.getJob();case 3:t=e.sent,e.t0=t.status,e.next=e.t0===N.QUEUED?7:e.t0===N.RUNNING?10:e.t0===N.FINISHED?15:e.t0===N.ERRORED?20:e.t0===N.CANCELED?25:30;break;case 7:return this.setState({status:Oe.JOB_QUEUED,job:t}),this.startQueuedPolling(),e.abrupt("return");case 10:return e.next=12,this.getJobLog(0);case 12:return n=e.sent,this.setState({status:Oe.ACTIVE_LOADED,log:n,job:t}),e.abrupt("return");case 15:return e.next=17,this.getJobLog(0);case 17:return n=e.sent,this.setState({status:Oe.FINISHED_LOADED,log:n,job:t}),e.abrupt("return");case 20:return e.next=22,this.getJobLog(0);case 22:return n=e.sent,this.setState({status:Oe.FINISHED_LOADED,log:n,job:t}),e.abrupt("return");case 25:return e.next=27,this.getJobLog(0);case 27:return n=e.sent,this.setState({status:Oe.FINISHED_LOADED,log:n,job:t}),e.abrupt("return");case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getInitialJobLog()}},{key:"renderLoading",value:function(){return i.a.createElement("div",null,"Loading ... ",i.a.createElement(M.a,null))}},{key:"renderQueued",value:function(){return i.a.createElement("div",null,"Queued ... ",i.a.createElement(M.a,null))}},{key:"renderError",value:function(e){return i.a.createElement(F.a,{type:"error",message:e.error})}},{key:"render",value:function(){return i.a.createElement(ye,{view:this.state})}}]),t}(i.a.Component);var Te,Ne=Object(J.connect)(function(e,t){var n=e.auth.userAuthorization,r=e.app.config.services,a=r.NarrativeJobService.url,i=r.ServiceWizard.url;if(!n)throw new Error("Invalid state: token required");return{token:n.token,njsURL:a,serviceWizardURL:i}},function(e,t){return{}})(_e),Ae=(n(838),n(378),n(97)),Ie=n(194),je=n(206),De=n.n(je),xe=function(){function e(t){Object(u.a)(this,e),this.subscriptions=void 0,this.pubsub=void 0,this.subscriptions=[],this.pubsub=t}return Object(c.a)(e,[{key:"on",value:function(e,t){var n=this.pubsub.on(e,t);this.subscriptions.push(n)}},{key:"off",value:function(){var e=this;this.subscriptions.forEach(function(t){e.pubsub.off(t)})}}]),e}(),Ue=function(){function e(){Object(u.a)(this,e),this.sendQueue=void 0,this.messageListeners=void 0,this.allListeners=void 0,this.sendQueue=[],this.messageListeners=new Map,this.allListeners=new Map}return Object(c.a)(e,[{key:"sendMessages",value:function(){var e=this,t=this.sendQueue;this.sendQueue=[],t.forEach(function(t){var n=e.messageListeners.get(t.id);n&&n.listeners.forEach(function(e){try{e.handler(t.payload)}catch(n){console.error("ERROR",n)}})})}},{key:"processQueue",value:function(){var e=this;0!==this.sendQueue.length&&window.setTimeout(function(){e.sendMessages()},1e3/60)}},{key:"send",value:function(e,t){var n={id:e,payload:t};this.sendQueue.push(n),this.processQueue()}},{key:"on",value:function(e,t){var n=this.messageListeners.get(e);n||(n={listeners:[]},this.messageListeners.set(e,n));var r=De.a.v4(),a={id:r,messageID:e,handler:t};return n.listeners.push(a),this.allListeners.set(r,a),r}},{key:"off",value:function(e){var t=this.allListeners.get(e);if(t){var n=this.messageListeners.get(t.messageID);n&&(n.listeners=n.listeners.filter(function(e){return e.id!==t.id}))}}}]),e}();!function(e){e[e.STARTED=0]="STARTED",e[e.POLLING=1]="POLLING",e[e.WAITING=2]="WAITING",e[e.PAUSED=3]="PAUSED",e[e.STOPPED=4]="STOPPED",e[e.ERROR=5]="ERROR"}(Te||(Te={}));var Pe=function(){function e(t){Object(u.a)(this,e),this.params=void 0,this.statusTimer=void 0,this.statusCount=void 0,this.watchStartAt=void 0,this.status=void 0,this.error=void 0,this.watcherTimer=void 0,this.waitTimer=void 0,this.pubsubProxy=void 0,this.params=t,this.statusTimer=null,this.statusCount=0,this.watchStartAt=0,this.status=Te.STOPPED,this.watcherTimer=null,this.waitTimer=null,this.pubsubProxy=new xe(this.params.pubsub),this.error=""}return Object(c.a)(e,[{key:"stop",value:function(){this.pubsubProxy.off()}},{key:"pause",value:function(){this.status=Te.PAUSED,this.waitTimer&&window.clearInterval(this.waitTimer),this.statusTimer&&window.clearInterval(this.statusTimer),this.watcherTimer&&window.clearTimeout(this.watcherTimer),this.statusCount=0,this.updateOnProgress()}},{key:"play",value:function(){this.startWaiting()}},{key:"startWatching",value:function(){var e=this;this.watchStartAt=Date.now(),this.status=Te.STARTED;var t=function(){var t=Date.now()-e.watchStartAt;if(t>1e4)return e.status=Te.ERROR,e.error="Polling took too long (".concat(t,"ms)"),void e.stopPolling();switch(e.status){case Te.STARTED:case Te.POLLING:return void n();case Te.WAITING:e.watcherTimer&&window.clearTimeout(e.watcherTimer),e.status=Te.WAITING,e.startWaiting();break;case Te.STOPPED:n();break;case Te.PAUSED:console.warn("unexpected state PAUSED");break;case Te.ERROR:console.warn("unexpected state ERROR")}},n=function(){e.watcherTimer=window.setTimeout(t,e.params.watchInterval)};n()}},{key:"startWaiting",value:function(){var e=this;this.status=Te.WAITING;var t=function(){e.statusTimer=window.setInterval(function(){e.statusCount+=1,e.updateOnProgress()},e.params.pollInterval/e.params.progressSteps)};e.waitTimer=window.setTimeout(e.runPoll.bind(e),e.params.pollInterval),e.statusCount=0,t()}},{key:"runPoll",value:function(){this.statusTimer&&window.clearInterval(this.statusTimer),this.params.onPoll(),this.statusCount=0,this.startWatching()}},{key:"startListeningForPollingEvent",value:function(){var e=this;this.pubsubProxy.on("searching",function(t){if(t.is)switch(e.status){case Te.STARTED:e.status=Te.POLLING;break;case Te.POLLING:break;case Te.WAITING:e.pause();break;case Te.STOPPED:case Te.PAUSED:case Te.ERROR:}else switch(e.status){case Te.STARTED:break;case Te.POLLING:e.status=Te.WAITING;break;case Te.WAITING:case Te.STOPPED:break;case Te.PAUSED:e.play();break;case Te.ERROR:}})}},{key:"stopListeningForPollingEvent",value:function(){this.pubsubProxy.off()}},{key:"startPolling",value:function(){this.startListeningForPollingEvent(),this.runPoll()}},{key:"updateOnProgress",value:function(){this.params.onProgress(100*this.statusCount/this.params.progressSteps)}},{key:"stopPolling",value:function(){this.waitTimer&&window.clearInterval(this.waitTimer),this.statusTimer&&window.clearInterval(this.statusTimer),this.watcherTimer&&window.clearTimeout(this.watcherTimer),this.statusCount=0,this.updateOnProgress(),this.stopListeningForPollingEvent()}}]),e}(),Le=1e4,Je=100,Fe=100,Me=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).monitoringTimer=void 0,n.monitoringStatusTimer=void 0,n.pollWatcherTimer=void 0,n.searchListenerID=void 0,n.pubsubProxy=void 0,n.poller=void 0,n.monitoringTimer=null,n.monitoringStatusTimer=null,n.pollWatcherTimer=null,n.searchListenerID=null,n.pubsubProxy=new xe(n.props.pubsub),n.poller=new Pe({onPoll:n.props.onPoll,onProgress:n.onProgress.bind(Object(Ie.a)(n)),pubsub:n.props.pubsub,pollInterval:Le,progressSteps:Je,watchInterval:Fe}),n.state={isMonitoring:!1,pollWaitProgress:0,isPollingInitiated:!1,pollingStartedAt:0,isPolling:!1,isOpen:n.props.startOpen},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"onProgress",value:function(e){this.setState({pollWaitProgress:e})}},{key:"componentDidMount",value:function(){var e=this;this.props.startPolling&&this.startMonitoring(),this.pubsubProxy.on("searching",function(t){t.is?e.setState({isPolling:!0}):e.setState({isPolling:!1})})}},{key:"componentWillUnmount",value:function(){this.stopMonitoring(),this.poller.stop(),this.pubsubProxy.off()}},{key:"componentDidUpdate",value:function(){}},{key:"startMonitoring",value:function(){this.setState({isMonitoring:!0}),this.poller.startPolling()}},{key:"stopMonitoring",value:function(){this.poller.stopPolling(),this.setState({isMonitoring:!1})}},{key:"toggleMonitoring",value:function(){this.state.isMonitoring?this.stopMonitoring():this.startMonitoring()}},{key:"onToggleOpen",value:function(e){this.setState({isOpen:e})}},{key:"render",value:function(){if(!this.props.showControls)return null;var e,t,n,r="Start Polling",i="default",s=a.createElement(W.a,{defaultChecked:this.state.isOpen,checkedChildren:"hide monitor",unCheckedChildren:"show monitor",onChange:this.onToggleOpen.bind(this)});return this.state.isMonitoring&&(r="Stop Polling",i="danger",e=this.state.isPolling?a.createElement("span",null," ",a.createElement(Ae.a,{type:"circle",percent:100,width:30,showInfo:!1,strokeWidth:30,strokeColor:"orange"})):a.createElement("span",null," ",a.createElement(Ae.a,{type:"circle",percent:this.state.pollWaitProgress,width:30,strokeWidth:30,showInfo:!1}))),t=this.state.isMonitoring?"Polling is running, with an interval of ".concat(Le,"ms and ").concat(Je," update steps."):"Polling is currently stopped.",this.state.isOpen&&(n=a.createElement(Q.a,{title:t},a.createElement(Z.a,{onClick:this.toggleMonitoring.bind(this),type:i,size:"small",style:{fontSize:"80%"}},r),e)),a.createElement("span",null,s," ",n)}}]),t}(a.Component),He=[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}];var ze=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).currentQuery=void 0,n.pubsub=void 0,n.currentQuery="",n.pubsub=new Ue,n.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRange},isFilterOpen:!1,selectedJob:null},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"componentDidUpdate",value:function(){this.props.searchState===A.SEARCHING?this.pubsub.send("searching",{is:!0}):this.pubsub.send("searching",{is:!1})}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},function(){t.doSearch(!0)}):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach(function(e){switch(e){case"queued":t.push(N.QUEUED);break;case"running":t.push(N.RUNNING);break;case"canceled":t.push(N.CANCELED);break;case"success":t.push(N.FINISHED);break;case"error":t.push(N.ERRORED)}}),t}(this.state.currentJobStatusFilter),n={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e};return this.pubsub.send("search",{}),this.props.search(n),!1}}},{key:"onRangeFromChange",value:function(e,t){if(null!==e){var n,r=this.state.timeRange;switch(r.kind){case"preset":n={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":n={kind:"literal",start:e.valueOf(),end:r.end};break;default:return}this.setState({timeRange:n})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"onRangeToChange",value:function(e,t){if(null!==e){var n,r=this.state.timeRange;switch(r.kind){case"preset":n={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":n={kind:"literal",start:r.start,end:e.valueOf()};break;default:return}this.setState({timeRange:n})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case N.QUEUED:case N.RUNNING:return i.a.createElement(X.a,{title:"Cancel this job?",onConfirm:function(){t.props.cancelJob(e.id)},okText:"Yes",cancelText:"No"},i.a.createElement(Z.a,{icon:"close",type:"danger"}));default:return}}},{key:"renderSearchInput",value:function(){var e,n=this;if(this.state.showDates){var r=this.state.timeRange;"literal"===r.kind&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(K.a.Item,{label:"From"},i.a.createElement($.a,{showTime:!0,allowClear:!1,value:te()(r.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(K.a.Item,{label:"To"},i.a.createElement($.a,{showTime:!0,allowClear:!1,value:te()(r.end),onChange:this.onRangeToChange.bind(this)}))))}return i.a.createElement(K.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(K.a.Item,null,i.a.createElement(Y.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(K.a.Item,{label:"TimeRange"}),i.a.createElement(K.a.Item,null,i.a.createElement(V.a,{defaultValue:t.defaultTimeRange,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(V.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(V.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(V.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(V.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(V.a.Option,{value:"customRange"},"Custom Range"))),e,i.a.createElement(K.a.Item,null,i.a.createElement(Z.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(K.a.Item,null,i.a.createElement(W.a,{checkedChildren:"hide filters",unCheckedChildren:"show filters",onChange:this.onToggleFilterArea.bind(this)})),i.a.createElement(K.a.Item,null,i.a.createElement(Me,{onPoll:function(){n.doSearch(!0)},pubsub:this.pubsub,startPolling:!0,isPollerRunning:this.props.searchState===A.SEARCHING,showControls:this.props.showMonitoringControls,startOpen:!0})))}},{key:"onToggleFilterArea",value:function(e){this.setState({isFilterOpen:e})}},{key:"onFilterChange",value:function(e){var t=this,n=e;this.setState({currentJobStatusFilter:n},function(){t.doSearch(!1)})}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){t.doSearch(!1)})}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},function(){e.doSearch(!1)})}},{key:"renderFilterInput",value:function(){var e=He;return i.a.createElement("div",{className:"UserJobs-filterArea"},i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement(Z.a,{size:"small",onClick:this.onClickAny.bind(this)},i.a.createElement("i",null,"Any"))," ",i.a.createElement(Z.a,{size:"small",onClick:this.onClickActive.bind(this)},i.a.createElement("i",null,"Active"))," ",i.a.createElement(Z.a,{size:"small",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"}},i.a.createElement("i",null,"Finished")),i.a.createElement(B.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter}))}},{key:"renderControlBar",value:function(){var e,t={margin:"10px 10px 10px 0"};return this.state.isFilterOpen||(t.display="none"),this.state.isFilterOpen&&(e=i.a.createElement("div",{className:"Row",style:t},this.renderFilterInput())),i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),e)}},{key:"onClickDetail",value:function(e){this.setState({selectedJob:e})}},{key:"onCloseModal",value:function(){this.setState({selectedJob:null})}},{key:"renderJobDetail",value:function(){if(this.state.selectedJob){var e=i.a.createElement(Z.a,{key:"cancel",onClick:this.onCloseModal.bind(this)},"Close"),t=i.a.createElement("span",null,"Detail for Job ",i.a.createElement("span",{style:{fontFamily:"monospace"}},"$",this.state.selectedJob.id)," ",i.a.createElement(ie,{jobStatus:this.state.selectedJob.status}));return i.a.createElement(q.a,{className:"FullScreenModal",title:t,onCancel:this.onCloseModal.bind(this),visible:!0,footer:e},i.a.createElement(Ne,{jobID:this.state.selectedJob.id}))}}},{key:"renderJobsTable",value:function(){var e=this,t=this.props.searchState===A.SEARCHING;return i.a.createElement(G.a,{size:"small",className:"UserJobs-table",dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0}},i.a.createElement(G.a.Column,{title:"Job ID",dataIndex:"id",key:"id",width:"5%",render:function(t,n){var r=t;return i.a.createElement(Q.a,{title:r},i.a.createElement("a",{href:"https://example.com",onClick:function(t){t.preventDefault(),e.onClickDetail(n)}},t))},sorter:function(e,t){return e.id.localeCompare(t.id)}}),i.a.createElement(G.a.Column,{title:"User",dataIndex:"username",key:"username",width:"10%",render:function(e){return i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e)},sorter:function(e,t){return e.username.localeCompare(t.username)}}),i.a.createElement(G.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){if(!e||!t.narrativeID)return"n/a";var n=["/narrative",t.narrativeID].join("/");return i.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},e)},sorter:function(e,t){return e.narrativeTitle?t.narrativeTitle?e.narrativeTitle.localeCompare(t.narrativeTitle):1:t.narrativeTitle?-1:0}}),i.a.createElement(G.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"18%",render:function(e,t){if(!e)return"n/a";var n="/#catalog/apps/"+t.appID;return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:n,target:"_parent"},e))},sorter:function(e,t){return e.appTitle?t.appTitle?e.appTitle.localeCompare(t.appTitle):1:t.appTitle?-1:0}}),i.a.createElement(G.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"8%",render:function(e,t){return e?i.a.createElement(m.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t){return null===e.queuedAt?null===t.queuedAt?0:-1:null===t.queuedAt?1:e.queuedAt-t.queuedAt}}),i.a.createElement(G.a.Column,{title:"Queued for",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"8%",render:function(e,t){switch(t.status){case N.QUEUED:return i.a.createElement(m.NiceElapsedTime,{from:t.queuedAt,precision:2,useClock:!0})}}}),i.a.createElement(G.a.Column,{title:"Run for",key:"runElapsed",width:"10%",render:function(e,t){switch(t.status){case N.QUEUED:return"-";case N.RUNNING:return i.a.createElement(m.NiceElapsedTime,{from:t.runAt,precision:2,useClock:!0});case N.FINISHED:case N.CANCELED:case N.ERRORED:return i.a.createElement(m.NiceElapsedTime,{from:t.runAt,to:t.finishAt,precision:2})}}}),i.a.createElement(G.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"8%",render:function(e){return i.a.createElement(ie,{jobStatus:e})},sorter:function(e,t){return e.status===t.status?0:e.status===N.QUEUED?-1:e.status===N.RUNNING?t.status===N.QUEUED?1:-1:e.status===N.FINISHED?t.status===N.QUEUED||t.status===N.RUNNING?1:-1:e.status===N.ERRORED&&t.status===N.CANCELED?-1:1}}),i.a.createElement(G.a.Column,{title:"Server Type",dataIndex:"clientGroups",key:"clientGroups",width:"8%",render:function(e){return e.join(",")},sorter:function(e,t){return e.clientGroups.join(",").localeCompare(t.clientGroups.join(","))}}),i.a.createElement(G.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,n){return e.renderJobAction(n)}}))}},{key:"render",value:function(){return i.a.createElement("div",{"data-k-b-testhook-component":"MyJobs"},i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,this.renderJobsTable()),this.renderJobDetail())}}]),t}(i.a.Component);ze.defaultTimeRange="lastWeek";var Ge=function(){function e(){Object(u.a)(this,e),this.pendingTasks=void 0,this.isCanceled=void 0,this.pendingTasks=new Map,this.isCanceled=!1}return Object(c.a)(e,[{key:"newID",value:function(){return De.a.v4()}},{key:"cancel",value:function(e){e.isCanceled=!0,this.pendingTasks.delete(e.id)}},{key:"cancelPending",value:function(){var e=this;this.pendingTasks.forEach(function(t,n){e.cancel(t)})}},{key:"done",value:function(e){this.pendingTasks.delete(e.id)}},{key:"spawn",value:function(e){return this.cancelPending(),this.request(e)}}]),e}();function Qe(){return{type:r.USER_JOBS_SEARCH_START}}function qe(e,t,n,a){return{type:r.USER_JOBS_SEARCH_SUCCESS,searchExpression:a,rawJobs:e,jobs:t,jobsFetchedAt:n}}function Be(e){return{type:r.USER_JOBS_SEARCH_ERROR,error:e}}var We=new(function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"request",value:function(e){var t=e.token,n=e.serviceWizardURL,r=e.from,a=e.to,i=new Se({url:n,token:t}).getJobs({epoch_range:[r,a],user_ids:[]}).then(function(e){return e.job_states.map(function(e){return ke(e,"UNKNOWN")})}),s={id:this.newID(),promise:i,isCanceled:!1};return this.pendingTasks.set(s.id,s),s}}]),t}(Ge));function Ve(e){return{type:r.USER_JOBS_CANCEL_ERROR,error:e}}var Ye=Object(J.connect)(function(e,t){var n=e.auth.userAuthorization,r=e.views.userJobsView,a=r.searchState,i=r.jobs;if(!n)throw new Error("Not authorized!");return{jobs:i,searchState:a,showMonitoringControls:n.roles.some(function(e){return"DevToken"===e})}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,r){var a,i,s,o,u,c,l,h,d,p,m,f,v,b;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n(Qe()),a=r(),i=a.auth.userAuthorization,s=a.app.config.services.ServiceWizard.url,i){t.next=5;break}return n(Be({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(o=r(),u=o.views.userJobsView,c=u.jobsFetchedAt,l=u.rawJobs,h=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=Re(e.timeRange),p=Object(se.a)(d,2),m=p[0],f=p[1],c&&!e.forceSearch){t.next=18;break}return v=We.spawn({token:i.token,serviceWizardURL:s,from:m,to:f}),t.next=12,v.promise;case 12:if(l=t.sent,!v.isCanceled){t.next=15;break}return t.abrupt("return");case 15:c=(new Date).getTime(),We.done(v),c=(new Date).getTime();case 18:b=l.filter(function(t){return h.every(function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)||e.test(t.id)})&&Ce(t,e.jobStatus)}),n(qe(l,b,c,e));case 20:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},cancelJob:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,a){var i,s,o;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.USER_JOBS_CANCEL_START}),i=a(),s=i.auth.userAuthorization,o=i.app.config.services.NarrativeJobService.url,s){t.next=5;break}return n(Ve({message:"no authorization",code:"no-authorization"})),t.abrupt("return");case 5:new we.NarrativeJobServiceClient({url:o,token:s.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then(function(){n({type:r.USER_JOBS_CANCEL_SUCCESS}),n(function(){var e=Object(ce.a)(ue.a.mark(function e(t,n){var r,a,i,s,o,u,c,l,h,d,p,m,f;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(Qe()),r=n(),a=r.auth.userAuthorization){e.next=5;break}return t(Be({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:if(i=n(),s=i.app.config.services.ServiceWizard.url,o=i.views.userJobsView.searchExpression){e.next=9;break}return Be({message:"No search expression",code:"nosearchexpression"}),e.abrupt("return");case 9:return u=o.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),c=Re(o.timeRange),l=Object(se.a)(c,2),h=l[0],d=l[1],p=We.spawn({token:a.token,serviceWizardURL:s,from:h,to:d}),e.next=14,p.promise;case 14:if(m=e.sent,!p.isCanceled){e.next=17;break}return e.abrupt("return");case 17:We.done(p),f=m.filter(function(e){return u.every(function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)})&&Ce(e,o.jobStatus)}),t(qe(m,f,Date.now(),o));case 20:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())}).catch(function(e){console.error("error canceling job",e),n(Ve({message:"error canceling job: "+e.message,code:"error-canceling"}))});case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(ze),Ke=(n(842),[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}]);var $e=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).currentQuery=void 0,n.pubsub=void 0,n.currentQuery="",n.pubsub=new Ue,n.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRangePreset},isFilterOpen:!1,selectedJob:null},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"componentDidUpdate",value:function(){this.props.searchState===A.SEARCHING?this.pubsub.send("searching",{is:!0}):this.pubsub.send("searching",{is:!1})}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},function(){t.doSearch(!0)}):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach(function(e){switch(e){case"queued":t.push(N.QUEUED);break;case"running":t.push(N.RUNNING);break;case"canceled":t.push(N.CANCELED);break;case"success":t.push(N.FINISHED);break;case"error":t.push(N.ERRORED)}}),t}(this.state.currentJobStatusFilter),n={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e};return this.pubsub.send("search",{}),this.props.search(n),!1}}},{key:"onRangeFromChange",value:function(e,t){if(null!==e){var n,r=this.state.timeRange;switch(r.kind){case"preset":n={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":n={kind:"literal",start:e.valueOf(),end:r.end};break;default:return}this.setState({timeRange:n})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"onRangeToChange",value:function(e,t){if(null!==e){var n,r=this.state.timeRange;switch(r.kind){case"preset":n={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":n={kind:"literal",start:r.start,end:e.valueOf()};break;default:return}this.setState({timeRange:n})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"renderSearchInput",value:function(){var e,n=this;if(this.state.showDates){var r=this.state.timeRange;"literal"===r.kind&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(K.a.Item,{label:"From"},i.a.createElement($.a,{showTime:!0,allowClear:!1,value:te()(r.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(K.a.Item,{label:"To"},i.a.createElement($.a,{showTime:!0,allowClear:!1,value:te()(r.end),onChange:this.onRangeToChange.bind(this)}))))}return i.a.createElement(K.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(K.a.Item,null,i.a.createElement(Y.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(K.a.Item,{label:"TimeRange"}),i.a.createElement(K.a.Item,null,i.a.createElement(V.a,{defaultValue:t.defaultTimeRangePreset,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(V.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(V.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(V.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(V.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(V.a.Option,{value:"customRange"},"Custom Range"))),e,i.a.createElement(K.a.Item,null,i.a.createElement(Z.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(K.a.Item,null,i.a.createElement(W.a,{checkedChildren:"hide filters",unCheckedChildren:"show filters",onChange:this.onToggleFilterArea.bind(this)})),i.a.createElement(K.a.Item,null,i.a.createElement(Me,{onPoll:function(){n.doSearch(!0)},pubsub:this.pubsub,isPollerRunning:this.props.searchState===A.SEARCHING,startPolling:!1,showControls:this.props.showMonitoringControls,startOpen:!1})))}},{key:"onToggleFilterArea",value:function(e){this.setState({isFilterOpen:e})}},{key:"onFilterChange",value:function(e){var t=this,n=e;this.setState({currentJobStatusFilter:n},function(){t.doSearch(!1)})}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){t.doSearch(!1)})}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},function(){e.doSearch(!1)})}},{key:"renderFilterInput",value:function(){var e=Ke;return i.a.createElement("div",{className:"MyJobs-filterArea"},i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement(Z.a,{size:"small",type:"link",onClick:this.onClickAny.bind(this),"data-k-b-testhook-button":"any"},i.a.createElement("i",null,"Any"))," ",i.a.createElement(Z.a,{size:"small",type:"link",onClick:this.onClickActive.bind(this),"data-k-b-testhook-button":"active"},i.a.createElement("i",null,"Active"))," ",i.a.createElement(Z.a,{size:"small",type:"link",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"},"data-k-b-testhook-button":"finished"},i.a.createElement("i",null,"Finished")),i.a.createElement(B.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter}))}},{key:"renderControlBar",value:function(){var e,t={margin:"10px 10px 10px 0"};return this.state.isFilterOpen||(t.display="none"),this.state.isFilterOpen&&(e=i.a.createElement("div",{className:"Row",style:t},this.renderFilterInput())),i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),e)}},{key:"onJobCancel",value:function(e){this.props.cancelJob(e.id)}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case N.QUEUED:case N.RUNNING:return i.a.createElement(X.a,{title:"Cancel this job?",onConfirm:function(){t.onJobCancel(e)},okText:"Yes",cancelText:"No"},i.a.createElement(Z.a,{icon:"close",type:"danger","data-k-b-testhook-button":"cancel"}));default:return}}},{key:"onClickDetail",value:function(e){this.setState({selectedJob:e})}},{key:"onCloseModal",value:function(){this.setState({selectedJob:null})}},{key:"renderJobsTable",value:function(){var e=this,t=this.props.searchState===A.SEARCHING;return i.a.createElement(G.a,{size:"small",className:"MyJobs-table",dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0}},i.a.createElement(G.a.Column,{title:"Job ID",dataIndex:"id",key:"id",width:"5%",render:function(t,n){var r=t;return i.a.createElement(Q.a,{title:r},i.a.createElement("a",{href:"https://example.com",onClick:function(t){t.preventDefault(),e.onClickDetail(n)}},t))},sorter:function(e,t){return e.id.localeCompare(t.id)}}),i.a.createElement(G.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){return e&&t.narrativeID?i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"/narrative/".concat(t.narrativeID),target:"_blank",rel:"noopener noreferrer"},e)):"n/a"},sorter:function(e,t){return e.narrativeTitle.localeCompare(t.narrativeTitle)}}),i.a.createElement(G.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"18%",render:function(e,t){if(!e)return"n/a";var n="/#catalog/apps/"+t.appID;return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:n},e))},sorter:function(e,t){return e.appTitle.localeCompare(t.appTitle)}}),i.a.createElement(G.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"10%",render:function(e,t){return e?i.a.createElement(m.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t){return null===e.queuedAt?null===t.queuedAt?0:-1:null===t.queuedAt?1:e.queuedAt-t.queuedAt}}),i.a.createElement(G.a.Column,{title:"Queued for",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"10%",render:function(e,t){switch(t.status){case N.QUEUED:return i.a.createElement(m.NiceElapsedTime,{from:t.queuedAt,precision:2,useClock:!0});default:return i.a.createElement(m.NiceElapsedTime,{from:t.queuedAt,to:t.runAt,precision:2})}}}),i.a.createElement(G.a.Column,{title:"Run for",key:"runElapsed",width:"10%",render:function(e,t){switch(t.status){case N.QUEUED:return"-";case N.RUNNING:return i.a.createElement(m.NiceElapsedTime,{from:t.runAt,precision:2,useClock:!0});case N.FINISHED:case N.CANCELED:case N.ERRORED:return i.a.createElement(m.NiceElapsedTime,{from:t.runAt,to:t.finishAt,precision:2})}}}),i.a.createElement(G.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"10%",render:function(e){return i.a.createElement(ie,{jobStatus:e})},sorter:function(e,t){return e.status===t.status?0:e.status===N.QUEUED?-1:e.status===N.RUNNING?t.status===N.QUEUED?1:-1:e.status===N.FINISHED?t.status===N.QUEUED||t.status===N.RUNNING?1:-1:e.status===N.ERRORED&&t.status===N.CANCELED?-1:1}}),i.a.createElement(G.a.Column,{title:"Server Type",dataIndex:"clientGroups",key:"clientGroups",width:"10%",render:function(e){return e.join(",")},sorter:function(e,t){return e.clientGroups.join(",").localeCompare(t.clientGroups.join(","))}}),i.a.createElement(G.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,n){return e.renderJobAction(n)}}))}},{key:"renderJobDetail",value:function(){if(this.state.selectedJob){var e=i.a.createElement(Z.a,{key:"cancel",onClick:this.onCloseModal.bind(this)},"Close"),t=i.a.createElement("span",null,"Detail for Job ",i.a.createElement("span",{style:{fontFamily:"monospace"}},"$",this.state.selectedJob.id)," ",i.a.createElement(ie,{jobStatus:this.state.selectedJob.status}));return i.a.createElement(q.a,{className:"FullScreenModal",title:t,onCancel:this.onCloseModal.bind(this),visible:!0,footer:e},i.a.createElement(Ne,{jobID:this.state.selectedJob.id}))}}},{key:"render",value:function(){return i.a.createElement("div",{"data-k-b-testhook-component":"MyJobs"},i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,this.renderJobsTable()),this.renderJobDetail())}}]),t}(i.a.Component);function Xe(){return{type:r.MY_JOBS_SEARCH_START}}function Ze(e,t,n,a){return{type:r.MY_JOBS_SEARCH_SUCCESS,searchExpression:a,rawJobs:e,jobs:t,jobsFetchedAt:n}}function et(e){return{type:r.MY_JOBS_SEARCH_ERROR,error:e}}$e.defaultTimeRangePreset="lastWeek";var tt=new(function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"request",value:function(e){var t=e.token,n=e.username,r=e.serviceWizardURL,a=e.from,i=e.to,s=new Se({url:r,token:t}).getJobs({epoch_range:[a,i],user_ids:[n]}).then(function(e){return e.job_states.map(function(e){return ke(e,n)})}),o={id:this.newID(),promise:s,isCanceled:!1};return this.pendingTasks.set(o.id,o),o}}]),t}(Ge));function nt(){return function(){var e=Object(ce.a)(ue.a.mark(function e(t,n){var r,a,i,s,o,u,c,l,h,d,p,m,f;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(Xe()),r=n(),a=r.auth.userAuthorization){e.next=5;break}return t(et({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:if(i=n(),s=i.app.config.services.ServiceWizard.url,o=i.views.myJobsView.searchExpression){e.next=9;break}return et({message:"No search expression",code:"nosearchexpression"}),e.abrupt("return");case 9:return u=Re(o.timeRange),c=Object(se.a)(u,2),l=c[0],h=c[1],d=o.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),p=tt.spawn({token:a.token,username:a.username,serviceWizardURL:s,from:l,to:h}),e.next=14,p.promise;case 14:if(m=e.sent,!p.isCanceled){e.next=17;break}return e.abrupt("return");case 17:tt.done(p),f=m.filter(function(e){return d.every(function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)})&&Ce(e,o.jobStatus)}),t(Ze(m,f,Date.now(),o));case 20:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}function rt(e){return{type:r.MY_JOBS_CANCEL_ERROR,error:e}}var at=Object(J.connect)(function(e,t){var n=e.auth.userAuthorization,r=e.views.myJobsView,a=r.searchState,i=r.jobs;if(!n)throw new Error("Not authorized!");return{jobs:i,searchState:a,showMonitoringControls:n.roles.some(function(e){return"DevToken"===e})}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,r){var a,i,s,o,u,c,l,h,d,p,m,f,v,b;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n(Xe()),a=r(),i=a.auth.userAuthorization){t.next=5;break}return n(et({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(s=r(),o=s.app.config.services.ServiceWizard.url,u=s.views.myJobsView,c=u.jobsFetchedAt,l=u.rawJobs,h=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=Re(e.timeRange),p=Object(se.a)(d,2),m=p[0],f=p[1],c&&!e.forceSearch){t.next=17;break}return v=tt.spawn({token:i.token,username:i.username,serviceWizardURL:o,from:m,to:f}),t.next=12,v.promise;case 12:if(l=t.sent,!v.isCanceled){t.next=15;break}return t.abrupt("return");case 15:c=(new Date).getTime(),tt.done(v);case 17:b=l.filter(function(t){return h.every(function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)})&&Ce(t,e.jobStatus)}),n(Ze(l,b,c,e));case 19:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},cancelJob:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,a){var i,s,o;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.MY_JOBS_CANCEL_START}),i=a(),s=i.auth.userAuthorization,o=i.app.config.services.NarrativeJobService.url,s){t.next=5;break}return n(rt({message:"no authorization",code:"no-authorization"})),t.abrupt("return");case 5:new we.NarrativeJobServiceClient({url:o,token:s.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then(function(){n({type:r.MY_JOBS_CANCEL_SUCCESS}),n(nt())}).catch(function(e){console.error("error canceling job",e),n(rt({message:"error canceling job: "+e.message,code:"error-canceling"}))});case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},refreshSearch:function(){e(nt())}}})($e),it=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery="",n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearch({query:this.currentQuery})}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.onSearch({query:this.currentQuery})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(K.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(K.a.Item,null,i.a.createElement(Y.a,{defaultValue:this.currentQuery,placeholder:"Search App Stats (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(K.a.Item,null,i.a.createElement(Z.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"onTableChange",value:function(e,t,n){}},{key:"renderAppStatsTable",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,i.a.createElement(G.a,{dataSource:this.props.appStats,loading:this.props.searchState===A.SEARCHING,rowKey:function(e){return e.appId},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable",onChange:this.onTableChange},i.a.createElement(G.a.Column,{title:"Module",dataIndex:"moduleId",key:"moduleId",width:"25%",render:function(e,t){return i.a.createElement(Q.a,{title:t.moduleTitle},i.a.createElement("a",{href:"#catalog/module/".concat(e)},t.moduleTitle))},sorter:function(e,t){return e.moduleTitle.localeCompare(t.moduleTitle)},defaultSortOrder:"ascend"}),i.a.createElement(G.a.Column,{title:"Function",dataIndex:"functionId",key:"functionId",width:"25%",render:function(e,t){return i.a.createElement(Q.a,{title:t.functionTitle},i.a.createElement("a",{href:"#catalog/apps/".concat(t.moduleId,"/").concat(t.functionId)},t.functionTitle))},sorter:function(e,t){return e.functionTitle.localeCompare(t.functionTitle)}}),i.a.createElement(G.a.Column,{title:"Runs",dataIndex:"runCount",key:"runCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount}}),i.a.createElement(G.a.Column,{title:"Errors",dataIndex:"errorCount",key:"errorCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.errorCount-t.errorCount}}),i.a.createElement(G.a.Column,{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:"10%",render:function(e){return i.a.createElement(Ae.a,{percent:100*e,format:function(t){return new Intl.NumberFormat("en-US",{style:"percent"}).format(e)}})},sorter:function(e,t){return e.successRate-t.successRate}}),i.a.createElement(G.a.Column,{title:"Avg Run Time",dataIndex:"averageRunTime",key:"averageRunTime",width:"10%",render:function(e){return i.a.createElement(m.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageRunTime-t.averageRunTime}}),i.a.createElement(G.a.Column,{title:"Avg Queue Time",dataIndex:"averageQueueTime",key:"averageQueueTime",width:"10%",render:function(e){return i.a.createElement(m.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageQueueTime-t.averageQueueTime}}),i.a.createElement(G.a.Column,{title:"Total Run Time",dataIndex:"totalRunTime",key:"totalRunTime",width:"10%",render:function(e){return i.a.createElement(m.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.totalRunTime-t.totalRunTime}}))))}},{key:"render",value:function(){return i.a.createElement("div",null,this.renderAppStatsTable())}}]),t}(i.a.Component);function st(e,t){return e?t?e/t:null:t?0:null}function ot(e){return{type:r.PUBLIC_APP_STATS_SEARCH_ERROR,error:e}}var ut=Object(J.connect)(function(e,t){var n=e.views.publicAppStatsView,r=n.appStats;return{searchState:n.searchState,appStats:r}},function(e,t){return{onSearch:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,a){var i,s,o,u,c,l,h,d;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.PUBLIC_APP_STATS_SEARCH_START}),i=a(),s=i.auth.userAuthorization,o=i.app.config.services.Catalog.url,s){t.next=5;break}return n(ot({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(s){t.next=8;break}return n(ot({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 8:return u=new we.CatalogClient({module:"Catalog",token:s.token,url:o}),t.next=11,u.getExecAggrStats({});case 11:c=t.sent,l=c.map(function(e){var t=e.full_app_id.split("/"),n=Object(se.a)(t,2),r=n[0],a=n[1];r&&a||console.warn("bad app!",e);var i,s,o=(i=e.number_of_calls-e.number_of_errors,s=e.number_of_calls,i?s?i/s:null:s?0:null),u=st(e.total_exec_time,e.number_of_calls),c=st(e.total_queue_time,e.number_of_calls);return{appId:e.full_app_id,moduleId:r,functionId:a||"",moduleTitle:r,functionTitle:a||"",runCount:e.number_of_calls,errorCount:e.number_of_errors,successRate:o,averageRunTime:u,averageQueueTime:c,totalRunTime:e.total_queue_time}}),h=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=l.filter(function(e){return h.every(function(t){return t.test(e.moduleTitle)||t.test(e.moduleId)||t.test(e.functionTitle)||t.test(e.functionId)})}),n((p=d,{type:r.PUBLIC_APP_STATS_SEARCH_SUCCESS,appStats:p}));case 16:case"end":return t.stop()}var p},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(it),ct=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery={query:""},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.search(this.currentQuery)}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.search(this.currentQuery)}},{key:"onChangeQuery",value:function(e){this.currentQuery.query=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(K.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(K.a.Item,null,i.a.createElement(Y.a,{defaultValue:this.currentQuery.query,placeholder:"Search (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(K.a.Item,null,i.a.createElement(Z.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"renderTable",value:function(){return i.a.createElement(G.a,{dataSource:this.props.userRunSummary,loading:this.props.searchState===A.SEARCHING,rowKey:function(e){return e.username+"."+e.appId},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable"},i.a.createElement(G.a.Column,{title:"User",dataIndex:"username",key:"username",width:"30%",render:function(e,t){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.username.localeCompare(t.username)}}),i.a.createElement(G.a.Column,{title:"Module",dataIndex:"moduleId",key:"moduleId",width:"30%",render:function(e){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#catalog/module/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.moduleId.localeCompare(t.moduleId)}}),i.a.createElement(G.a.Column,{title:"Function",dataIndex:"functionId",key:"functionId",width:"30%",render:function(e,t){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#catalog/apps/".concat(t.appId),target:"_parent"},e))},sorter:function(e,t){return e.functionId.localeCompare(t.functionId)}}),i.a.createElement(G.a.Column,{title:"Runs",dataIndex:"runCount",key:"runCount",width:"10%",align:"right",render:function(e,t){return i.a.createElement("div",{className:"NumericColumn"},Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount},defaultSortOrder:"descend"}))}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null," ",this.renderTable()))}}]),t}(i.a.Component);function lt(e){return{type:r.USER_RUN_SUMMARY_SEARCH_ERROR,error:e}}var ht=Object(J.connect)(function(e,t){var n=e.views.userRunSummaryView;return{searchState:n.searchState,userRunSummary:n.userRunSummary}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(ce.a)(ue.a.mark(function t(n,a){var i,s,o,u,c,l,h,d,p;return ue.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.USER_RUN_SUMMARY_SEARCH_START}),i=a(),s=i.auth.userAuthorization,o=i.app.config.services.Catalog.url,s){t.next=5;break}return n(lt({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(s){t.next=8;break}return n(lt({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 8:return u=new we.CatalogClient({module:"Catalog",token:s.token,url:o}),c={begin:0,end:Date.now()},t.next=12,u.getExecAggrTable(c);case 12:l=t.sent,h=l.map(function(e){var t,n,r;if(e.app){var a=e.app.split("/"),i=Object(se.a)(a,2);n=i[0],r=i[1],t=e.app}else t=[n=e.func_mod,r=e.func].join("/");return n&&r||console.warn("bad app!",e),{username:e.user,appId:t,moduleId:n,functionId:r,runCount:e.n}}),d=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),p=h.filter(function(e){return d.every(function(t){return t.test(e.appId)||t.test(e.moduleId)||t.test(e.functionId)||t.test(e.username)})}),n((m=p,{type:r.USER_RUN_SUMMARY_SEARCH_SUCCESS,userRunSummary:m}));case 17:case"end":return t.stop()}var m},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(ct),dt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).defaultTabKey=void 0,n.defaultTabKey="myJobs",n.state={activeTabKey:n.defaultTabKey,defaultActiveTabKey:n.defaultTabKey},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.setTitle("Job Browser")}},{key:"componentWillUnmount",value:function(){this.setState({activeTabKey:null})}},{key:"onTabsChange",value:function(e){this.setState({activeTabKey:e})}},{key:"renderJobsTab",value:function(){}},{key:"renderAdminJobsTab",value:function(){}},{key:"renderTabs",value:function(){var e,t;if(this.props.isAdmin){var n=i.a.createElement("span",null,"User Run Summary ",i.a.createElement(z.a,{type:"unlock"}));e=i.a.createElement(H.a.TabPane,{tab:n,key:"userRunSummary"},i.a.createElement(ht,null));var r=i.a.createElement("span",null,"User Jobs ",i.a.createElement(z.a,{type:"unlock"}));t=i.a.createElement(H.a.TabPane,{tab:r,key:"userJobs"},i.a.createElement(Ye,null))}return i.a.createElement(H.a,{animated:!1,activeKey:this.props.params.tab||this.state.activeTabKey||void 0,onChange:this.onTabsChange.bind(this),destroyInactiveTabPane:!0},i.a.createElement(H.a.TabPane,{tab:"My Jobs",key:"myJobs"},i.a.createElement(at,null)),i.a.createElement(H.a.TabPane,{tab:"Public App Stats",key:"publicAppStats"},i.a.createElement(ut,null)),t,e)}},{key:"render",value:function(){return i.a.createElement("div",{className:"Col Col-scrollable"},this.renderTabs())}}]),t}(i.a.Component);var pt=Object(J.connect)(function(e,t){var n=e.views.mainView.isAdmin,r=e.app.runtime.navigation;return{isAdmin:n,view:r.view,params:r.params}},function(e,t){return{setTitle:function(t){e(Object(m.sendTitle)(t))},setView:function(t){e(Object(m.setView)(t))},setParams:function(t){e(Object(m.setParams)(t))}}})(dt);function mt(e){return{type:r.MAIN_LOAD_SUCCESS,isAdmin:e}}function ft(e){return{type:r.MAIN_LOAD_ERROR,error:e}}var vt=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){var e=a.createElement("div",null,"Loading Main ... ",a.createElement(M.a,null));return a.createElement(F.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return a.createElement(F.a,{type:"error",message:this.props.view.error.message})}},{key:"render",value:function(){switch(this.props.view.loadingState){case I.NONE:case I.LOADING:return this.renderLoading();case I.ERROR:return this.renderError();case I.SUCCESS:return a.createElement(pt,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case I.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.unload()}}]),t}(a.Component);var bt=Object(J.connect)(function(e,t){var n=e.auth.userAuthorization;return{view:e.views.mainView,token:n.token}},function(e,t){return{onLoad:function(){e(function(){var e=Object(ce.a)(ue.a.mark(function e(t,n){var a,i,s,o,u;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:r.MAIN_LOAD_START}),a=n(),i=a.auth.userAuthorization,s=a.app.config.services.Catalog.url,i){e.next=5;break}return t(ft({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:return o=new we.CatalogClient({token:i.token,url:s,module:"Catalog"}),e.prev=6,e.next=9,o.isAdmin();case 9:u=e.sent,t(mt(!!u)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(ft({message:e.t0.message,code:"error-checking-admin-status"}));case 16:case"end":return e.stop()}},e,null,[[6,13]])}));return function(t,n){return e.apply(this,arguments)}}())},unload:function(){e({type:r.MAIN_UNLOAD})}}})(vt),Et=(n(843),Object(x.d)(D,L(),Object(x.c)(Object(x.a)(U.a)))),gt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(J.Provider,{store:Et},i.a.createElement(m.AppBase,null,i.a.createElement(m.AuthGate,{required:!0},i.a.createElement(bt,null))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(gt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[412,1,2]]]);
//# sourceMappingURL=main.97f77e8e.chunk.js.map