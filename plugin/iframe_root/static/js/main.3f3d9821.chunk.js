(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{389:function(e,t,n){e.exports=n(784)},394:function(e,t,n){},762:function(e,t,n){},779:function(e,t,n){},780:function(e,t,n){},782:function(e,t,n){},783:function(e,t,n){},784:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),u=n(10),o=n.n(u),s=(n(394),n(42)),c=n(43),l=n(45),m=n(44),d=n(46),p=n(74),h=n(25);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}!function(e){e.MAIN_LOAD="main load",e.MAIN_LOAD_START="main load start",e.MAIN_LOAD_SUCCESS="main load success",e.MAIN_LOAD_ERROR="main load error",e.MAIN_UNLOAD="main/unload",e.MY_JOBS_SEARCH="my jobs search",e.MY_JOBS_SEARCH_START="my jobs search start",e.MY_JOBS_SEARCH_SUCCESS="my jobs search success",e.MY_JOBS_SEARCH_ERROR="my jobs search error",e.My_JOBS_REFRESH_SEARCH="my jobs refresh search",e.MY_JOBS_CANCEL="my jobs cancel",e.MY_JOBS_CANCEL_START="my jobs cancel start",e.MY_JOBS_CANCEL_SUCCESS="my jobs cancel success",e.MY_JOBS_CANCEL_ERROR="my jobs cancel error",e.USER_JOBS_SEARCH="user jobs search",e.USER_JOBS_SEARCH_START="user jobs search start",e.USER_JOBS_SEARCH_SUCCESS="user jobs search success",e.USER_JOBS_SEARCH_ERROR="user jobs search error",e.USER_JOBS_CANCEL="user jobs cancel",e.USER_JOBS_CANCEL_START="user jobs cancel start",e.USER_JOBS_CANCEL_SUCCESS="user jobs cancel success",e.USER_JOBS_CANCEL_ERROR="user jobs cancel error",e.PUBLIC_APP_STATS_SEARCH="publicAppStats/Search",e.PUBLIC_APP_STATS_SEARCH_START="publicAppStats/Search/Start",e.PUBLIC_APP_STATS_SEARCH_ERROR="publicAppStats/Search/Error",e.PUBLIC_APP_STATS_SEARCH_SUCCESS="publicAppStats/Search/Success",e.USER_RUN_SUMMARY_SEARCH="userRunSummary/Search",e.USER_RUN_SUMMARY_SEARCH_START="userRunSummary/Search/Start",e.USER_RUN_SUMMARY_SEARCH_ERROR="userRunSummary/Search/Error",e.USER_RUN_SUMMARY_SEARCH_SUCCESS="userRunSummary/Search/Success"}(r||(r={}));var b=function(e,t){if(!e)return e;switch(t.type){case r.MY_JOBS_SEARCH_SUCCESS:return function(e,t){return E({},e,{views:E({},e.views,{myJobsView:E({},e.views.myJobsView,{searchState:N.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case r.MY_JOBS_SEARCH_START:return function(e,t){return E({},e,{views:E({},e.views,{myJobsView:E({},e.views.myJobsView,{searchState:N.SEARCHING})})})}(e);case r.MY_JOBS_CANCEL_SUCCESS:return function(e,t){return E({},e,{views:E({},e.views,{myJobsView:E({},e.views.myJobsView)})})}(e)}};function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e,t){if(!e)return e;switch(t.type){case r.USER_JOBS_SEARCH_START:return function(e,t){return v({},e,{views:v({},e.views,{userJobsView:v({},e.views.userJobsView,{searchState:N.SEARCHING})})})}(e);case r.USER_JOBS_SEARCH_SUCCESS:return function(e,t){return v({},e,{views:v({},e.views,{userJobsView:v({},e.views.userJobsView,{searchState:N.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case r.USER_JOBS_CANCEL_START:case r.USER_JOBS_CANCEL_SUCCESS:return function(e,t){return v({},e,{views:v({},e.views,{userJobsView:v({},e.views.userJobsView)})})}(e)}};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var R=function(e,t){if(!e)return e;switch(t.type){case r.MAIN_LOAD_SUCCESS:return function(e,t){return C({},e,{views:C({},e.views,{mainView:C({},e.views.mainView,{loadingState:T.SUCCESS,isAdmin:t.isAdmin})})})}(e,t);case r.MAIN_UNLOAD:return function(e,t){return C({},e,{views:C({},e.views,{mainView:{loadingState:T.NONE,isAdmin:!1,error:null}})})}(e)}};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _=function(e,t){if(!e)return e;switch(t.type){case r.PUBLIC_APP_STATS_SEARCH_START:return function(e,t){return O({},e,{views:O({},e.views,{publicAppStatsView:O({},e.views.publicAppStatsView,{searchState:N.SEARCHING})})})}(e);case r.PUBLIC_APP_STATS_SEARCH_SUCCESS:return function(e,t){return O({},e,{views:O({},e.views,{publicAppStatsView:O({},e.views.publicAppStatsView,{searchState:N.SEARCHED,appStats:t.appStats})})})}(e,t)}};function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var j,N,T,I=function(e,t){if(!e)return e;switch(t.type){case r.USER_RUN_SUMMARY_SEARCH_START:return function(e,t){return A({},e,{views:A({},e.views,{userRunSummaryView:A({},e.views.userRunSummaryView,{searchState:N.SEARCHING})})})}(e);case r.USER_RUN_SUMMARY_SEARCH_SUCCESS:return function(e,t){return A({},e,{views:A({},e.views,{userRunSummaryView:A({},e.views.userRunSummaryView,{searchState:N.SEARCHED,userRunSummary:t.userRunSummary})})})}(e,t)}},U=function(e,t){var n=Object(h.baseReducer)(e,t);return n||R(e,t)||b(e,t)||y(e,t)||_(e,t)||I(e,t)||e},D=n(137),J=n(385);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function P(){var e=[];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Object(h.makeBaseStoreState)(),{views:{mainView:{loadingState:T.NONE,error:null,isAdmin:!1},myJobsView:{searchState:N.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},userJobsView:{searchState:N.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},publicAppStatsView:{searchState:N.NONE,rawAppStats:[],appStats:[],query:{query:""}},userRunSummaryView:{searchState:N.NONE,userRunSummary:[],query:{query:""}}}})}!function(e){e.QUEUED="QUEUED",e.RUNNING="RUNNING",e.FINISHED="FINISHED",e.ERRORED="ERRORED",e.CANCELED="CANCELED"}(j||(j={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SEARCHED=2]="SEARCHED",e[e.ERROR=3]="ERROR"}(N||(N={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(T||(T={}));var M=n(48),H=(n(358),n(162)),L=(n(264),n(132)),F=(n(759),n(146)),q=(n(265),n(13)),Q=(n(762),n(158),n(56)),B=(n(160),n(24)),z=(n(266),n(86)),V=(n(267),n(52)),G=(n(159),n(101)),Y=(n(184),n(37)),W=(n(361),n(142)),K=(n(362),n(197)),$=(n(98),n(34)),X=(n(268),n(136)),Z=n(15),ee=n.n(Z),te=n(68),ne=(n(779),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderJobLogLines",value:function(){return i.a.createElement(B.a,{dataSource:this.props.log.lines,size:"small",rowKey:function(e){return String(e.lineNumber)},pagination:{position:"top",showSizeChanger:!0},rowClassName:function(e){return e.isError?"JobLog-errorRow":"JobLog-normalRow"}},i.a.createElement(B.a.Column,{title:"Row",dataIndex:"lineNumber",key:"lineNumber",width:"8%",render:function(e,t){var n=new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e);return t.isError?i.a.createElement("span",{className:"JobLog-errorText"},n):n},sorter:function(e,t){return e.lineNumber-t.lineNumber}}),i.a.createElement(B.a.Column,{title:"Log line",dataIndex:"line",key:"line",width:"92%",render:function(e,t){var n;return n=t.isError?i.a.createElement("span",{className:"JobLog-errorText"},e):i.a.createElement("span",null,e),i.a.createElement(Q.a,{title:e},n)}}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"JobLog"},this.renderJobLogLines())}}]),t}(i.a.Component)),re=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).state={log:{isLoaded:!1,lines:[]}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;new h.NarrativeJobServiceClient({token:this.props.token,url:this.props.njsURL,module:"NarrativeJobService"}).getJobLogs({job_id:this.props.jobId,skip_lines:0}).then(function(t){var n=Object(te.a)(t,1)[0].lines.map(function(e,t){return{lineNumber:t+1,line:e.line,isError:!!e.is_error}});e.setState({log:{isLoaded:!0,lines:n}})}).catch(function(e){console.error("boo",e)})}},{key:"render",value:function(){return this.state.log.isLoaded?i.a.createElement(ne,{log:this.state.log}):i.a.createElement("div",null,"Loading ... ",i.a.createElement(L.a,null))}}]),t}(i.a.Component);var ae=Object(M.connect)(function(e,t){var n=e.auth.userAuthorization,r=e.app.config.services.NarrativeJobService.url;if(!n)throw new Error("Invalid state: token required");return{token:n.token,njsURL:r}},function(e,t){return{}})(re),ie=(n(780),n(360),n(201)),ue=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).monitoringTimer=void 0,n.monitoringStatusTimer=void 0,n.monitoringTimer=null,n.monitoringStatusTimer=null,n.state={isMonitoring:!1,monitoringStatusCount:0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.startMonitoring&&this.startMonitoring()}},{key:"componentWillUnmount",value:function(){this.stopMonitoring()}},{key:"startMonitoring",value:function(){var e=this;this.monitoringTimer=window.setInterval(function(){e.props.onPoll(),e.setState({monitoringStatusCount:0})},1e4),this.setState({monitoringStatusCount:0,isMonitoring:!0}),this.monitoringStatusTimer=window.setInterval(function(){e.setState({monitoringStatusCount:e.state.monitoringStatusCount+1})},100)}},{key:"stopMonitoring",value:function(){this.monitoringTimer&&window.clearInterval(this.monitoringTimer),this.monitoringStatusTimer&&window.clearInterval(this.monitoringStatusTimer),this.setState({monitoringStatusCount:0,isMonitoring:!1})}},{key:"toggleMonitoring",value:function(){this.state.isMonitoring?this.stopMonitoring():this.startMonitoring()}},{key:"render",value:function(){var e,t="Start Monitoring",n="default";if(this.state.isMonitoring){t="Stop Monitoring",n="danger";var r=100*this.state.monitoringStatusCount/100;e=a.createElement("span",null," ",a.createElement(ie.a,{percent:r,style:{width:"10em"},showInfo:!1}))}return a.createElement("span",null,a.createElement($.a,{onClick:this.toggleMonitoring.bind(this),type:n},t),e)}}]),t}(a.Component),oe=[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}];function se(e){var t=function(e){switch(e){case j.QUEUED:return i.a.createElement("span",null,i.a.createElement(q.a,{type:"loading",spin:!0})," Queued");case j.RUNNING:return i.a.createElement("span",null,i.a.createElement(q.a,{type:"loading-3-quarters",spin:!0})," Running");case j.CANCELED:return"Canceled";case j.FINISHED:return"Success";case j.ERRORED:return"Errored";default:return"UNKNOWN ("+e+")"}}(e),n=function(e){switch(e){case j.QUEUED:return"orange";case j.RUNNING:return"blue";case j.CANCELED:return"gray";case j.FINISHED:return"green";case j.ERRORED:return"red";default:return"UNKNOWN"}}(e);return i.a.createElement(X.a,{color:n},t)}var ce=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery="",n.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRange}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},function(){t.doSearch(!0)}):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach(function(e){switch(e){case"queued":t.push(j.QUEUED);break;case"running":t.push(j.RUNNING);break;case"canceled":t.push(j.CANCELED);break;case"success":t.push(j.FINISHED);break;case"error":t.push(j.ERRORED)}}),t}(this.state.currentJobStatusFilter),n={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e};return this.props.search(n),!1}}},{key:"onRangeFromChange",value:function(e){var t,n=this.state.timeRange;switch(n.kind){case"preset":t={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":t={kind:"literal",start:e.valueOf(),end:n.end};break;default:return}this.setState({timeRange:t})}},{key:"onRangeToChange",value:function(e){var t,n=this.state.timeRange;switch(n.kind){case"preset":t={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":t={kind:"literal",start:n.start,end:e.valueOf()};break;default:return}this.setState({timeRange:t})}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case j.QUEUED:case j.RUNNING:return i.a.createElement(K.a,{title:"Cancel this job?",onConfirm:function(){t.props.cancelJob(e.id)},okText:"Yes",cancelText:"No"},i.a.createElement($.a,{icon:"close",type:"danger"}));default:return}}},{key:"renderSearchInput",value:function(){var e,n=this;if(this.state.showDates){var r=this.state.timeRange;"literal"===r.kind&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.a.Item,{label:"From"},i.a.createElement(W.a,{showTime:!0,allowClear:!1,value:ee()(r.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(Y.a.Item,{label:"To"},i.a.createElement(W.a,{showTime:!0,allowClear:!1,value:ee()(r.end),onChange:this.onRangeToChange.bind(this)}))))}return i.a.createElement(Y.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(Y.a.Item,null,i.a.createElement(G.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(Y.a.Item,{label:"TimeRange"}),i.a.createElement(Y.a.Item,null,i.a.createElement(V.a,{defaultValue:t.defaultTimeRange,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(V.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(V.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(V.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(V.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(V.a.Option,{value:"customRange"},"Custom Range"))),e,i.a.createElement(Y.a.Item,null,i.a.createElement($.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(Y.a.Item,null,i.a.createElement(ue,{onPoll:function(){n.doSearch(!0)},startMonitoring:!0})))}},{key:"onFilterChange",value:function(e){var t=this,n=e;this.setState({currentJobStatusFilter:n},function(){t.doSearch(!1)})}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){t.doSearch(!1)})}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},function(){e.doSearch(!1)})}},{key:"renderFilterInput",value:function(){var e=oe;return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement($.a,{size:"small",onClick:this.onClickAny.bind(this)},i.a.createElement("i",null,"Any"))," ",i.a.createElement($.a,{size:"small",onClick:this.onClickActive.bind(this)},i.a.createElement("i",null,"Active"))," ",i.a.createElement($.a,{size:"small",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"}},i.a.createElement("i",null,"Finished")),i.a.createElement(z.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter})))}},{key:"renderControlBar",value:function(){return i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),i.a.createElement("div",{className:"Row",style:{margin:"10px auto"}},this.renderFilterInput()))}},{key:"render",value:function(){var e=this,t=this.props.searchState===N.SEARCHING;return i.a.createElement("div",null,i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,i.a.createElement(B.a,{dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"UserJobs-table",expandIcon:function(e){var t;return t=e.expanded?i.a.createElement(q.a,{type:"folder-open"}):i.a.createElement(q.a,{type:"folder"}),i.a.createElement($.a,{type:"link",className:"expand-row-icon",onClick:function(t){return e.onExpand(e.record,t)}},t)},expandedRowRender:function(e){return i.a.createElement(ae,{jobId:e.id})}},i.a.createElement(B.a.Column,{title:"User",dataIndex:"username",key:"username",width:"10%",render:function(e){return i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e)},sorter:function(e,t){return e.username.localeCompare(t.username)}}),i.a.createElement(B.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){if(!e||!t.narrativeID)return"n/a";var n=["/narrative",t.narrativeID].join("/");return i.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},e)},sorter:function(e,t){return e.narrativeTitle?t.narrativeTitle?e.narrativeTitle.localeCompare(t.narrativeTitle):1:t.narrativeTitle?-1:0}}),i.a.createElement(B.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"18%",render:function(e,t){if(!e)return"n/a";var n="/#catalog/apps/"+t.appID;return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:n,target:"_parent"},e))},sorter:function(e,t){return e.appTitle?t.appTitle?e.appTitle.localeCompare(t.appTitle):1:t.appTitle?-1:0}}),i.a.createElement(B.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"8%",render:function(e,t){return e?i.a.createElement(h.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t){return null===e.queuedAt?null===t.queuedAt?0:-1:null===t.queuedAt?1:e.queuedAt-t.queuedAt}}),i.a.createElement(B.a.Column,{title:"Queued for",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"8%",render:function(e){return i.a.createElement(h.NiceTimeDuration,{duration:e,precision:2})},sorter:function(e,t){return null===e.queuedElapsed?null===t.queuedElapsed?0:-1:null===t.queuedElapsed?1:e.queuedElapsed-t.queuedElapsed}}),i.a.createElement(B.a.Column,{title:"Run for",dataIndex:"runElapsed",key:"runElapsed",width:"8%",render:function(e){return null===e?"-":i.a.createElement(h.NiceTimeDuration,{duration:e,precision:2})},sorter:function(e,t){return null===e.runElapsed?null===t.runElapsed?0:-1:null===t.runElapsed?1:e.runElapsed-t.runElapsed}}),i.a.createElement(B.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"8%",render:function(e){return se(e)},sorter:function(e,t){return e.status===t.status?0:e.status===j.QUEUED?-1:e.status===j.RUNNING?t.status===j.QUEUED?1:-1:e.status===j.FINISHED?t.status===j.QUEUED||t.status===j.RUNNING?1:-1:e.status===j.ERRORED&&t.status===j.CANCELED?-1:1}}),i.a.createElement(B.a.Column,{title:"Server Type",dataIndex:"clientGroups",key:"clientGroups",width:"8%",render:function(e){return e.join(",")},sorter:function(e,t){return e.clientGroups.join(",").localeCompare(t.clientGroups.join(","))}}),i.a.createElement(B.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,n){return e.renderJobAction(n)}}))))}}]),t}(i.a.Component);ce.defaultTimeRange="lastWeek";var le=n(28),me=n.n(le),de=n(57),pe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getAppMetrics",value:function(){var e=Object(de.a)(me.a.mark(function e(t){var n,r,a,i,u;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.epoch_range,r=t.user_ids,e.next=3,this.callFunc("get_app_metrics",[{epoch_range:n,user_ids:r}]);case 3:return a=e.sent,i=Object(te.a)(a,1),u=i[0],e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(h.DynamicServiceClient);function he(e,t){var n,r,a,i,u=Date.now(),o=function(e){return e.complete?e.error?j.ERRORED:"done"===e.status?j.FINISHED:e.status.startsWith("canceled")?j.CANCELED:(e.status,j.ERRORED):e.status&&"queued"!==e.status?j.RUNNING:j.QUEUED}(e);switch(o){case j.QUEUED:n=u-e.creation_time,r=null,a=null;break;case j.RUNNING:n=e.exec_start_time-e.creation_time,r=u-e.exec_start_time,a=null;break;case j.FINISHED:case j.ERRORED:case j.CANCELED:n=e.exec_start_time-e.creation_time,r=e.finish_time-e.exec_start_time,a=e.finish_time;break;default:throw new Error("Invalid job status: "+e.status)}return i=e.wsid?parseInt(e.wsid,10):null,{key:e.job_id,id:e.job_id,status:o,message:e.status,appID:e.app_id,appTitle:e.app_id,narrativeID:i,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time||null,finishAt:a,queuedElapsed:n,runElapsed:r,clientGroups:e.client_groups,username:e.user||t,log:{isLoaded:!1,lines:[]}}}function fe(e,t,n){return!![e.queuedAt,e.runAt,e.finishAt].some(function(e){return!!e&&(e>t&&e<n)})||!!e.queuedAt&&(!(e.queuedAt>n)&&(e.queuedAt>=t||(!e.runAt||(e.runAt>=t||(!e.finishAt||e.finishAt>=t)))))}function Ee(e,t){return!t||t.some(function(t){return e.status===t})}function be(e){switch(e.kind){case"preset":return function(e){var t=(new Date).getTime();switch(e){case"lastHour":return[t-36e5,t];case"last48Hours":return[t-1728e5,t];case"lastWeek":return[t-6048e5,t];case"lastMonth":return[t-2592e6,t]}}(e.preset);case"literal":return[e.start,e.end];default:throw new Error("Invalid time range kind value (should be impossible")}}function Se(e,t,n,r){return ve.apply(this,arguments)}function ve(){return(ve=Object(de.a)(me.a.mark(function e(t,n,r,a){var i;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new pe({url:n,token:t}),e.abrupt("return",i.getAppMetrics({epoch_range:[r,a],user_ids:[]}).then(function(e){return e.job_states.map(function(e){return he(e,"UNKNOWN")})}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ye(){return{type:r.USER_JOBS_SEARCH_START}}function ge(e,t,n,a){return{type:r.USER_JOBS_SEARCH_SUCCESS,searchExpression:a,rawJobs:e,jobs:t,jobsFetchedAt:n}}function Ce(e){return{type:r.USER_JOBS_SEARCH_ERROR,error:e}}function Re(e){return{type:r.USER_JOBS_CANCEL_ERROR,error:e}}pe.module="kb_Metrics";var we=Object(M.connect)(function(e,t){var n=e.views.userJobsView,r=n.searchState;return{jobs:n.jobs,searchState:r}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,r){var a,i,u,o,s,c,l,m,d,p,h,f,E;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n(ye()),a=r(),i=a.auth.userAuthorization,u=a.app.config.services.ServiceWizard.url,i){t.next=5;break}return n(Ce({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(o=r(),s=o.views.userJobsView,c=s.jobsFetchedAt,l=s.rawJobs,m=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=be(e.timeRange),p=Object(te.a)(d,2),h=p[0],f=p[1],c&&!e.forceSearch){t.next=13;break}return t.next=11,Se(i.token,u,h,f);case 11:l=t.sent,c=(new Date).getTime();case 13:E=l.filter(function(t){return m.every(function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)||e.test(t.id)})&&fe(t,h,f)&&Ee(t,e.jobStatus)}),n(ge(l,E,c,e));case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},cancelJob:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,a){var i,u,o;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.USER_JOBS_CANCEL_START}),i=a(),u=i.auth.userAuthorization,o=i.app.config.services.NarrativeJobService.url,u){t.next=5;break}return n(Re({message:"no authorization",code:"no-authorization"})),t.abrupt("return");case 5:new h.NarrativeJobServiceClient({url:o,token:u.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then(function(){n({type:r.USER_JOBS_CANCEL_SUCCESS}),n(function(){var e=Object(de.a)(me.a.mark(function e(t,n){var r,a,i,u,o,s,c,l,m,d,p,h;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(ye()),r=n(),a=r.auth.userAuthorization){e.next=5;break}return t(Ce({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:if(i=n(),u=i.app.config.services.ServiceWizard.url,o=i.views.userJobsView.searchExpression){e.next=9;break}return Ce({message:"No search expression",code:"nosearchexpression"}),e.abrupt("return");case 9:return s=o.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),c=be(o.timeRange),l=Object(te.a)(c,2),m=l[0],d=l[1],e.next=13,Se(a.token,u,m,d);case 13:p=e.sent,h=p.filter(function(e){return s.every(function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)})&&fe(e,m,d)&&Ee(e,o.jobStatus)}),t(ge(p,h,Date.now(),o));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())}).catch(function(e){console.error("error canceling job",e),n(Re({message:"error canceling job: "+e.message,code:"error-canceling"}))});case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(ce),Oe=(n(782),[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}]);function _e(e){var t=function(e){switch(e){case j.QUEUED:return i.a.createElement("span",null,i.a.createElement(q.a,{type:"loading",spin:!0})," Queued");case j.RUNNING:return i.a.createElement("span",null,i.a.createElement(q.a,{type:"loading-3-quarters",spin:!0})," Running");case j.CANCELED:return"Canceled";case j.FINISHED:return"Success";case j.ERRORED:return"Errored"}}(e),n=function(e){switch(e){case j.QUEUED:return"orange";case j.RUNNING:return"blue";case j.CANCELED:return"gray";case j.FINISHED:return"green";case j.ERRORED:return"red"}}(e);return i.a.createElement(X.a,{color:n},t)}var ke=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery="",n.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRangePreset}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},function(){t.doSearch(!0)}):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach(function(e){switch(e){case"queued":t.push(j.QUEUED);break;case"running":t.push(j.RUNNING);break;case"canceled":t.push(j.CANCELED);break;case"success":t.push(j.FINISHED);break;case"error":t.push(j.ERRORED)}}),t}(this.state.currentJobStatusFilter),n={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e};return this.props.search(n),!1}}},{key:"onRangeFromChange",value:function(e){var t,n=this.state.timeRange;switch(n.kind){case"preset":t={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":t={kind:"literal",start:e.valueOf(),end:n.end};break;default:return}this.setState({timeRange:t})}},{key:"onRangeToChange",value:function(e){var t,n=this.state.timeRange;switch(n.kind){case"preset":t={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":t={kind:"literal",start:n.start,end:e.valueOf()};break;default:return}this.setState({timeRange:t})}},{key:"renderSearchInput",value:function(){var e,n=this;if(this.state.showDates){var r=this.state.timeRange;"literal"===r.kind&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.a.Item,{label:"From"},i.a.createElement(W.a,{showTime:!0,allowClear:!1,value:ee()(r.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(Y.a.Item,{label:"To"},i.a.createElement(W.a,{showTime:!0,allowClear:!1,value:ee()(r.end),onChange:this.onRangeToChange.bind(this)}))))}return i.a.createElement(Y.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(Y.a.Item,null,i.a.createElement(G.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(Y.a.Item,{label:"TimeRange"}),i.a.createElement(Y.a.Item,null,i.a.createElement(V.a,{defaultValue:t.defaultTimeRangePreset,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(V.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(V.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(V.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(V.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(V.a.Option,{value:"customRange"},"Custom Range"))),e,i.a.createElement(Y.a.Item,null,i.a.createElement($.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(Y.a.Item,null,i.a.createElement(ue,{onPoll:function(){n.doSearch(!0)},startMonitoring:!0})))}},{key:"onFilterChange",value:function(e){var t=this,n=e;this.setState({currentJobStatusFilter:n},function(){t.doSearch(!1)})}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){t.doSearch(!1)})}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},function(){e.doSearch(!1)})}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},function(){e.doSearch(!1)})}},{key:"renderFilterInput",value:function(){var e=Oe;return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement($.a,{size:"small",onClick:this.onClickAny.bind(this),"data-k-b-testhook-button":"any"},i.a.createElement("i",null,"Any"))," ",i.a.createElement($.a,{size:"small",onClick:this.onClickActive.bind(this),"data-k-b-testhook-button":"active"},i.a.createElement("i",null,"Active"))," ",i.a.createElement($.a,{size:"small",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"},"data-k-b-testhook-button":"finished"},i.a.createElement("i",null,"Finished")),i.a.createElement(z.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter})))}},{key:"renderControlBar",value:function(){return i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),i.a.createElement("div",{className:"Row",style:{margin:"10px auto"}},this.renderFilterInput()))}},{key:"onJobCancel",value:function(e){this.props.cancelJob(e.id)}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case j.QUEUED:case j.RUNNING:return i.a.createElement(K.a,{title:"Cancel this job?",onConfirm:function(){t.onJobCancel(e)},okText:"Yes",cancelText:"No"},i.a.createElement($.a,{icon:"close",type:"danger","data-k-b-testhook-button":"cancel"}));default:return}}},{key:"render",value:function(){var e=this,t=this.props.searchState===N.SEARCHING;return i.a.createElement("div",{"data-k-b-testhook-component":"MyJobs"},i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,i.a.createElement(B.a,{size:"small",className:"MyJobs-table",dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0},expandIcon:function(e){var t;return t=e.expanded?i.a.createElement(q.a,{type:"folder-open"}):i.a.createElement(q.a,{type:"folder"}),i.a.createElement($.a,{type:"link",className:"expand-row-icon",onClick:function(t){return e.onExpand(e.record,t)}},t)},expandedRowRender:function(e){if(e.status===j.QUEUED){return i.a.createElement(H.a,{type:"warning",message:"Sorry, job log is not available until the job starts running."})}return i.a.createElement(ae,{jobId:e.id})}},i.a.createElement(B.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){return e&&t.narrativeID?i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"/narrative/".concat(t.narrativeID),target:"_blank",rel:"noopener noreferrer"},e)):"n/a"},sorter:function(e,t){return e.narrativeTitle.localeCompare(t.narrativeTitle)}}),i.a.createElement(B.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"18%",render:function(e,t){if(!e)return"n/a";var n="/#catalog/apps/"+t.appID;return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:n},e))},sorter:function(e,t){return e.appTitle.localeCompare(t.appTitle)}}),i.a.createElement(B.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"10%",render:function(e,t){return e?i.a.createElement(h.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t){return null===e.queuedAt?null===t.queuedAt?0:-1:null===t.queuedAt?1:e.queuedAt-t.queuedAt}}),i.a.createElement(B.a.Column,{title:"Queued for",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"10%",render:function(e){return i.a.createElement(h.NiceTimeDuration,{duration:e,precision:2})},sorter:function(e,t){return null===e.queuedElapsed?null===t.queuedElapsed?0:-1:null===t.queuedElapsed?1:e.queuedElapsed-t.queuedElapsed}}),i.a.createElement(B.a.Column,{title:"Run for",dataIndex:"runElapsed",key:"runElapsed",width:"10%",render:function(e){return null===e?"-":i.a.createElement(h.NiceTimeDuration,{duration:e,precision:2})},sorter:function(e,t){return null===e.runElapsed?null===t.runElapsed?0:-1:null===t.runElapsed?1:e.runElapsed-t.runElapsed}}),i.a.createElement(B.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"10%",render:function(e){return _e(e)},sorter:function(e,t){return e.status===t.status?0:e.status===j.QUEUED?-1:e.status===j.RUNNING?t.status===j.QUEUED?1:-1:e.status===j.FINISHED?t.status===j.QUEUED||t.status===j.RUNNING?1:-1:e.status===j.ERRORED&&t.status===j.CANCELED?-1:1}}),i.a.createElement(B.a.Column,{title:"Server Type",dataIndex:"clientGroups",key:"clientGroups",width:"10%",render:function(e){return e.join(",")},sorter:function(e,t){return e.clientGroups.join(",").localeCompare(t.clientGroups.join(","))}}),i.a.createElement(B.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,n){return e.renderJobAction(n)}}))))}}]),t}(i.a.Component);function Ae(){return{type:r.MY_JOBS_SEARCH_START}}function je(e,t,n,a){return{type:r.MY_JOBS_SEARCH_SUCCESS,searchExpression:a,rawJobs:e,jobs:t,jobsFetchedAt:n}}function Ne(e){return{type:r.MY_JOBS_SEARCH_ERROR,error:e}}function Te(e,t,n,r,a){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(de.a)(me.a.mark(function e(t,n,r,a,i){var u;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=new pe({url:r,token:t}),e.abrupt("return",u.getAppMetrics({epoch_range:[a,i],user_ids:[n]}).then(function(e){return e.job_states.map(function(e){return he(e,n)})}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ue(){return function(){var e=Object(de.a)(me.a.mark(function e(t,n){var r,a,i,u,o,s,c,l,m,d,p,h;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(Ae()),r=n(),a=r.auth.userAuthorization){e.next=5;break}return t(Ne({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:if(i=n(),u=i.app.config.services.ServiceWizard.url,o=i.views.myJobsView.searchExpression){e.next=9;break}return Ne({message:"No search expression",code:"nosearchexpression"}),e.abrupt("return");case 9:return s=be(o.timeRange),c=Object(te.a)(s,2),l=c[0],m=c[1],d=o.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),e.next=13,Te(a.token,a.username,u,l,m);case 13:p=e.sent,h=p.filter(function(e){return d.every(function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)})&&fe(e,l,m)&&Ee(e,o.jobStatus)}),t(je(p,h,Date.now(),o));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}function De(e){return{type:r.MY_JOBS_CANCEL_ERROR,error:e}}ke.defaultTimeRangePreset="lastWeek";var Je=Object(M.connect)(function(e,t){var n=e.views.myJobsView,r=n.searchState;return{jobs:n.jobs,searchState:r}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,r){var a,i,u,o,s,c,l,m,d,p,h,f,E;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n(Ae()),a=r(),i=a.auth.userAuthorization){t.next=5;break}return n(Ne({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(u=r(),o=u.app.config.services.ServiceWizard.url,s=u.views.myJobsView,c=s.jobsFetchedAt,l=s.rawJobs,m=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=be(e.timeRange),p=Object(te.a)(d,2),h=p[0],f=p[1],c&&!e.forceSearch){t.next=13;break}return t.next=11,Te(i.token,i.username,o,h,f);case 11:l=t.sent,c=(new Date).getTime();case 13:E=l.filter(function(t){return m.every(function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)})&&fe(t,h,f)&&Ee(t,e.jobStatus)}),n(je(l,E,c,e));case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},cancelJob:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,a){var i,u,o;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.MY_JOBS_CANCEL_START}),i=a(),u=i.auth.userAuthorization,o=i.app.config.services.NarrativeJobService.url,u){t.next=5;break}return n(De({message:"no authorization",code:"no-authorization"})),t.abrupt("return");case 5:new h.NarrativeJobServiceClient({url:o,token:u.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then(function(){n({type:r.MY_JOBS_CANCEL_SUCCESS}),n(Ue())}).catch(function(e){console.error("error canceling job",e),n(De({message:"error canceling job: "+e.message,code:"error-canceling"}))});case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))},refreshSearch:function(){e(Ue())}}})(ke),xe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery="",n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearch({query:this.currentQuery})}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.onSearch({query:this.currentQuery})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(Y.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(Y.a.Item,null,i.a.createElement(G.a,{defaultValue:this.currentQuery,placeholder:"Search App Stats (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(Y.a.Item,null,i.a.createElement($.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"onTableChange",value:function(e,t,n){}},{key:"renderAppStatsTable",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null,i.a.createElement(B.a,{dataSource:this.props.appStats,loading:this.props.searchState===N.SEARCHING,rowKey:function(e){return e.appId},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable",onChange:this.onTableChange},i.a.createElement(B.a.Column,{title:"Module",dataIndex:"moduleId",key:"moduleId",width:"25%",render:function(e,t){return i.a.createElement(Q.a,{title:t.moduleTitle},i.a.createElement("a",{href:"#catalog/module/".concat(e)},t.moduleTitle))},sorter:function(e,t){return e.moduleTitle.localeCompare(t.moduleTitle)},defaultSortOrder:"ascend"}),i.a.createElement(B.a.Column,{title:"Function",dataIndex:"functionId",key:"functionId",width:"25%",render:function(e,t){return i.a.createElement(Q.a,{title:t.functionTitle},i.a.createElement("a",{href:"#catalog/apps/".concat(t.moduleId,"/").concat(t.functionId)},t.functionTitle))},sorter:function(e,t){return e.functionTitle.localeCompare(t.functionTitle)}}),i.a.createElement(B.a.Column,{title:"Runs",dataIndex:"runCount",key:"runCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount}}),i.a.createElement(B.a.Column,{title:"Errors",dataIndex:"errorCount",key:"errorCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.errorCount-t.errorCount}}),i.a.createElement(B.a.Column,{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:"10%",render:function(e){return i.a.createElement(ie.a,{percent:100*e,format:function(t){return new Intl.NumberFormat("en-US",{style:"percent"}).format(e)}})},sorter:function(e,t){return e.successRate-t.successRate}}),i.a.createElement(B.a.Column,{title:"Avg Run Time",dataIndex:"averageRunTime",key:"averageRunTime",width:"10%",render:function(e){return i.a.createElement(h.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageRunTime-t.averageRunTime}}),i.a.createElement(B.a.Column,{title:"Avg Queue Time",dataIndex:"averageQueueTime",key:"averageQueueTime",width:"10%",render:function(e){return i.a.createElement(h.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageQueueTime-t.averageQueueTime}}),i.a.createElement(B.a.Column,{title:"Total Run Time",dataIndex:"totalRunTime",key:"totalRunTime",width:"10%",render:function(e){return i.a.createElement(h.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.totalRunTime-t.totalRunTime}}))))}},{key:"render",value:function(){return i.a.createElement("div",null,this.renderAppStatsTable())}}]),t}(i.a.Component);function Pe(e,t){return e?t?e/t:null:t?0:null}function Me(e){return{type:r.PUBLIC_APP_STATS_SEARCH_ERROR,error:e}}var He=Object(M.connect)(function(e,t){var n=e.views.publicAppStatsView,r=n.appStats;return{searchState:n.searchState,appStats:r}},function(e,t){return{onSearch:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,a){var i,u,o,s,c,l,m,d;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.PUBLIC_APP_STATS_SEARCH_START}),i=a(),u=i.auth.userAuthorization,o=i.app.config.services.Catalog.url,u){t.next=5;break}return n(Me({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(u){t.next=8;break}return n(Me({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 8:return s=new h.CatalogClient({module:"Catalog",token:u.token,url:o}),t.next=11,s.getExecAggrStats({});case 11:c=t.sent,l=c.map(function(e){var t=e.full_app_id.split("/"),n=Object(te.a)(t,2),r=n[0],a=n[1];r&&a||console.warn("bad app!",e);var i,u,o=(i=e.number_of_calls-e.number_of_errors,u=e.number_of_calls,i?u?i/u:null:u?0:null),s=Pe(e.total_exec_time,e.number_of_calls),c=Pe(e.total_queue_time,e.number_of_calls);return{appId:e.full_app_id,moduleId:r,functionId:a||"",moduleTitle:r,functionTitle:a||"",runCount:e.number_of_calls,errorCount:e.number_of_errors,successRate:o,averageRunTime:s,averageQueueTime:c,totalRunTime:e.total_queue_time}}),m=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),d=l.filter(function(e){return m.every(function(t){return t.test(e.moduleTitle)||t.test(e.moduleId)||t.test(e.functionTitle)||t.test(e.functionId)})}),n((p=d,{type:r.PUBLIC_APP_STATS_SEARCH_SUCCESS,appStats:p}));case 16:case"end":return t.stop()}var p},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(xe),Le=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).currentQuery=void 0,n.currentQuery={query:""},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.search(this.currentQuery)}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.search(this.currentQuery)}},{key:"onChangeQuery",value:function(e){this.currentQuery.query=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(Y.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(Y.a.Item,null,i.a.createElement(G.a,{defaultValue:this.currentQuery.query,placeholder:"Search (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(Y.a.Item,null,i.a.createElement($.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"renderTable",value:function(){return i.a.createElement(B.a,{dataSource:this.props.userRunSummary,loading:this.props.searchState===N.SEARCHING,rowKey:function(e){return e.username+"."+e.appId},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable"},i.a.createElement(B.a.Column,{title:"User",dataIndex:"username",key:"username",width:"30%",render:function(e,t){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.username.localeCompare(t.username)}}),i.a.createElement(B.a.Column,{title:"Module",dataIndex:"moduleId",key:"moduleId",width:"30%",render:function(e){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#catalog/module/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.moduleId.localeCompare(t.moduleId)}}),i.a.createElement(B.a.Column,{title:"Function",dataIndex:"functionId",key:"functionId",width:"30%",render:function(e,t){return i.a.createElement(Q.a,{title:e},i.a.createElement("a",{href:"#catalog/apps/".concat(t.appId),target:"_parent"},e))},sorter:function(e,t){return e.functionId.localeCompare(t.functionId)}}),i.a.createElement(B.a.Column,{title:"Runs",dataIndex:"runCount",key:"runCount",width:"10%",align:"right",render:function(e,t){return i.a.createElement("div",{className:"NumericColumn"},Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount},defaultSortOrder:"descend"}))}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,this.renderControlBar()),i.a.createElement("div",null," ",this.renderTable()))}}]),t}(i.a.Component);function Fe(e){return{type:r.USER_RUN_SUMMARY_SEARCH_ERROR,error:e}}var qe=Object(M.connect)(function(e,t){var n=e.views.userRunSummaryView;return{searchState:n.searchState,userRunSummary:n.userRunSummary}},function(e,t){return{search:function(t){e(function(e){return function(){var t=Object(de.a)(me.a.mark(function t(n,a){var i,u,o,s,c,l,m,d,p;return me.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:r.USER_RUN_SUMMARY_SEARCH_START}),i=a(),u=i.auth.userAuthorization,o=i.app.config.services.Catalog.url,u){t.next=5;break}return n(Fe({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 5:if(u){t.next=8;break}return n(Fe({message:"Not authorized",code:"unauthorized"})),t.abrupt("return");case 8:return s=new h.CatalogClient({module:"Catalog",token:u.token,url:o}),c={begin:0,end:Date.now()},t.next=12,s.getExecAggrTable(c);case 12:l=t.sent,m=l.map(function(e){var t,n,r;if(e.app){var a=e.app.split("/"),i=Object(te.a)(a,2);n=i[0],r=i[1],t=e.app}else t=[n=e.func_mod,r=e.func].join("/");return n&&r||console.warn("bad app!",e),{username:e.user,appId:t,moduleId:n,functionId:r,runCount:e.n}}),d=e.query.split(/\s+/).map(function(e){return new RegExp(e,"i")}),p=m.filter(function(e){return d.every(function(t){return t.test(e.appId)||t.test(e.moduleId)||t.test(e.functionId)||t.test(e.username)})}),n((f=p,{type:r.USER_RUN_SUMMARY_SEARCH_SUCCESS,userRunSummary:f}));case 17:case"end":return t.stop()}var f},t)}));return function(e,n){return t.apply(this,arguments)}}()}(t))}}})(Le),Qe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).defaultTabKey=void 0,n.defaultTabKey="myJobs",n.state={activeTabKey:n.defaultTabKey,defaultActiveTabKey:n.defaultTabKey},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.setTitle("Job Browser")}},{key:"componentWillUnmount",value:function(){this.setState({activeTabKey:null})}},{key:"onTabsChange",value:function(e){this.setState({activeTabKey:e})}},{key:"renderJobsTab",value:function(){}},{key:"renderAdminJobsTab",value:function(){}},{key:"renderTabs",value:function(){var e,t;if(this.props.isAdmin){var n=i.a.createElement("span",null,"User Run Summary ",i.a.createElement(q.a,{type:"unlock"}));e=i.a.createElement(F.a.TabPane,{tab:n,key:"userRunSummary"},i.a.createElement(qe,null));var r=i.a.createElement("span",null,"User Jobs ",i.a.createElement(q.a,{type:"unlock"}));t=i.a.createElement(F.a.TabPane,{tab:r,key:"userJobs"},i.a.createElement(we,null))}return i.a.createElement(F.a,{animated:!1,activeKey:this.props.params.tab||this.state.activeTabKey||void 0,className:"FlexTabs",onChange:this.onTabsChange.bind(this)},i.a.createElement(F.a.TabPane,{tab:"My Jobs",key:"myJobs"},i.a.createElement(Je,null)),i.a.createElement(F.a.TabPane,{tab:"Public App Stats",key:"publicAppStats"},i.a.createElement(He,null)),t,e)}},{key:"render",value:function(){return i.a.createElement("div",{className:"Col Col-scrollable"},this.renderTabs())}}]),t}(i.a.Component);var Be=Object(M.connect)(function(e,t){var n=e.views.mainView.isAdmin,r=e.app.runtime.navigation;return{isAdmin:n,view:r.view,params:r.params}},function(e,t){return{setTitle:function(t){e(Object(h.sendTitle)(t))},setView:function(t){e(Object(h.setView)(t))},setParams:function(t){e(Object(h.setParams)(t))}}})(Qe);function ze(e){return{type:r.MAIN_LOAD_SUCCESS,isAdmin:e}}function Ve(e){return{type:r.MAIN_LOAD_ERROR,error:e}}var Ge=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){var e=a.createElement("div",null,"Loading ... ",a.createElement(L.a,null));return a.createElement(H.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return a.createElement(H.a,{type:"error",message:this.props.view.error.message})}},{key:"render",value:function(){switch(this.props.view.loadingState){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.renderError();case T.SUCCESS:return a.createElement(Be,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case T.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.unload()}}]),t}(a.Component);var Ye=Object(M.connect)(function(e,t){var n=e.auth.userAuthorization;return{view:e.views.mainView,token:n.token}},function(e,t){return{onLoad:function(){e(function(){var e=Object(de.a)(me.a.mark(function e(t,n){var a,i,u;return me.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:r.MAIN_LOAD_START}),a=n(),i=a.auth.userAuthorization,u=a.app.config.services.Catalog.url,i){e.next=5;break}return t(Ve({message:"Not authorized",code:"unauthorized"})),e.abrupt("return");case 5:new h.CatalogClient({token:i.token,url:u,module:"Catalog"}).isAdmin().then(function(e){t(ze(!!e))}).catch(function(e){t(Ve({message:e.message,code:"error-checking-admin-status"}))});case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())},unload:function(){e({type:r.MAIN_UNLOAD})}}})(Ge),We=(n(783),Object(D.d)(U,P(),Object(D.c)(Object(D.a)(J.a)))),Ke=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).state={},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(M.Provider,{store:We},i.a.createElement(h.AppBase,null,i.a.createElement(h.AuthGate,{required:!0},i.a.createElement(Ye,null))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(Ke,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[389,1,2]]]);
//# sourceMappingURL=main.3f3d9821.chunk.js.map