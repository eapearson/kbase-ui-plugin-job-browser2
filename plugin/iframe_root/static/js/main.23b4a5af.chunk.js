(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{418:function(e,t,a){e.exports=a(846)},423:function(e,t,a){},803:function(e,t,a){},822:function(e,t,a){},825:function(e,t,a){},839:function(e,t,a){},840:function(e,t,a){},842:function(e,t,a){},843:function(e,t,a){},844:function(e,t,a){},845:function(e,t,a){},846:function(e,t,a){"use strict";a.r(t);var n,r=a(0),i=a.n(r),s=a(9),o=a.n(s),u=(a(423),a(23)),c=a(24),l=a(30),d=a(29),m=a(31),h=a(22),p=a(25);!function(e){e.MAIN_LOAD="main load",e.MAIN_LOAD_START="main load start",e.MAIN_LOAD_SUCCESS="main load success",e.MAIN_LOAD_ERROR="main load error",e.MAIN_UNLOAD="main/unload",e.MY_JOBS_SEARCH="my jobs search",e.MY_JOBS_SEARCH_START="my jobs search start",e.MY_JOBS_SEARCH_SUCCESS="my jobs search success",e.MY_JOBS_SEARCH_ERROR="my jobs search error",e.My_JOBS_REFRESH_SEARCH="my jobs refresh search",e.MY_JOBS_CANCEL="my jobs cancel",e.MY_JOBS_CANCEL_START="my jobs cancel start",e.MY_JOBS_CANCEL_SUCCESS="my jobs cancel success",e.MY_JOBS_CANCEL_ERROR="my jobs cancel error",e.USER_JOBS_SEARCH="user jobs search",e.USER_JOBS_SEARCH_START="user jobs search start",e.USER_JOBS_SEARCH_SUCCESS="user jobs search success",e.USER_JOBS_SEARCH_ERROR="user jobs search error",e.USER_JOBS_CANCEL="user jobs cancel",e.USER_JOBS_CANCEL_START="user jobs cancel start",e.USER_JOBS_CANCEL_SUCCESS="user jobs cancel success",e.USER_JOBS_CANCEL_ERROR="user jobs cancel error",e.PUBLIC_APP_STATS_SEARCH="publicAppStats/Search",e.PUBLIC_APP_STATS_SEARCH_START="publicAppStats/Search/Start",e.PUBLIC_APP_STATS_SEARCH_ERROR="publicAppStats/Search/Error",e.PUBLIC_APP_STATS_SEARCH_SUCCESS="publicAppStats/Search/Success",e.USER_RUN_SUMMARY_SEARCH="userRunSummary/Search",e.USER_RUN_SUMMARY_SEARCH_START="userRunSummary/Search/Start",e.USER_RUN_SUMMARY_SEARCH_ERROR="userRunSummary/Search/Error",e.USER_RUN_SUMMARY_SEARCH_SUCCESS="userRunSummary/Search/Success"}(n||(n={}));var E=function(e,t){if(!e)return e;switch(t.type){case n.MY_JOBS_SEARCH_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{myJobsView:Object(h.a)({},e.views.myJobsView,{searchState:R.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case n.MY_JOBS_SEARCH_START:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{myJobsView:Object(h.a)({},e.views.myJobsView,{searchState:R.SEARCHING})})})}(e);case n.MY_JOBS_CANCEL_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{myJobsView:Object(h.a)({},e.views.myJobsView)})})}(e)}};var b=function(e,t){if(!e)return e;switch(t.type){case n.USER_JOBS_SEARCH_START:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{userJobsView:Object(h.a)({},e.views.userJobsView,{searchState:R.SEARCHING})})})}(e);case n.USER_JOBS_SEARCH_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{userJobsView:Object(h.a)({},e.views.userJobsView,{searchState:R.SEARCHED,rawJobs:t.rawJobs,jobs:t.jobs,jobsFetchedAt:t.jobsFetchedAt,searchExpression:t.searchExpression})})})}(e,t);case n.USER_JOBS_CANCEL_START:case n.USER_JOBS_CANCEL_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{userJobsView:Object(h.a)({},e.views.userJobsView)})})}(e)}};var f=function(e,t){if(!e)return e;switch(t.type){case n.MAIN_LOAD_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{mainView:Object(h.a)({},e.views.mainView,{loadingState:N.SUCCESS,isAdmin:t.isAdmin})})})}(e,t);case n.MAIN_UNLOAD:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{mainView:{loadingState:N.NONE,isAdmin:!1,error:null}})})}(e)}};var v=function(e,t){if(!e)return e;switch(t.type){case n.PUBLIC_APP_STATS_SEARCH_START:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{publicAppStatsView:Object(h.a)({},e.views.publicAppStatsView,{searchState:R.SEARCHING})})})}(e);case n.PUBLIC_APP_STATS_SEARCH_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{publicAppStatsView:Object(h.a)({},e.views.publicAppStatsView,{searchState:R.SEARCHED,appStats:t.appStats})})})}(e,t)}};var S,R,N,g=function(e,t){if(!e)return e;switch(t.type){case n.USER_RUN_SUMMARY_SEARCH_START:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{userRunSummaryView:Object(h.a)({},e.views.userRunSummaryView,{searchState:R.SEARCHING})})})}(e);case n.USER_RUN_SUMMARY_SEARCH_SUCCESS:return function(e,t){return Object(h.a)({},e,{views:Object(h.a)({},e.views,{userRunSummaryView:Object(h.a)({},e.views.userRunSummaryView,{searchState:R.SEARCHED,userRunSummary:t.userRunSummary})})})}(e,t)}},y=function(e,t){var a=Object(p.baseReducer)(e,t);return a||(f(e,t)||E(e,t)||b(e,t)||v(e,t)||g(e,t)||e)},C=a(157),w=a(413);!function(e){e.QUEUED="QUEUED",e.RUNNING="RUNNING",e.FINISHED="FINISHED",e.ERRORED_QUEUED="ERRORED_QUEUED",e.ERRORED_RUNNING="ERRORED_RUNNING",e.CANCELED_QUEUED="CANCELED_QUEUED",e.CANCELED_RUNNING="CANCELED_RUNNING"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SEARCHED=2]="SEARCHED",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(N||(N={}));var _=a(54),k=(a(199),a(78)),A=(a(138),a(56)),I=(a(379),a(5)),O=(a(803),a(173),a(21)),T=(a(122),a(28)),D=(a(381),a(144)),U=(a(273),a(65)),j=(a(275),a(110)),x=(a(172),a(64)),L=(a(200),a(40)),J=(a(388),a(112)),P=(a(274),a(42)),F=(a(389),a(142)),Q=(a(83),a(20)),G=a(17),M=a.n(G),H=(a(382),a(145));function q(e){switch(e){case S.QUEUED:return"orange";case S.RUNNING:return"blue";case S.CANCELED_QUEUED:case S.CANCELED_RUNNING:return"gray";case S.FINISHED:return"green";case S.ERRORED_QUEUED:case S.ERRORED_RUNNING:return"red";default:throw new Error("Invalid job status")}}var B,z=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"renderTag",value:function(){var e=function(e){switch(e){case S.QUEUED:return i.a.createElement("span",null,i.a.createElement(I.a,{type:"loading",spin:!0})," Queued");case S.RUNNING:return i.a.createElement("span",null,i.a.createElement(I.a,{type:"loading-3-quarters",spin:!0})," Running");case S.CANCELED_QUEUED:case S.CANCELED_RUNNING:return"Canceled";case S.FINISHED:return"Success";case S.ERRORED_QUEUED:case S.ERRORED_RUNNING:return"Errored";default:throw new Error("Invalid job status")}}(this.props.job.status),t=q(this.props.job.status);return i.a.createElement(H.a,{color:t},e)}},{key:"renderTiming",value:function(){switch(this.props.job.status){case S.QUEUED:return i.a.createElement("span",null,i.a.createElement(p.NiceElapsedTime,{from:this.props.job.queuedAt,useClock:!0}));case S.RUNNING:return i.a.createElement("span",null,i.a.createElement(p.NiceElapsedTime,{from:this.props.job.runAt,useClock:!0}));case S.FINISHED:case S.ERRORED_QUEUED:case S.ERRORED_RUNNING:case S.CANCELED_QUEUED:case S.CANCELED_RUNNING:return i.a.createElement("span",null,i.a.createElement(p.NiceRelativeTime,{time:new Date(this.props.job.finishAt)}))}}},{key:"render",value:function(){var e=this.props.showTiming?this.renderTiming():"";return i.a.createElement("span",null,this.renderTag(),e)}}]),t}(i.a.Component),V=a(79),W=a(18),Y=a.n(W),K=(a(822),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={selectedTabIndex:0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"selectTab",value:function(e){this.setState({selectedTabIndex:e})}},{key:"renderTabs",value:function(){var e=this;return this.props.tabs.map((function(t,a){var n=["FlexTabs-tab"];return a===e.state.selectedTabIndex&&n.push("FlexTabs-tab-active"),i.a.createElement("span",{key:String(a),className:n.join(" ")},i.a.createElement(Q.a,{type:"link",onClick:function(){e.selectTab(a)}},t.title))}))}},{key:"renderTabBody",value:function(){return this.props.tabs[this.state.selectedTabIndex].component}},{key:"render",value:function(){return i.a.createElement("div",{className:"FlexTabs"},i.a.createElement("div",{className:"FlexTabs-header"},this.renderTabs()),i.a.createElement("div",{className:"FlexTabs-body"},this.renderTabBody()))}}]),t}(i.a.Component)),X=(a(380),a(111)),$=(a(823),a(71)),Z=(a(272),a(94)),ee=(a(825),a(284)),te=a.n(ee),ae=a(414),ne=a.n(ae);!function(e){e[e.NONE=0]="NONE",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.DISABLED=3]="DISABLED"}(B||(B={}));var re=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).playLogTimer=void 0,a.bodyRef=void 0,a.currentJobStatus=void 0,a.playLogTimer=0,a.bodyRef=i.a.createRef(),a.currentJobStatus=null,a.state={playState:B.NONE,isPaused:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.currentJobStatus=this.props.job.status,this.state.isPaused||this.isActive()&&this.scrollToBottom()}},{key:"scrollToBottom",value:function(){null!==this.bodyRef.current&&(this.bodyRef.current.scrollTop=this.bodyRef.current.scrollHeight)}},{key:"componentDidUpdate",value:function(){var e=this.currentJobStatus;this.currentJobStatus=this.props.job.status,this.state.isPaused||(this.isActive()||e!==S.RUNNING||this.props.job.status!==S.RUNNING)&&this.scrollToBottom()}},{key:"isActive",value:function(){return this.props.job.status===S.QUEUED||this.props.job.status===S.RUNNING}},{key:"renderLastLine",value:function(){var e;return e=this.isActive()?i.a.createElement("span",null,"Polling for additional log entries..."," ",i.a.createElement(A.a,{size:"small"})):i.a.createElement("div",{style:{textAlign:"center",fontStyle:"italic"}},"Log complete"),i.a.createElement("div",{className:"FlexTable-row",key:"END",style:{backgroundColor:"rgba(200, 200, 200, 0.5)"},"data-end":"end"},i.a.createElement("div",{className:"FlexTable-col"}),i.a.createElement("div",{className:"FlexTable-col"},e))}},{key:"renderJobLog",value:function(){var e=this.props.log;if(0===e.length)return i.a.createElement(Z.a,null);var t=e.map((function(e){var t={};return e.isError&&(t.color="red"),i.a.createElement("div",{className:"FlexTable-row",style:t,key:e.lineNumber},i.a.createElement("div",{className:"FlexTable-col"},e.lineNumber),i.a.createElement("div",{className:"FlexTable-col"},e.line))}));return t.push(this.renderLastLine()),i.a.createElement("div",{className:"FlexTable",key:"log"},i.a.createElement("div",{className:"FlexTable-header"},i.a.createElement("div",{className:"FlexTable-row"},i.a.createElement("div",{className:"FlexTable-col"},"Line #"),i.a.createElement("div",{className:"FlexTable-col"},"Log line"))),i.a.createElement("div",{className:"FlexTable-body",ref:this.bodyRef},t))}},{key:"renderJobLogRow",value:function(){}},{key:"renderJobLogLines",value:function(){return i.a.createElement(O.a,{dataSource:this.props.log,size:"small",rowKey:function(e){return String(e.lineNumber)},pagination:!1,scroll:{y:"100%"},rowClassName:function(e){return e.isError?"JobLog-errorRow":"JobLog-normalRow"}},i.a.createElement(O.a.Column,{title:"Row",dataIndex:"lineNumber",key:"lineNumber",width:"8%",render:function(e,t){var a=new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e);return t.isError?i.a.createElement("span",{className:"JobLog-errorText"},a):a},sorter:function(e,t){return e.lineNumber-t.lineNumber}}),i.a.createElement(O.a.Column,{title:"Log line",dataIndex:"line",key:"line",width:"92%",render:function(e,t){var a;return a=t.isError?i.a.createElement("span",{className:"JobLog-errorText"},e):i.a.createElement("span",null,e),i.a.createElement(T.a,{title:e},a)}}))}},{key:"downloadLog",value:function(e,t){var a,n;switch(e){case"tsv":a="application/octet-stream",n=function(e){return te.a.unparse(e,{delimiter:"\t"})}(t);break;case"json":a="application/octet-stream",n=function(e){return JSON.stringify(e)}(t);break;case"text":a="text/plain",n=function(e){return e.map((function(e){return e.line})).join("\n")}(t);break;default:case"csv":a="application/octet-stream",n=function(e){return te.a.unparse(e)}(t)}!function(e,t,a){var n=document.createElement("a"),r=new Blob([a]);n.href=URL.createObjectURL(r),n.download=e,n.style.visibility="none",n.type=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href)}("job-log."+e,a,n)}},{key:"onMenuClick",value:function(e){e&&this.downloadLog(e.key,this.props.log)}},{key:"onPlayLog",value:function(){this.scrollToBottom(),this.setState({playState:B.PLAYING,isPaused:!1})}},{key:"onPauseLog",value:function(){this.setState({playState:B.PAUSED,isPaused:!0})}},{key:"renderPlayPauseTooltips",value:function(){var e,t,a=this.state.isPaused;switch(this.props.job.status){case S.RUNNING:a?(e="Click to automatically scroll to the bottom of the logs when new entries arrive",t="Automatic scrolling is already paused"):(e="Automatic scrolling is already active",t="Click to pause automatic scrolling to the bottom of the logs when new entries arrive");break;case S.QUEUED:case S.FINISHED:case S.ERRORED_QUEUED:case S.ERRORED_RUNNING:case S.CANCELED_QUEUED:case S.CANCELED_RUNNING:default:e="Log playing only available when the job is running",t="Log playing only available when the job is running"}return[e,t]}},{key:"renderPlayPause",value:function(){var e;switch(this.props.job.status){case S.QUEUED:e=!0;break;case S.RUNNING:e=!1;break;case S.FINISHED:case S.ERRORED_QUEUED:case S.ERRORED_RUNNING:case S.CANCELED_QUEUED:case S.CANCELED_RUNNING:default:e=!0}var t=this.renderPlayPauseTooltips(),a=Object(V.a)(t,2),n=a[0],r=a[1];return i.a.createElement(ne.a,null,i.a.createElement(T.a,{title:n},i.a.createElement(Q.a,{icon:"caret-right",disabled:e||!this.state.isPaused,onClick:this.onPlayLog.bind(this)})),i.a.createElement(T.a,{title:r},i.a.createElement(Q.a,{icon:"pause",disabled:e||this.state.isPaused,onClick:this.onPauseLog.bind(this)})))}},{key:"renderToolbar",value:function(){var e=0===this.props.log.length,t=i.a.createElement($.a,{onClick:this.onMenuClick.bind(this)},i.a.createElement($.a.Item,{key:"csv",disabled:e},"CSV"),i.a.createElement($.a.Item,{key:"tsv",disabled:e},"TSV"),i.a.createElement($.a.Item,{key:"json",disabled:e},"JSON"),i.a.createElement($.a.Item,{key:"text",disabled:e},"TEXT"));return i.a.createElement("div",{key:"toolbar"},i.a.createElement(X.a,{overlay:t},i.a.createElement(Q.a,{icon:"download"}))," ",this.renderPlayPause())}},{key:"render",value:function(){return i.a.createElement("div",{className:"JobLog"},this.renderToolbar(),this.renderJobLog())}}]),t}(i.a.Component),ie=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"renderSubmitted",value:function(){var e=this.props.job.queuedAt;return e?i.a.createElement(p.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")}},{key:"renderQueuedFor",value:function(){var e=this.props.job;switch(e.status){case S.QUEUED:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,precision:2,useClock:!0});case S.RUNNING:case S.FINISHED:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,to:e.runAt,precision:2});case S.CANCELED_QUEUED:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,to:e.finishAt,precision:2});case S.CANCELED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,to:e.runAt,precision:2});case S.ERRORED_QUEUED:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,to:e.finishAt,precision:2});case S.ERRORED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:e.queuedAt,to:e.runAt,precision:2})}}},{key:"renderRunFor",value:function(){var e=this.props.job;switch(e.status){case S.QUEUED:return i.a.createElement("span",null,"-");case S.RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:e.runAt,precision:2,useClock:!0});case S.FINISHED:return i.a.createElement(p.NiceElapsedTime,{from:e.runAt,to:e.finishAt,precision:2});case S.CANCELED_QUEUED:return i.a.createElement("span",null,"-");case S.CANCELED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:e.runAt,to:e.finishAt,precision:2});case S.ERRORED_QUEUED:return i.a.createElement("span",null,"-");case S.ERRORED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:e.runAt,to:e.finishAt,precision:2})}}},{key:"renderStateSpinner",value:function(e){if(this.props.job.status===e)return i.a.createElement("span",null," ",i.a.createElement(A.a,{size:"small",style:{color:q(e)}}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"JobInfo InfoTable"},i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Job ID"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.props.job.id)),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Status"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement(z,{job:this.props.job}))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Narrative"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement("a",{href:"/narrative/".concat(this.props.job.narrativeID),target:"_blank",rel:"noopener noreferrer"},this.props.job.narrativeTitle))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"App"),i.a.createElement("div",{className:"InfoTable-dataCol"},i.a.createElement("a",{href:"/#catalog/apps/".concat(this.props.job.appID)},this.props.job.appTitle))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Submitted"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderSubmitted())),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Queued For"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderQueuedFor(),this.renderStateSpinner(S.QUEUED))),i.a.createElement("div",{className:"InfoTable-row"},i.a.createElement("div",{className:"InfoTable-labelCol"},"Run For"),i.a.createElement("div",{className:"InfoTable-dataCol"},this.renderRunFor(),this.renderStateSpinner(S.RUNNING))))}}]),t}(i.a.Component),se=(a(839),function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return i.a.createElement("div",{className:"FullyCenteredBox"},i.a.createElement("span",null,"Loading ... ",i.a.createElement(A.a,null)))}},{key:"renderQueued",value:function(){return i.a.createElement("div",{className:"FullyCenteredBox"},i.a.createElement("span",null,"The job is ",i.a.createElement("i",null,"queued"),". The log will be displayed when the job starts running ... ",i.a.createElement(A.a,null)))}},{key:"renderError",value:function(e){return i.a.createElement(k.a,{type:"error",message:e.error})}},{key:"renderJobLog",value:function(){switch(this.props.view.status){case me.NONE:case me.JOB_QUEUED:return this.renderQueued();case me.INITIAL_LOADING:return this.renderLoading();case me.ERROR:return this.renderError(this.props.view);case me.ACTIVE_LOADED:case me.ACTIVE_LOADING:case me.FINISHED_LOADED:return i.a.createElement(re,{job:this.props.view.job,log:this.props.view.log})}}},{key:"renderJobInfo",value:function(){switch(this.props.view.status){case me.NONE:return this.renderLoading();case me.JOB_QUEUED:return i.a.createElement(ie,{job:this.props.view.job});case me.INITIAL_LOADING:return this.renderLoading();case me.ERROR:return this.renderError(this.props.view);case me.ACTIVE_LOADED:case me.ACTIVE_LOADING:case me.FINISHED_LOADED:return i.a.createElement(ie,{job:this.props.view.job})}}},{key:"renderTest",value:function(){var e=Array.from(Array(100).keys()).map((function(e){return i.a.createElement("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"row",borderBottom:"1px silver solid"},key:String(e)},i.a.createElement("div",{style:{flex:"0 0 auto",padding:"4px",overflowWrap:"break-word",wordWrap:"break-word"}},e))}));return i.a.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column",minHeight:0}},i.a.createElement("div",null,"Header Here"),i.a.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column",minHeight:0,overflowY:"auto"}},e))}},{key:"renderTest2",value:function(){var e=Array.from(Array(100).keys()).map((function(e){return i.a.createElement("div",{className:"FlexTable-row",key:String(e)},i.a.createElement("div",{className:"FlexTable-col"},e),i.a.createElement("div",{className:"FlexTable-col"},"This is row ",e))}));return i.a.createElement("div",{className:"FlexTable"},i.a.createElement("div",{className:"FlexTable-header"},i.a.createElement("div",{className:"FlexTable-row"},i.a.createElement("div",{className:"FlexTable-col"},"#"),i.a.createElement("div",{className:"FlexTable-col"},"Data"))),i.a.createElement("div",{className:"FlexTable-body"},e))}},{key:"renderStatus",value:function(){switch(this.props.view.status){case me.NONE:case me.INITIAL_LOADING:return i.a.createElement(A.a,{size:"small"});case me.ERROR:return i.a.createElement(k.a,{type:"error",message:this.props.view.error});default:return i.a.createElement(z,{job:this.props.view.job,showTiming:!0})}}},{key:"renderMiniDetails",value:function(){return i.a.createElement("div",{style:{flex:"0 0 auto"}},this.renderStatus())}},{key:"render",value:function(){var e=[{tab:"log",title:"Log",component:this.renderJobLog()},{tab:"detail",title:"Detail",component:this.renderJobInfo()}];return i.a.createElement(i.a.Fragment,null,this.renderMiniDetails(),i.a.createElement(K,{tabs:e}))}}]),t}(i.a.Component)),oe=a(53),ue=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getJobs",value:function(e){var t,a,n;return Y.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.epoch_range,a=e.user_ids,r.next=3,Y.a.awrap(this.callFunc("get_jobs",[{epoch_range:t,user_ids:a}]));case 3:return n=r.sent,r.abrupt("return",n[0]);case 5:case"end":return r.stop()}}),null,this)}},{key:"getJob",value:function(e){var t,a;return Y.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.job_id,n.next=3,Y.a.awrap(this.callFunc("get_job",[{job_id:t}]));case 3:return a=n.sent,n.abrupt("return",a[0]);case 5:case"end":return n.stop()}}),null,this)}},{key:"getAppMetrics",value:function(e){var t,a,n;return Y.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.epoch_range,a=e.user_ids,r.next=3,Y.a.awrap(this.callFunc("get_job",[{epoch_range:t,user_ids:a}]));case 3:return n=r.sent,r.abrupt("return",n[0]);case 5:case"end":return r.stop()}}),null,this)}}]),t}(oe.DynamicServiceClient);function ce(e,t){switch(function(e){switch(e.state){case"QUEUED":return S.QUEUED;case"RUNNING":return S.RUNNING;case"FINISHED":return S.FINISHED;case"CANCELED_QUEUED":case"CANCELED_RUNNING":return S.CANCELED_QUEUED;case"ERRORED_QUEUED":return S.ERRORED_QUEUED;case"ERRORED_RUNNING":return S.ERRORED_RUNNING;default:throw new Error("Unknown job state: "+e.state)}}(e)){case S.QUEUED:return function(e,t){var a;return a=e.wsid?parseInt(e.wsid,10):null,{key:e.job_id,id:e.job_id,status:S.QUEUED,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case S.RUNNING:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw console.error("ERROR: Running job without exec_start_time!",e),new Error("Running job without exec_start_time!");return{key:e.job_id,id:e.job_id,status:S.RUNNING,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:Date.now()-e.exec_start_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case S.FINISHED:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Running job without exec_start_time!");if(!e.finish_time)throw new Error("Running job without finish_time!");return{key:e.job_id,id:e.job_id,status:S.FINISHED,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);case S.ERRORED_QUEUED:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.finish_time)throw new Error("Errored job without finish_time!");return{key:e.job_id,id:e.job_id,status:S.ERRORED_QUEUED,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,message:e.status,username:e.user||t}}(e,t);case S.ERRORED_RUNNING:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw console.error("ERROR: Errored job without exec_start_time!",e),new Error("Errored job without exec_start_time!");if(!e.finish_time)throw new Error("Errored job without finish_time!");return{key:e.job_id,id:e.job_id,status:S.ERRORED_RUNNING,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,message:e.status,username:e.user||t}}(e,t);case S.CANCELED_QUEUED:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.finish_time)throw new Error("Canceled job without finish_time!");return{key:e.job_id,id:e.job_id,status:S.CANCELED_QUEUED,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,finishAt:e.finish_time,username:e.user||t}}(e,t);case S.CANCELED_RUNNING:return function(e,t){var a;if(a=e.wsid?parseInt(e.wsid,10):null,!e.exec_start_time)throw new Error("Canceled job without exec_start_time!");if(!e.finish_time)throw new Error("Canceled job without finish_time!");return{key:e.job_id,id:e.job_id,status:S.CANCELED_RUNNING,appID:e.app_id,appTitle:e.app_id,narrativeID:a,narrativeTitle:e.narrative_name,queuedAt:e.creation_time,runAt:e.exec_start_time,runElapsed:e.finish_time-e.exec_start_time,finishAt:e.finish_time,queuedElapsed:Date.now()-e.creation_time,clientGroups:e.client_groups,username:e.user||t}}(e,t);default:throw new Error("Invalid job status: "+e.status)}}function le(e,t){return!t||t.some((function(t){return e.status===t}))}function de(e){switch(e.kind){case"preset":return function(e){var t=(new Date).getTime();switch(e){case"lastHour":return[t-36e5,t];case"last48Hours":return[t-1728e5,t];case"lastWeek":return[t-6048e5,t];case"lastMonth":return[t-2592e6,t]}}(e.preset);case"literal":return[e.start,e.end];default:throw new Error("Invalid time range kind value (should be impossible")}}ue.module="kb_Metrics";var me;!function(e){e[e.NONE=0]="NONE",e[e.JOB_QUEUED=1]="JOB_QUEUED",e[e.INITIAL_LOADING=2]="INITIAL_LOADING",e[e.ACTIVE_LOADED=3]="ACTIVE_LOADED",e[e.ACTIVE_LOADING=4]="ACTIVE_LOADING",e[e.FINISHED_LOADED=5]="FINISHED_LOADED",e[e.ERROR=6]="ERROR"}(me||(me={}));var he=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={status:me.NONE},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getJob",value:function(){var e,t,a;return Y.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=new ue({token:this.props.token,url:this.props.serviceWizardURL}),t=this.props.jobID,n.next=4,Y.a.awrap(e.getJob({job_id:t}));case 4:return a=n.sent,n.abrupt("return",ce(a.job_state,"UNKNOWN"));case 6:case"end":return n.stop()}}),null,this)}},{key:"getJobLog",value:function(e){var t,a,n,r;return Y.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return t=new oe.NarrativeJobServiceClient({token:this.props.token,url:this.props.njsURL,module:"NarrativeJobService"}),i.next=3,Y.a.awrap(t.getJobLogs({job_id:this.props.jobID,skip_lines:e}));case 3:return a=i.sent,n=Object(V.a)(a,1),r=n[0],i.abrupt("return",r.lines.map((function(t,a){return{lineNumber:e+a+1,line:t.line,isError:!!t.is_error}})));case 7:case"end":return i.stop()}}),null,this)}},{key:"startRunningPolling",value:function(){var e=this,t=function(){var t,n,r,i,s;return Y.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if((t=e.state).status===me.ACTIVE_LOADED){o.next=4;break}return e.setState({status:me.ERROR,error:"Invalid state for polling: "+t.status}),o.abrupt("return");case 4:return n=t.log,e.setState({status:me.ACTIVE_LOADING,log:n}),o.next=8,Y.a.awrap(e.getJob());case 8:return r=o.sent,i=n.length,o.next=12,Y.a.awrap(e.getJobLog(i));case 12:s=o.sent,o.t0=r.status,o.next=o.t0===S.QUEUED?16:o.t0===S.RUNNING?18:o.t0===S.FINISHED?21:o.t0===S.ERRORED_QUEUED?21:o.t0===S.ERRORED_RUNNING?21:o.t0===S.CANCELED_RUNNING?21:o.t0===S.CANCELED_QUEUED?21:22;break;case 16:return e.startQueuedPolling(),o.abrupt("break",22);case 18:return e.setState({status:me.ACTIVE_LOADED,log:n.concat(s),job:r}),a(),o.abrupt("break",22);case 21:e.setState({status:me.FINISHED_LOADED,log:n.concat(s),job:r});case 22:case"end":return o.stop()}}))},a=function(){setTimeout(t,5e3)};a()}},{key:"startQueuedPolling",value:function(){var e=this,t=function(){var t,n;return Y.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Y.a.awrap(e.getJob());case 3:t=r.sent,r.t0=t.status,r.next=r.t0===S.QUEUED?7:9;break;case 7:return a(),r.abrupt("return");case 9:return r.next=11,Y.a.awrap(e.getJobLog(0));case 11:n=r.sent,r.t1=t.status,r.next=r.t1===S.RUNNING?15:r.t1===S.FINISHED?18:r.t1===S.CANCELED_QUEUED?20:r.t1===S.CANCELED_RUNNING?20:r.t1===S.ERRORED_QUEUED?22:r.t1===S.ERRORED_RUNNING?22:24;break;case 15:return e.setState({status:me.ACTIVE_LOADED,log:n,job:t}),e.startRunningPolling(),r.abrupt("break",24);case 18:return e.setState({status:me.FINISHED_LOADED,log:n,job:t}),r.abrupt("break",24);case 20:return e.setState({status:me.FINISHED_LOADED,log:n,job:t}),r.abrupt("break",24);case 22:return e.setState({status:me.ERROR,log:n,job:t}),r.abrupt("break",24);case 24:r.next=29;break;case 26:r.prev=26,r.t2=r.catch(0),console.error("ERROR",r.t2);case 29:case"end":return r.stop()}}),null,null,[[0,26]])},a=function(){setTimeout(t,5e3)};a()}},{key:"getInitialJobLog",value:function(){var e,t;return Y.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return this.setState({status:me.INITIAL_LOADING}),a.next=3,Y.a.awrap(this.getJob());case 3:e=a.sent,a.t0=e.status,a.next=a.t0===S.QUEUED?7:a.t0===S.RUNNING?10:a.t0===S.FINISHED?16:a.t0===S.ERRORED_QUEUED?16:a.t0===S.ERRORED_RUNNING?16:a.t0===S.CANCELED_QUEUED?16:a.t0===S.CANCELED_RUNNING?16:21;break;case 7:return this.setState({status:me.JOB_QUEUED,job:e}),this.startQueuedPolling(),a.abrupt("return");case 10:return a.next=12,Y.a.awrap(this.getJobLog(0));case 12:return t=a.sent,this.setState({status:me.ACTIVE_LOADED,log:t,job:e}),this.startRunningPolling(),a.abrupt("return");case 16:return a.next=18,Y.a.awrap(this.getJobLog(0));case 18:return t=a.sent,this.setState({status:me.FINISHED_LOADED,log:t,job:e}),a.abrupt("return");case 21:case"end":return a.stop()}}),null,this)}},{key:"componentDidMount",value:function(){this.getInitialJobLog()}},{key:"renderLoading",value:function(){return i.a.createElement("div",null,"Loading ... ",i.a.createElement(A.a,null))}},{key:"renderQueued",value:function(){return i.a.createElement("div",null,"Queued ... ",i.a.createElement(A.a,null))}},{key:"renderError",value:function(e){return i.a.createElement(k.a,{type:"error",message:e.error})}},{key:"render",value:function(){return i.a.createElement(se,{view:this.state})}}]),t}(i.a.Component);var pe,Ee=Object(_.connect)((function(e,t){var a=e.auth.userAuthorization,n=e.app.config.services,r=n.NarrativeJobService.url,i=n.ServiceWizard.url;if(!a)throw new Error("Invalid state: token required");return{token:a.token,njsURL:r,serviceWizardURL:i}}),(function(e,t){return{}}))(he),be=(a(840),a(387),a(100)),fe=a(203),ve=a(174),Se=a.n(ve),Re=function(){function e(t){Object(u.a)(this,e),this.subscriptions=void 0,this.pubsub=void 0,this.subscriptions=[],this.pubsub=t}return Object(c.a)(e,[{key:"on",value:function(e,t){var a=this.pubsub.on(e,t);this.subscriptions.push(a)}},{key:"off",value:function(){var e=this;this.subscriptions.forEach((function(t){e.pubsub.off(t)}))}}]),e}(),Ne=function(){function e(){Object(u.a)(this,e),this.sendQueue=void 0,this.messageListeners=void 0,this.allListeners=void 0,this.sendQueue=[],this.messageListeners=new Map,this.allListeners=new Map}return Object(c.a)(e,[{key:"sendMessages",value:function(){var e=this,t=this.sendQueue;this.sendQueue=[],t.forEach((function(t){var a=e.messageListeners.get(t.id);a&&a.listeners.forEach((function(e){try{e.handler(t.payload)}catch(a){console.error("ERROR",a)}}))}))}},{key:"processQueue",value:function(){var e=this;0!==this.sendQueue.length&&window.setTimeout((function(){e.sendMessages()}),1e3/60)}},{key:"send",value:function(e,t){var a={id:e,payload:t};this.sendQueue.push(a),this.processQueue()}},{key:"on",value:function(e,t){var a=this.messageListeners.get(e);a||(a={listeners:[]},this.messageListeners.set(e,a));var n=Se.a.v4(),r={id:n,messageID:e,handler:t};return a.listeners.push(r),this.allListeners.set(n,r),n}},{key:"off",value:function(e){var t=this.allListeners.get(e);if(t){var a=this.messageListeners.get(t.messageID);a&&(a.listeners=a.listeners.filter((function(e){return e.id!==t.id})))}}}]),e}();!function(e){e[e.STARTED=0]="STARTED",e[e.POLLING=1]="POLLING",e[e.WAITING=2]="WAITING",e[e.PAUSED=3]="PAUSED",e[e.STOPPED=4]="STOPPED",e[e.ERROR=5]="ERROR"}(pe||(pe={}));var ge=function(){function e(t){Object(u.a)(this,e),this.params=void 0,this.statusTimer=void 0,this.statusCount=void 0,this.watchStartAt=void 0,this.status=void 0,this.error=void 0,this.watcherTimer=void 0,this.waitTimer=void 0,this.pubsubProxy=void 0,this.params=t,this.statusTimer=null,this.statusCount=0,this.watchStartAt=0,this.status=pe.STOPPED,this.watcherTimer=null,this.waitTimer=null,this.pubsubProxy=new Re(this.params.pubsub),this.error=""}return Object(c.a)(e,[{key:"stop",value:function(){this.pubsubProxy.off()}},{key:"pause",value:function(){this.status=pe.PAUSED,this.waitTimer&&window.clearInterval(this.waitTimer),this.statusTimer&&window.clearInterval(this.statusTimer),this.watcherTimer&&window.clearTimeout(this.watcherTimer),this.statusCount=0,this.updateOnProgress()}},{key:"play",value:function(){this.startWaiting()}},{key:"startWatching",value:function(){var e=this;this.watchStartAt=Date.now(),this.status=pe.STARTED;var t=function(){var t=Date.now()-e.watchStartAt;if(t>1e4)return e.status=pe.ERROR,e.error="Polling took too long (".concat(t,"ms)"),void e.stopPolling();switch(e.status){case pe.STARTED:case pe.POLLING:return void a();case pe.WAITING:e.watcherTimer&&window.clearTimeout(e.watcherTimer),e.status=pe.WAITING,e.startWaiting();break;case pe.STOPPED:a();break;case pe.PAUSED:console.warn("unexpected state PAUSED");break;case pe.ERROR:console.warn("unexpected state ERROR")}},a=function(){e.watcherTimer=window.setTimeout(t,e.params.watchInterval)};a()}},{key:"startWaiting",value:function(){var e=this;this.status=pe.WAITING;var t=function(){e.statusTimer=window.setInterval((function(){e.statusCount+=1,e.updateOnProgress()}),e.params.pollInterval/e.params.progressSteps)};e.waitTimer=window.setTimeout(e.runPoll.bind(e),e.params.pollInterval),e.statusCount=0,t()}},{key:"runPoll",value:function(){this.statusTimer&&window.clearInterval(this.statusTimer),this.params.onPoll(),this.statusCount=0,this.startWatching()}},{key:"startListeningForPollingEvent",value:function(){var e=this;this.pubsubProxy.on("searching",(function(t){if(t.is)switch(e.status){case pe.STARTED:e.status=pe.POLLING;break;case pe.POLLING:break;case pe.WAITING:e.pause();break;case pe.STOPPED:case pe.PAUSED:case pe.ERROR:}else switch(e.status){case pe.STARTED:break;case pe.POLLING:e.status=pe.WAITING;break;case pe.WAITING:case pe.STOPPED:break;case pe.PAUSED:e.play();break;case pe.ERROR:}}))}},{key:"stopListeningForPollingEvent",value:function(){this.pubsubProxy.off()}},{key:"startPolling",value:function(){this.startListeningForPollingEvent(),this.runPoll()}},{key:"updateOnProgress",value:function(){this.params.onProgress(100*this.statusCount/this.params.progressSteps)}},{key:"stopPolling",value:function(){this.waitTimer&&window.clearInterval(this.waitTimer),this.statusTimer&&window.clearInterval(this.statusTimer),this.watcherTimer&&window.clearTimeout(this.watcherTimer),this.statusCount=0,this.updateOnProgress(),this.stopListeningForPollingEvent()}}]),e}(),ye=1e4,Ce=100,we=100,_e=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).monitoringTimer=void 0,a.monitoringStatusTimer=void 0,a.pollWatcherTimer=void 0,a.searchListenerID=void 0,a.pubsubProxy=void 0,a.poller=void 0,a.monitoringTimer=null,a.monitoringStatusTimer=null,a.pollWatcherTimer=null,a.searchListenerID=null,a.pubsubProxy=new Re(a.props.pubsub),a.poller=new ge({onPoll:a.props.onPoll,onProgress:a.onProgress.bind(Object(fe.a)(a)),pubsub:a.props.pubsub,pollInterval:ye,progressSteps:Ce,watchInterval:we}),a.state={isMonitoring:!1,pollWaitProgress:0,isPollingInitiated:!1,pollingStartedAt:0,isPolling:!1,isOpen:a.props.startOpen},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onProgress",value:function(e){this.setState({pollWaitProgress:e})}},{key:"componentDidMount",value:function(){var e=this;this.props.startPolling&&this.startMonitoring(),this.pubsubProxy.on("searching",(function(t){t.is?e.setState({isPolling:!0}):e.setState({isPolling:!1})}))}},{key:"componentWillUnmount",value:function(){this.stopMonitoring(),this.poller.stop(),this.pubsubProxy.off()}},{key:"componentDidUpdate",value:function(){}},{key:"startMonitoring",value:function(){this.setState({isMonitoring:!0}),this.poller.startPolling()}},{key:"stopMonitoring",value:function(){this.poller.stopPolling(),this.setState({isMonitoring:!1})}},{key:"toggleMonitoring",value:function(){this.state.isMonitoring?this.stopMonitoring():this.startMonitoring()}},{key:"onToggleOpen",value:function(e){this.setState({isOpen:e})}},{key:"render",value:function(){if(!this.props.showControls)return null;var e,t,a,n="Start Polling",i="default",s=r.createElement(j.a,{defaultChecked:this.state.isOpen,checkedChildren:"hide monitor",unCheckedChildren:"show monitor",onChange:this.onToggleOpen.bind(this)});return this.state.isMonitoring&&(n="Stop Polling",i="danger",e=this.state.isPolling?r.createElement("span",null," ",r.createElement(be.a,{type:"circle",percent:100,width:30,showInfo:!1,strokeWidth:30,strokeColor:"orange"})):r.createElement("span",null," ",r.createElement(be.a,{type:"circle",percent:this.state.pollWaitProgress,width:30,strokeWidth:30,showInfo:!1}))),t=this.state.isMonitoring?"Polling is running, with an interval of ".concat(ye,"ms and ").concat(Ce," update steps."):"Polling is currently stopped.",this.state.isOpen&&(a=r.createElement(T.a,{title:t},r.createElement(Q.a,{onClick:this.toggleMonitoring.bind(this),type:i,size:"small",style:{fontSize:"80%"}},n),e)),r.createElement("span",null,s," ",a)}}]),t}(r.Component),ke=[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}];var Ae=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).currentQuery=void 0,a.pubsub=void 0,a.currentQuery="",a.pubsub=new Ne,a.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRange},isFilterOpen:!1,selectedJob:null,currentSort:null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"componentDidUpdate",value:function(){this.props.searchState===R.SEARCHING?this.pubsub.send("searching",{is:!0}):this.pubsub.send("searching",{is:!1})}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},(function(){t.doSearch(!0)})):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach((function(e){switch(e){case"queued":t.push(S.QUEUED);break;case"running":t.push(S.RUNNING);break;case"canceled":t.push(S.CANCELED_QUEUED),t.push(S.CANCELED_RUNNING);break;case"success":t.push(S.FINISHED);break;case"error":t.push(S.ERRORED_QUEUED),t.push(S.ERRORED_RUNNING)}})),t}(this.state.currentJobStatusFilter),a={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e,sort:this.state.currentSort};return this.pubsub.send("search",{}),this.props.search(a),!1}}},{key:"onRangeFromChange",value:function(e,t){if(null!==e){var a,n=this.state.timeRange;switch(n.kind){case"preset":a={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":a={kind:"literal",start:e.valueOf(),end:n.end};break;default:return}this.setState({timeRange:a})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"onRangeToChange",value:function(e,t){if(null!==e){var a,n=this.state.timeRange;switch(n.kind){case"preset":a={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":a={kind:"literal",start:n.start,end:e.valueOf()};break;default:return}this.setState({timeRange:a})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case S.QUEUED:case S.RUNNING:return i.a.createElement(F.a,{title:"Cancel this job?",onConfirm:function(){t.props.cancelJob(e.id)},okText:"Yes",cancelText:"No"},i.a.createElement(Q.a,{icon:"close",type:"danger",size:"small"}));default:return}}},{key:"renderTimeRangeSelectionControl",value:function(){return i.a.createElement(P.a,{defaultValue:t.defaultTimeRange,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(P.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(P.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(P.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(P.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(P.a.Option,{value:"customRange"},"Custom Range"))}},{key:"renderTimeRangeControl",value:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(L.a.Item,{label:"From"},i.a.createElement(J.a,{showTime:!0,allowClear:!1,value:M()(e.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(L.a.Item,{label:"To"},i.a.createElement(J.a,{showTime:!0,allowClear:!1,value:M()(e.end),onChange:this.onRangeToChange.bind(this)})))}},{key:"renderSearchInput",value:function(){var e,t=this;if(this.state.showDates){var a=this.state.timeRange;"literal"===a.kind&&(e=this.renderTimeRangeControl(a))}return i.a.createElement(L.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(L.a.Item,null,i.a.createElement(x.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(L.a.Item,{label:"TimeRange"}),i.a.createElement(L.a.Item,null,this.renderTimeRangeSelectionControl()),e,i.a.createElement(L.a.Item,null,i.a.createElement(Q.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(L.a.Item,null,i.a.createElement(j.a,{checkedChildren:"hide filters",unCheckedChildren:"show filters",onChange:this.onToggleFilterArea.bind(this)})),i.a.createElement(L.a.Item,null,i.a.createElement(_e,{onPoll:function(){t.doSearch(!0)},pubsub:this.pubsub,startPolling:!0,isPollerRunning:this.props.searchState===R.SEARCHING,showControls:this.props.showMonitoringControls,startOpen:!0})))}},{key:"onToggleFilterArea",value:function(e){this.setState({isFilterOpen:e})}},{key:"onFilterChange",value:function(e){var t=this,a=e;this.setState({currentJobStatusFilter:a},(function(){t.doSearch(!1)}))}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},(function(){t.doSearch(!1)}))}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},(function(){e.doSearch(!1)}))}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},(function(){e.doSearch(!1)}))}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},(function(){e.doSearch(!1)}))}},{key:"renderFilterInput",value:function(){var e=ke;return i.a.createElement("div",{className:"UserJobs-filterArea"},i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement(Q.a,{size:"small",onClick:this.onClickAny.bind(this)},i.a.createElement("i",null,"Any"))," ",i.a.createElement(Q.a,{size:"small",onClick:this.onClickActive.bind(this)},i.a.createElement("i",null,"Active"))," ",i.a.createElement(Q.a,{size:"small",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"}},i.a.createElement("i",null,"Finished")),i.a.createElement(U.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter}))}},{key:"renderControlBar",value:function(){var e,t={margin:"10px 10px 10px 0"};return this.state.isFilterOpen||(t.display="none"),this.state.isFilterOpen&&(e=i.a.createElement("div",{className:"Row",style:t},this.renderFilterInput())),i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),e)}},{key:"onClickDetail",value:function(e){this.setState({selectedJob:e})}},{key:"onCloseModal",value:function(){this.setState({selectedJob:null})}},{key:"renderJobDetail",value:function(){if(this.state.selectedJob){var e=i.a.createElement(Q.a,{key:"cancel",onClick:this.onCloseModal.bind(this)},"Close"),t=i.a.createElement("span",null,"Detail for Job ",i.a.createElement("span",{style:{fontFamily:"monospace",fontWeight:"bold"}},this.state.selectedJob.id));return i.a.createElement(D.a,{className:"FullScreenModal",title:t,onCancel:this.onCloseModal.bind(this),visible:!0,footer:e},i.a.createElement(Ee,{jobID:this.state.selectedJob.id}))}}},{key:"renderJobsTable",value:function(){var e=this,t=this.props.searchState===R.SEARCHING;return i.a.createElement(O.a,{size:"small",className:"UserJobs-table xScrollingFlexTable",dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0}},i.a.createElement(O.a.Column,{title:"ID",dataIndex:"id",key:"id",width:"8%",render:function(t,a){var n=t;return i.a.createElement(T.a,{title:n},i.a.createElement("a",{href:"https://example.com",onClick:function(t){t.preventDefault(),e.onClickDetail(a)}},t))}}),i.a.createElement(O.a.Column,{title:"User",dataIndex:"username",key:"username",width:"10%",render:function(e){return i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e)}}),i.a.createElement(O.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){if(!e||!t.narrativeID)return"n/a";var a=["/narrative",t.narrativeID].join("/");return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},e))}}),i.a.createElement(O.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"18%",render:function(e,t){if(!e)return"n/a";var a="/#catalog/apps/"+t.appID;return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:a,target:"_parent"},e))}}),i.a.createElement(O.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"8%",render:function(e,t){return e?i.a.createElement(p.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t){return null===e.queuedAt?null===t.queuedAt?0:-1:null===t.queuedAt?1:e.queuedAt-t.queuedAt}}),i.a.createElement(O.a.Column,{title:"Queued",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"10%",render:function(e,t){switch(t.status){case S.QUEUED:case S.ERRORED_QUEUED:case S.CANCELED_QUEUED:return i.a.createElement(p.NiceElapsedTime,{from:t.queuedAt,precision:2,useClock:!0});default:return i.a.createElement("span",null,"-")}}}),i.a.createElement(O.a.Column,{title:"Run",key:"runElapsed",width:"10%",render:function(e,t){switch(t.status){case S.QUEUED:case S.ERRORED_QUEUED:case S.CANCELED_QUEUED:return"-";case S.RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:t.runAt,precision:2,useClock:!0});case S.FINISHED:case S.CANCELED_RUNNING:case S.ERRORED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:t.runAt,to:t.finishAt,precision:2})}}}),i.a.createElement(O.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"8%",render:function(e,t){return i.a.createElement(z,{job:t})}}),i.a.createElement(O.a.Column,{title:"Server",dataIndex:"clientGroups",key:"clientGroups",width:"8%",render:function(e){return e.join(",")}}),i.a.createElement(O.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,a){return e.renderJobAction(a)}}))}},{key:"render",value:function(){return i.a.createElement("div",{"data-k-b-testhook-component":"UserJobs",className:"UserJobs"},i.a.createElement("div",null,this.renderControlBar()),this.renderJobsTable(),this.renderJobDetail())}}]),t}(i.a.Component);Ae.defaultTimeRange="last48Hours";var Ie=function(){function e(){Object(u.a)(this,e),this.pendingTasks=void 0,this.isCanceled=void 0,this.pendingTasks=new Map,this.isCanceled=!1}return Object(c.a)(e,[{key:"newID",value:function(){return Se.a.v4()}},{key:"cancel",value:function(e){e.isCanceled=!0,this.pendingTasks.delete(e.id)}},{key:"cancelPending",value:function(){var e=this;this.pendingTasks.forEach((function(t,a){e.cancel(t)}))}},{key:"done",value:function(e){this.pendingTasks.delete(e.id)}},{key:"spawn",value:function(e){return this.cancelPending(),this.request(e)}}]),e}();function Oe(){return{type:n.USER_JOBS_SEARCH_START}}function Te(e,t,a,r){return{type:n.USER_JOBS_SEARCH_SUCCESS,searchExpression:r,rawJobs:e,jobs:t,jobsFetchedAt:a}}function De(e){return{type:n.USER_JOBS_SEARCH_ERROR,error:e}}var Ue=new(function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"request",value:function(e){var t=e.token,a=e.serviceWizardURL,n=e.from,r=e.to,i=new ue({url:a,token:t}).getJobs({epoch_range:[n,r],user_ids:[]}).then((function(e){return e.job_states.map((function(e){return ce(e,"UNKNOWN")}))})),s={id:this.newID(),promise:i,isCanceled:!1};return this.pendingTasks.set(s.id,s),s}}]),t}(Ie));function je(e){return{type:n.USER_JOBS_CANCEL_ERROR,error:e}}var xe=Object(_.connect)((function(e,t){var a=e.auth.userAuthorization,n=e.views.userJobsView,r=n.searchState,i=n.jobs;if(!a)throw new Error("Not authorized!");return{jobs:i,searchState:r,showMonitoringControls:!0}}),(function(e,t){return{search:function(t){e(function(e){return function(t,a){var n,r,i,s,o,u,c,l,d,m,h,p,E,b;return Y.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:if(t(Oe()),n=a(),r=n.auth.userAuthorization,i=n.app.config.services.ServiceWizard.url,r){f.next=5;break}return t(De({message:"Not authorized",code:"unauthorized"})),f.abrupt("return");case 5:if(s=a(),o=s.views.userJobsView,u=o.jobsFetchedAt,c=o.rawJobs,l=e.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),d=de(e.timeRange),m=Object(V.a)(d,2),h=m[0],p=m[1],u&&!e.forceSearch){f.next=18;break}return E=Ue.spawn({token:r.token,serviceWizardURL:i,from:h,to:p}),f.next=12,Y.a.awrap(E.promise);case 12:if(c=f.sent,!E.isCanceled){f.next=15;break}return f.abrupt("return");case 15:u=(new Date).getTime(),Ue.done(E),u=(new Date).getTime();case 18:b=c.filter((function(t){return l.every((function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)||e.test(t.id)||e.test(t.username)}))&&le(t,e.jobStatus)})),t(Te(c,b,u,e));case 20:case"end":return f.stop()}}))}}(t))},cancelJob:function(t){e(function(e){return function(t,a){var r,i,s;return Y.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(t({type:n.USER_JOBS_CANCEL_START}),r=a(),i=r.auth.userAuthorization,s=r.app.config.services.NarrativeJobService.url,i){o.next=5;break}return t(je({message:"no authorization",code:"no-authorization"})),o.abrupt("return");case 5:new oe.NarrativeJobServiceClient({url:s,token:i.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then((function(){t({type:n.USER_JOBS_CANCEL_SUCCESS}),t((function(e,t){var a,n,r,i,s,o,u,c,l,d,m,h,p;return Y.a.async((function(E){for(;;)switch(E.prev=E.next){case 0:if(e(Oe()),a=t(),n=a.auth.userAuthorization){E.next=5;break}return e(De({message:"Not authorized",code:"unauthorized"})),E.abrupt("return");case 5:if(r=t(),i=r.app.config.services.ServiceWizard.url,s=r.views.userJobsView.searchExpression){E.next=9;break}return De({message:"No search expression",code:"nosearchexpression"}),E.abrupt("return");case 9:return o=s.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),u=de(s.timeRange),c=Object(V.a)(u,2),l=c[0],d=c[1],m=Ue.spawn({token:n.token,serviceWizardURL:i,from:l,to:d}),E.next=14,Y.a.awrap(m.promise);case 14:if(h=E.sent,!m.isCanceled){E.next=17;break}return E.abrupt("return");case 17:Ue.done(m),p=h.filter((function(e){return o.every((function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)}))&&le(e,s.jobStatus)})),e(Te(h,p,Date.now(),s));case 20:case"end":return E.stop()}}))}))})).catch((function(e){console.error("error canceling job",e),t(je({message:"error canceling job: "+e.message,code:"error-canceling"}))}));case 7:case"end":return o.stop()}}))}}(t))}}}))(Ae),Le=(a(842),[{label:"Queued",value:"queued"},{label:"Running",value:"running"},{label:"Canceled",value:"canceled"},{label:"Success",value:"success"},{label:"Error",value:"error"}]);var Je=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).currentQuery=void 0,a.pubsub=void 0,a.currentQuery="",a.pubsub=new Ne,a.state={showDates:!1,currentJobStatusFilter:["queued","running","canceled","success","error"],timeRange:{kind:"preset",preset:t.defaultTimeRangePreset},isFilterOpen:!1,selectedJob:null,currentSort:null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.doSearch(!0)}},{key:"componentDidUpdate",value:function(){this.props.searchState===R.SEARCHING?this.pubsub.send("searching",{is:!0}):this.pubsub.send("searching",{is:!1})}},{key:"onChangeTimeRange",value:function(e){var t=this;"customRange"!==e?this.setState({showDates:!1,timeRange:{kind:"preset",preset:e}},(function(){t.doSearch(!0)})):this.setState({showDates:!0,timeRange:{kind:"literal",start:Date.now(),end:Date.now()}})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch(!0)}},{key:"doSearch",value:function(e){if("undefined"!==typeof this.currentQuery){var t=function(e){var t=[];return e.forEach((function(e){switch(e){case"queued":t.push(S.QUEUED);break;case"running":t.push(S.RUNNING);break;case"canceled":t.push(S.CANCELED_QUEUED),t.push(S.CANCELED_RUNNING);break;case"success":t.push(S.FINISHED);break;case"error":t.push(S.ERRORED_QUEUED),t.push(S.ERRORED_RUNNING)}})),t}(this.state.currentJobStatusFilter),a={query:this.currentQuery,timeRange:this.state.timeRange,jobStatus:t,forceSearch:e,sort:null};return this.pubsub.send("search",{}),this.props.search(a),!1}}},{key:"onRangeFromChange",value:function(e,t){if(null!==e){var a,n=this.state.timeRange;switch(n.kind){case"preset":a={kind:"literal",start:e.valueOf(),end:1/0};break;case"literal":a={kind:"literal",start:e.valueOf(),end:n.end};break;default:return}this.setState({timeRange:a})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"onRangeToChange",value:function(e,t){if(null!==e){var a,n=this.state.timeRange;switch(n.kind){case"preset":a={kind:"literal",start:1/0,end:e.valueOf()};break;case"literal":a={kind:"literal",start:n.start,end:e.valueOf()};break;default:return}this.setState({timeRange:a})}else this.setState({timeRange:{kind:"preset",preset:"lastHour"}})}},{key:"renderSearchInput",value:function(){var e,a=this;if(this.state.showDates){var n=this.state.timeRange;"literal"===n.kind&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(L.a.Item,{label:"From"},i.a.createElement(J.a,{showTime:!0,allowClear:!1,value:M()(n.start),onChange:this.onRangeFromChange.bind(this)})),i.a.createElement(L.a.Item,{label:"To"},i.a.createElement(J.a,{showTime:!0,allowClear:!1,value:M()(n.end),onChange:this.onRangeToChange.bind(this)}))))}return i.a.createElement(L.a,{layout:"inline",onSubmit:this.onSubmit.bind(this)},i.a.createElement(L.a.Item,null,i.a.createElement(x.a,{defaultValue:this.currentQuery,placeholder:"Search jobs",style:{width:"15em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(L.a.Item,{label:"TimeRange"}),i.a.createElement(L.a.Item,null,i.a.createElement(P.a,{defaultValue:t.defaultTimeRangePreset,onChange:this.onChangeTimeRange.bind(this),dropdownMatchSelectWidth:!0,style:{width:"11em"}},i.a.createElement(P.a.Option,{value:"lastHour"},"Previous Hour"),i.a.createElement(P.a.Option,{value:"last48Hours"},"Previous 48 Hours"),i.a.createElement(P.a.Option,{value:"lastWeek"},"Previous Week"),i.a.createElement(P.a.Option,{value:"lastMonth"},"Previous Month"),i.a.createElement(P.a.Option,{value:"customRange"},"Custom Range"))),e,i.a.createElement(L.a.Item,null,i.a.createElement(Q.a,{icon:"search",type:"primary",htmlType:"submit"})),i.a.createElement(L.a.Item,null,i.a.createElement(j.a,{checkedChildren:"hide filters",unCheckedChildren:"show filters",onChange:this.onToggleFilterArea.bind(this)})),i.a.createElement(L.a.Item,null,i.a.createElement(_e,{onPoll:function(){a.doSearch(!0)},pubsub:this.pubsub,isPollerRunning:this.props.searchState===R.SEARCHING,startPolling:!1,showControls:this.props.showMonitoringControls,startOpen:!1})))}},{key:"onToggleFilterArea",value:function(e){this.setState({isFilterOpen:e})}},{key:"onFilterChange",value:function(e){var t=this,a=e;this.setState({currentJobStatusFilter:a},(function(){t.doSearch(!1)}))}},{key:"onChangeJobStatusAny",value:function(e){var t=this;e.target.checked&&this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},(function(){t.doSearch(!1)}))}},{key:"onClickAny",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running","canceled","success","error"]},(function(){e.doSearch(!1)}))}},{key:"onClickFinished",value:function(){var e=this;this.setState({currentJobStatusFilter:["canceled","success","error"]},(function(){e.doSearch(!1)}))}},{key:"onClickActive",value:function(){var e=this;this.setState({currentJobStatusFilter:["queued","running"]},(function(){e.doSearch(!1)}))}},{key:"renderFilterInput",value:function(){var e=Le;return i.a.createElement("div",{className:"MyJobs-filterArea"},i.a.createElement("span",{style:{color:"gray",fontWeight:"bold",marginRight:"10px"}},"Filter by Job Status"),i.a.createElement(Q.a,{size:"small",type:"link",onClick:this.onClickAny.bind(this),"data-k-b-testhook-button":"any"},i.a.createElement("i",null,"Any"))," ",i.a.createElement(Q.a,{size:"small",type:"link",onClick:this.onClickActive.bind(this),"data-k-b-testhook-button":"active"},i.a.createElement("i",null,"Active"))," ",i.a.createElement(Q.a,{size:"small",type:"link",onClick:this.onClickFinished.bind(this),style:{marginRight:"10px"},"data-k-b-testhook-button":"finished"},i.a.createElement("i",null,"Finished")),i.a.createElement(U.a.Group,{options:e,onChange:this.onFilterChange.bind(this),value:this.state.currentJobStatusFilter}))}},{key:"renderControlBar",value:function(){var e,t={margin:"10px 10px 10px 0"};return this.state.isFilterOpen||(t.display="none"),this.state.isFilterOpen&&(e=i.a.createElement("div",{className:"Row",style:t},this.renderFilterInput())),i.a.createElement("div",{className:"Col"},i.a.createElement("div",{className:"Row"},this.renderSearchInput()),e)}},{key:"onJobCancel",value:function(e){this.props.cancelJob(e.id)}},{key:"renderJobAction",value:function(e){var t=this;switch(e.status){case S.QUEUED:case S.RUNNING:return i.a.createElement(F.a,{title:"Cancel this job?",onConfirm:function(){t.onJobCancel(e)},okText:"Yes",cancelText:"No"},i.a.createElement(Q.a,{icon:"close",type:"danger",size:"small","data-k-b-testhook-button":"cancel"}));default:return}}},{key:"onClickDetail",value:function(e){this.setState({selectedJob:e})}},{key:"onCloseModal",value:function(){this.setState({selectedJob:null})}},{key:"renderJobsTable",value:function(){var e=this,t=this.props.searchState===R.SEARCHING;return i.a.createElement(O.a,{size:"small",className:"MyJobs-table xScrollingFlexTable",dataSource:this.props.jobs,loading:t,rowKey:function(e){return e.id},pagination:{position:"bottom",showSizeChanger:!0}},i.a.createElement(O.a.Column,{title:"ID",dataIndex:"id",key:"id",width:"10%",render:function(t,a){var n=t;return i.a.createElement(T.a,{title:n},i.a.createElement("a",{href:"https://example.com",onClick:function(t){t.preventDefault(),e.onClickDetail(a)}},t))}}),i.a.createElement(O.a.Column,{title:"Narrative",dataIndex:"narrativeTitle",key:"narrativeTitle",width:"17%",render:function(e,t){return e&&t.narrativeID?i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:"/narrative/".concat(t.narrativeID),target:"_blank",rel:"noopener noreferrer"},e)):"n/a"}}),i.a.createElement(O.a.Column,{title:"App",dataIndex:"appTitle",key:"appTitle",width:"20%",render:function(e,t){if(!e)return"n/a";var a="/#catalog/apps/"+t.appID;return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:a},e))}}),i.a.createElement(O.a.Column,{title:"Submitted",dataIndex:"queuedAt",key:"queuedAt",width:"10%",render:function(e,t){return e?i.a.createElement(p.NiceRelativeTime,{time:new Date(e)}):i.a.createElement("span",null,"** empty **")},defaultSortOrder:"descend",sorter:function(e,t,a){var n;return n="ascend"===a?-1:1,null===e.queuedAt?null===t.queuedAt?0:-1*n:null===t.queuedAt?1*n:(e.queuedAt-t.queuedAt)*n}}),i.a.createElement(O.a.Column,{title:"Queued",dataIndex:"queuedElapsed",key:"queuedElapsed",width:"10%",render:function(e,t){switch(t.status){case S.QUEUED:case S.ERRORED_QUEUED:case S.CANCELED_QUEUED:return i.a.createElement(p.NiceElapsedTime,{from:t.queuedAt,precision:2,useClock:!0});default:return i.a.createElement("span",null,"-")}}}),i.a.createElement(O.a.Column,{title:"Run",key:"runElapsed",width:"10%",render:function(e,t){switch(t.status){case S.QUEUED:case S.ERRORED_QUEUED:case S.CANCELED_QUEUED:return"-";case S.RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:t.runAt,precision:2,useClock:!0});case S.FINISHED:case S.CANCELED_RUNNING:case S.ERRORED_RUNNING:return i.a.createElement(p.NiceElapsedTime,{from:t.runAt,to:t.finishAt,precision:2})}}}),i.a.createElement(O.a.Column,{title:"Status",dataIndex:"status",key:"status",width:"10%",render:function(e,t){return i.a.createElement(z,{job:t})}}),i.a.createElement(O.a.Column,{title:"Server",dataIndex:"clientGroups",key:"clientGroups",width:"8%",render:function(e){return e.join(",")}}),i.a.createElement(O.a.Column,{title:"Cancel",dataIndex:"action",key:"action",width:"5%",render:function(t,a){return e.renderJobAction(a)}}))}},{key:"renderJobDetail",value:function(){if(this.state.selectedJob){var e=i.a.createElement(Q.a,{key:"cancel",onClick:this.onCloseModal.bind(this)},"Close"),t=i.a.createElement("span",null,"Detail for Job ",i.a.createElement("span",{style:{fontFamily:"monospace",fontWeight:"bold"}},this.state.selectedJob.id));return i.a.createElement(D.a,{className:"FullScreenModal",title:t,onCancel:this.onCloseModal.bind(this),visible:!0,footer:e},i.a.createElement(Ee,{jobID:this.state.selectedJob.id}))}}},{key:"render",value:function(){return i.a.createElement("div",{"data-k-b-testhook-component":"MyJobs",className:"MyJobs"},i.a.createElement("div",null,this.renderControlBar()),this.renderJobsTable(),this.renderJobDetail())}}]),t}(i.a.Component);function Pe(){return{type:n.MY_JOBS_SEARCH_START}}function Fe(e,t,a,r){return{type:n.MY_JOBS_SEARCH_SUCCESS,searchExpression:r,rawJobs:e,jobs:t,jobsFetchedAt:a}}function Qe(e){return{type:n.MY_JOBS_SEARCH_ERROR,error:e}}Je.defaultTimeRangePreset="lastWeek";var Ge=new(function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"request",value:function(e){var t=e.token,a=e.username,n=e.serviceWizardURL,r=e.from,i=e.to,s=new ue({url:n,token:t,timeout:6e4}).getJobs({epoch_range:[r,i],user_ids:[a]}).then((function(e){return e.job_states.map((function(e){return ce(e,a)}))})),o={id:this.newID(),promise:s,isCanceled:!1};return this.pendingTasks.set(o.id,o),o}}]),t}(Ie));function Me(){return function(e,t){var a,n,r,i,s,o,u,c,l,d,m,h,p;return Y.a.async((function(E){for(;;)switch(E.prev=E.next){case 0:if(e(Pe()),a=t(),n=a.auth.userAuthorization){E.next=5;break}return e(Qe({message:"Not authorized",code:"unauthorized"})),E.abrupt("return");case 5:if(r=t(),i=r.app.config.services.ServiceWizard.url,s=r.views.myJobsView.searchExpression){E.next=9;break}return Qe({message:"No search expression",code:"nosearchexpression"}),E.abrupt("return");case 9:return o=de(s.timeRange),u=Object(V.a)(o,2),c=u[0],l=u[1],d=s.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),m=Ge.spawn({token:n.token,username:n.username,serviceWizardURL:i,from:c,to:l}),E.next=14,Y.a.awrap(m.promise);case 14:if(h=E.sent,!m.isCanceled){E.next=17;break}return E.abrupt("return");case 17:Ge.done(m),p=h.filter((function(e){return d.every((function(t){return t.test(e.appTitle)||t.test(e.narrativeTitle)}))&&le(e,s.jobStatus)})),e(Fe(h,p,Date.now(),s));case 20:case"end":return E.stop()}}))}}function He(e){return{type:n.MY_JOBS_CANCEL_ERROR,error:e}}var qe=Object(_.connect)((function(e,t){var a=e.auth.userAuthorization,n=e.views.myJobsView,r=n.searchState,i=n.jobs;if(!a)throw new Error("Not authorized!");return{jobs:i,searchState:r,showMonitoringControls:!0}}),(function(e,t){return{search:function(t){e(function(e){return function(t,a){var n,r,i,s,o,u,c,l,d,m,h,p,E,b;return Y.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:if(t(Pe()),n=a(),r=n.auth.userAuthorization){f.next=5;break}return t(Qe({message:"Not authorized",code:"unauthorized"})),f.abrupt("return");case 5:if(i=a(),s=i.app.config.services.ServiceWizard.url,o=i.views.myJobsView,u=o.jobsFetchedAt,c=o.rawJobs,l=e.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),d=de(e.timeRange),m=Object(V.a)(d,2),h=m[0],p=m[1],u&&!e.forceSearch){f.next=17;break}return E=Ge.spawn({token:r.token,username:r.username,serviceWizardURL:s,from:h,to:p}),f.next=12,Y.a.awrap(E.promise);case 12:if(c=f.sent,!E.isCanceled){f.next=15;break}return f.abrupt("return");case 15:u=(new Date).getTime(),Ge.done(E);case 17:b=c.filter((function(t){return l.every((function(e){return e.test(t.appTitle)||e.test(t.narrativeTitle)}))&&le(t,e.jobStatus)})),t(Fe(c,b,u,e));case 19:case"end":return f.stop()}}))}}(t))},cancelJob:function(t){e(function(e){return function(t,a){var r,i,s;return Y.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(t({type:n.MY_JOBS_CANCEL_START}),r=a(),i=r.auth.userAuthorization,s=r.app.config.services.NarrativeJobService.url,i){o.next=5;break}return t(He({message:"no authorization",code:"no-authorization"})),o.abrupt("return");case 5:new oe.NarrativeJobServiceClient({url:s,token:i.token,module:"NarrativeJobService"}).cancelJob({job_id:e}).then((function(){t({type:n.MY_JOBS_CANCEL_SUCCESS}),t(Me())})).catch((function(e){console.error("error canceling job",e),t(He({message:"error canceling job: "+e.message,code:"error-canceling"}))}));case 7:case"end":return o.stop()}}))}}(t))},refreshSearch:function(){e(Me())}}}))(Je),Be=(a(843),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).currentQuery=void 0,a.currentQuery="",a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearch({query:this.currentQuery})}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.onSearch({query:this.currentQuery})}},{key:"onChangeQuery",value:function(e){this.currentQuery=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(L.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(L.a.Item,null,i.a.createElement(x.a,{defaultValue:this.currentQuery,placeholder:"Search App Stats (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(L.a.Item,null,i.a.createElement(Q.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"onTableChange",value:function(e,t,a){}},{key:"renderAppStatsTable",value:function(){return i.a.createElement(O.a,{dataSource:this.props.appStats,loading:this.props.searchState===R.SEARCHING,rowKey:function(e){return e.appId},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable ScrollingFlexTable",onChange:this.onTableChange},i.a.createElement(O.a.Column,{title:"Module",dataIndex:"moduleId",key:"moduleId",width:"25%",render:function(e,t){return i.a.createElement(T.a,{title:t.moduleTitle},i.a.createElement("a",{href:"#catalog/module/".concat(e)},t.moduleTitle))},sorter:function(e,t){return e.moduleTitle.localeCompare(t.moduleTitle)},defaultSortOrder:"ascend"}),i.a.createElement(O.a.Column,{title:"Function",dataIndex:"functionId",key:"functionId",width:"25%",render:function(e,t){return i.a.createElement(T.a,{title:t.functionTitle},i.a.createElement("a",{href:"#catalog/apps/".concat(t.moduleId,"/").concat(t.functionId)},t.functionTitle))},sorter:function(e,t){return e.functionTitle.localeCompare(t.functionTitle)}}),i.a.createElement(O.a.Column,{title:"Runs",dataIndex:"runCount",key:"runCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount}}),i.a.createElement(O.a.Column,{title:"Errors",dataIndex:"errorCount",key:"errorCount",width:"5%",align:"right",render:function(e){return i.a.createElement("div",{className:"NumericColumn"},new Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.errorCount-t.errorCount}}),i.a.createElement(O.a.Column,{title:"Success",dataIndex:"successRate",key:"successRate",width:"10%",render:function(e){return i.a.createElement(be.a,{percent:100*e,format:function(t){return new Intl.NumberFormat("en-US",{style:"percent"}).format(e)}})},sorter:function(e,t){return e.successRate-t.successRate}}),i.a.createElement(O.a.Column,{title:"Avg Run",dataIndex:"averageRunTime",key:"averageRunTime",width:"10%",render:function(e){return i.a.createElement(p.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageRunTime-t.averageRunTime}}),i.a.createElement(O.a.Column,{title:"Avg Queue",dataIndex:"averageQueueTime",key:"averageQueueTime",width:"10%",render:function(e){return i.a.createElement(p.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.averageQueueTime-t.averageQueueTime}}),i.a.createElement(O.a.Column,{title:"Total Run",dataIndex:"totalRunTime",key:"totalRunTime",width:"10%",render:function(e){return i.a.createElement(p.NiceTimeDuration,{precision:2,duration:1e3*e})},sorter:function(e,t){return e.totalRunTime-t.totalRunTime}}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"PublicAppStats"},this.renderControlBar(),this.renderAppStatsTable())}}]),t}(i.a.Component));function ze(e,t){return e?t?e/t:null:t?0:null}function Ve(e){return{type:n.PUBLIC_APP_STATS_SEARCH_ERROR,error:e}}var We=Object(_.connect)((function(e,t){var a=e.views.publicAppStatsView,n=a.appStats;return{searchState:a.searchState,appStats:n}}),(function(e,t){return{onSearch:function(t){e(function(e){return function(t,a){var r,i,s,o,u,c,l,d;return Y.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:if(t({type:n.PUBLIC_APP_STATS_SEARCH_START}),r=a(),i=r.auth.userAuthorization,s=r.app.config.services.Catalog.url,i){m.next=5;break}return t(Ve({message:"Not authorized",code:"unauthorized"})),m.abrupt("return");case 5:if(i){m.next=8;break}return t(Ve({message:"Not authorized",code:"unauthorized"})),m.abrupt("return");case 8:return o=new oe.CatalogClient({module:"Catalog",token:i.token,url:s}),m.next=11,Y.a.awrap(o.getExecAggrStats({}));case 11:u=m.sent,c=u.map((function(e){var t=e.full_app_id.split("/"),a=Object(V.a)(t,2),n=a[0],r=a[1];n&&r||console.warn("bad app!",e);var i,s,o=(i=e.number_of_calls-e.number_of_errors,s=e.number_of_calls,i?s?i/s:null:s?0:null),u=ze(e.total_exec_time,e.number_of_calls),c=ze(e.total_queue_time,e.number_of_calls);return{appId:e.full_app_id,moduleId:n,functionId:r||"",moduleTitle:n,functionTitle:r||"",runCount:e.number_of_calls,errorCount:e.number_of_errors,successRate:o,averageRunTime:u,averageQueueTime:c,totalRunTime:e.total_queue_time}})),l=e.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),d=c.filter((function(e){return l.every((function(t){return t.test(e.moduleTitle)||t.test(e.moduleId)||t.test(e.functionTitle)||t.test(e.functionId)}))})),t((h=d,{type:n.PUBLIC_APP_STATS_SEARCH_SUCCESS,appStats:h}));case 16:case"end":return m.stop()}var h}))}}(t))}}}))(Be),Ye=(a(844),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).currentQuery=void 0,a.currentQuery={query:""},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.search(this.currentQuery)}},{key:"onSubmitSearch",value:function(e){e.preventDefault(),this.props.search(this.currentQuery)}},{key:"onChangeQuery",value:function(e){this.currentQuery.query=e.target.value}},{key:"renderControlBar",value:function(){return i.a.createElement(L.a,{layout:"inline",onSubmit:this.onSubmitSearch.bind(this)},i.a.createElement(L.a.Item,null,i.a.createElement(x.a,{defaultValue:this.currentQuery.query,placeholder:"Search (leave empty for all)",style:{width:"20em"},onChange:this.onChangeQuery.bind(this)})),i.a.createElement(L.a.Item,null,i.a.createElement(Q.a,{icon:"search",type:"primary",htmlType:"submit"})))}},{key:"renderTable",value:function(){return i.a.createElement(O.a,{dataSource:this.props.userRunSummary,loading:this.props.searchState===R.SEARCHING,rowKey:function(e){return[e.username,e.appId,e.moduleName,e.functionName].join(":")},pagination:{position:"bottom",showSizeChanger:!0},size:"small",className:"PreciseTable ScrollingFlexTable"},i.a.createElement(O.a.Column,{title:"User",dataIndex:"username",width:"30%",render:function(e,t){return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:"#people/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.username.localeCompare(t.username)}}),i.a.createElement(O.a.Column,{title:"Module",dataIndex:"moduleName",width:"30%",render:function(e){return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:"#catalog/module/".concat(e),target:"_parent"},e))},sorter:function(e,t){return e.moduleName.localeCompare(t.moduleName)}}),i.a.createElement(O.a.Column,{title:"Function",dataIndex:"functionName",width:"30%",render:function(e,t){return i.a.createElement(T.a,{title:e},i.a.createElement("a",{href:"#catalog/apps/".concat(t.appId),target:"_parent"},e))},sorter:function(e,t){return e.functionName.localeCompare(t.functionName)}}),i.a.createElement(O.a.Column,{title:"Runs",dataIndex:"runCount",width:"10%",align:"right",render:function(e,t){return i.a.createElement("div",{className:"NumericColumn"},Intl.NumberFormat("en-US",{useGrouping:!0}).format(e))},sorter:function(e,t){return e.runCount-t.runCount},defaultSortOrder:"descend"}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"UserRunSummary"},this.renderControlBar(),this.renderTable())}}]),t}(i.a.Component));function Ke(e){return{type:n.USER_RUN_SUMMARY_SEARCH_ERROR,error:e}}var Xe=Object(_.connect)((function(e,t){var a=e.views.userRunSummaryView;return{searchState:a.searchState,userRunSummary:a.userRunSummary}}),(function(e,t){return{search:function(t){e(function(e){return function(t,a){var r,i,s,o,u,c,l,d,m;return Y.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:if(t({type:n.USER_RUN_SUMMARY_SEARCH_START}),r=a(),i=r.auth.userAuthorization,s=r.app.config.services.Catalog.url,i){h.next=5;break}return t(Ke({message:"Not authorized",code:"unauthorized"})),h.abrupt("return");case 5:if(i){h.next=8;break}return t(Ke({message:"Not authorized",code:"unauthorized"})),h.abrupt("return");case 8:return o=new oe.CatalogClient({module:"Catalog",token:i.token,url:s}),u={begin:0,end:Date.now()},h.next=12,Y.a.awrap(o.getExecAggrTable(u));case 12:c=h.sent,l=c.map((function(e){var t=e.app;return t||(t=null),{username:e.user,isApp:!!e.app,appId:e.app||null,moduleName:e.func_mod,functionName:e.func,runCount:e.n}})),d=e.query.split(/\s+/).map((function(e){return new RegExp(e,"i")})),m=l.filter((function(e){return d.every((function(t){return e.appId&&t.test(e.appId)||t.test(e.moduleName)||t.test(e.functionName)||t.test(e.username)}))})),t((p=m,{type:n.USER_RUN_SUMMARY_SEARCH_SUCCESS,userRunSummary:p}));case 17:case"end":return h.stop()}var p}))}}(t))}}}))(Ye),$e=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).defaultTabKey=void 0,a.defaultTabKey="myJobs",a.state={activeTabKey:a.defaultTabKey,defaultActiveTabKey:a.defaultTabKey},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.setTitle("Job Browser")}},{key:"componentWillUnmount",value:function(){this.setState({activeTabKey:null})}},{key:"onTabsChange",value:function(e){this.setState({activeTabKey:e})}},{key:"renderJobsTab",value:function(){}},{key:"renderAdminJobsTab",value:function(){}},{key:"renderMyJobsTab",value:function(){return i.a.createElement(qe,null)}},{key:"renderUserJobsTab",value:function(){return i.a.createElement(xe,null)}},{key:"renderPublicAppStatsTab",value:function(){return i.a.createElement(We,null)}},{key:"renderUserRunSummaryTab",value:function(){return i.a.createElement(Xe,null)}},{key:"renderTabs",value:function(){var e=[];if(e.push({tab:"myjobs",title:"My Jobs",component:this.renderMyJobsTab()}),this.props.isAdmin){var t=i.a.createElement("span",null,"User Jobs ",i.a.createElement(I.a,{type:"unlock"}));e.push({tab:"userjobs",title:t,component:i.a.createElement(xe,null)})}if(e.push({tab:"appstats",title:"Public AppStats",component:this.renderPublicAppStatsTab()}),this.props.isAdmin){var a=i.a.createElement("span",null,"User Run Summary ",i.a.createElement(I.a,{type:"unlock"}));e.push({tab:"userrunsummary",title:a,component:i.a.createElement(Xe,null)})}return i.a.createElement(K,{tabs:e})}},{key:"render",value:function(){return i.a.createElement("div",{className:"Col Col-scrollable","data-k-b-testhook-plugin":"job-browser2"},this.renderTabs())}}]),t}(i.a.Component);var Ze=Object(_.connect)((function(e,t){var a=e.views.mainView.isAdmin,n=e.app.runtime.navigation;return{isAdmin:a,view:n.view,params:n.params}}),(function(e,t){return{setTitle:function(t){e(Object(p.sendTitle)(t))},setView:function(t){e(Object(p.setView)(t))},setParams:function(t){e(Object(p.setParams)(t))}}}))($e);function et(e){return{type:n.MAIN_LOAD_SUCCESS,isAdmin:e}}function tt(e){return{type:n.MAIN_LOAD_ERROR,error:e}}var at=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){var e=r.createElement("div",null,"Loading Main ... ",r.createElement(A.a,null));return r.createElement(k.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return r.createElement(k.a,{type:"error",message:this.props.view.error.message})}},{key:"render",value:function(){switch(this.props.view.loadingState){case N.NONE:case N.LOADING:return this.renderLoading();case N.ERROR:return this.renderError();case N.SUCCESS:return r.createElement(Ze,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case N.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.unload()}}]),t}(r.Component);var nt=Object(_.connect)((function(e,t){var a=e.auth.userAuthorization;return{view:e.views.mainView,token:a.token}}),(function(e,t){return{onLoad:function(){e((function(e,t){var a,r,i,s,o;return Y.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(e({type:n.MAIN_LOAD_START}),a=t(),r=a.auth.userAuthorization,i=a.app.config.services.Catalog.url,r){u.next=5;break}return e(tt({message:"Not authorized",code:"unauthorized"})),u.abrupt("return");case 5:return s=new oe.CatalogClient({token:r.token,url:i,module:"Catalog"}),u.prev=6,u.next=9,Y.a.awrap(s.isAdmin());case 9:o=u.sent,e(et(!!o)),u.next=16;break;case 13:u.prev=13,u.t0=u.catch(6),e(tt({message:u.t0.message,code:"error-checking-admin-status"}));case 16:case"end":return u.stop()}}),null,null,[[6,13]])}))},unload:function(){e({type:n.MAIN_UNLOAD})}}}))(at),rt=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={errorMessage:null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidCatch",value:function(e,t){console.error("ERROR",e,t)}},{key:"render",value:function(){if(this.state.errorMessage){var e=this.state.errorMessage;return i.a.createElement(k.a,{type:"error",message:e})}return this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{errorMessage:e.message}}}]),t}(i.a.Component),it=(a(845),Object(C.d)(y,function(){var e=[],t=Object(p.makeBaseStoreState)();return Object(h.a)({},t,{views:{mainView:{loadingState:N.NONE,error:null,isAdmin:!1},myJobsView:{searchState:R.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},userJobsView:{searchState:R.NONE,searchExpression:null,jobsFetchedAt:null,rawJobs:e,jobs:e},publicAppStatsView:{searchState:R.NONE,rawAppStats:[],appStats:[],query:{query:""}},userRunSummaryView:{searchState:R.NONE,userRunSummary:[],query:{query:""}}}})}(),Object(C.c)(Object(C.a)(w.a)))),st=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(rt,null,i.a.createElement(_.Provider,{store:it},i.a.createElement(p.AppBase,null,i.a.createElement(p.AuthGate,{required:!0},i.a.createElement(nt,null)))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(st,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[418,1,2]]]);
//# sourceMappingURL=main.23b4a5af.chunk.js.map